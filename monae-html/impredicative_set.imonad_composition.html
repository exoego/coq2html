
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module impredicative_set.imonad_composition</title>
<meta name="description" content="Documentation of Coq module impredicative_set.imonad_composition" />
<link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
<script src="https://cdn.jsdelivr.net/npm/markdown-it/dist/markdown-it.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/markdown-it-texmath/texmath.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script>
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="init('proofscript')">
<h1 class="title">Module impredicative_set.imonad_composition</h1>
<div class="coq">
<span class="vernacular">From</span> <span class="id">mathcomp</span> <span class="vernacular">Require</span> <span class="vernacular">Import</span> <span class="id">all_ssreflect</span>.<br/>
<span class="vernacular">From</span> <span class="id">HB</span> <span class="vernacular">Require</span> <span class="vernacular">Import</span> <span class="id">structures</span>.<br/>
<span class="vernacular">Require</span> <span class="vernacular">Import</span> <span class="id">imonae_lib</span> <span class="id">ihierarchy</span> <span class="id">imonad_lib</span>.<br/>
<br/>
<pre class="ssrdoc">
                         Composing monads                                  
                                                                           
formalization of [Jones and Duponcheel, Composing Monads, Yale RR 1993]    
(Sections 2 and 3)                                                         
                                                                           
</pre>
<br/>
<span class="gallina-kwd">Set</span> <span class="vernacular">Implicit</span> <span class="vernacular">Arguments</span>.<br/>
<span class="id">Unset</span> <span class="id">Strict</span> <span class="vernacular">Implicit</span>.<br/>
<span class="id">Unset</span> <span class="id">Printing</span> <span class="vernacular">Implicit</span> <span class="id">Defensive</span>.<br/>
<br/>
<span class="id">Local</span> <span class="vernacular">Open</span> <span class="vernacular">Scope</span> <span class="id">monae_scope</span>.<br/>
<br/>
<span class="vernacular">Section</span> <span class="id">comp</span>.<br/>
<span class="vernacular">Variables</span> (<span class="id">M</span> <span class="id">N</span> <span class="id">:</span> <span class="id">monad</span>).<br/>
<span class="vernacular">Definition</span> <span class="id">ret_comp</span> <span class="id">:</span> <span class="id">FId</span> <span class="id">~~&gt;</span> <span class="id">M</span> <span class="id">\o</span> <span class="id">N</span> <span class="id">:=</span> (<span class="id">@ret</span> <span class="id">M</span>) <span class="id">\h</span> (<span class="id">@ret</span> <span class="id">N</span>).<br/>
<span class="vernacular">Lemma</span> <span class="id">naturality_ret</span> <span class="id">:</span> <span class="id">naturality</span> <span class="id">FId</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">M</span> <span class="id">\o</span> <span class="id">N]</span> <span class="id">ret_comp</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof1')">Proof.</span></div>
<div class="proofscript" id="proof1">
 <span class="gallina-kwd">by</span> <span class="id">move=&gt;</span> <span class="id">A</span> <span class="id">B</span> <span class="id">h;</span> <span class="id">rewrite</span> <span class="id">-</span>(<span class="id">natural</span> ((<span class="id">@ret</span> <span class="id">M</span>) <span class="id">\h</span> (<span class="id">@ret</span> <span class="id">N</span>))). Qed.</div>
<span class="id">HB.instance</span> <span class="vernacular">Definition</span> <span class="id">_</span> <span class="id">:=</span> <span class="id">isNatural.Build</span><br/>
&nbsp;&nbsp;<span class="id">FId</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> (<span class="id">M</span> <span class="id">\o</span> <span class="id">N</span>)<span class="id">]</span> <span class="id">ret_comp</span> <span class="id">naturality_ret</span>.<br/>
<span class="vernacular">End</span> <span class="id">comp</span>.<br/>
<span class="vernacular">Definition</span> <span class="id">CRet</span> (<span class="id">M</span> <span class="id">N</span> <span class="id">:</span> <span class="id">monad</span>) <span class="id">:=</span> <span class="id">[the</span> <span class="id">FId</span> <span class="id">~&gt;</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">M</span> <span class="id">\o</span> <span class="id">N]</span> <span class="id">of</span> <span class="id">ret_comp</span> <span class="id">M</span> <span class="id">N]</span>.<br/>
<br/>
<span class="vernacular">Module</span> <span class="id">Prod</span>.<br/>
<span class="vernacular">Section</span> <span class="id">prod</span>.<br/>
<span class="vernacular">Variables</span> <span class="id">M</span> <span class="id">N</span> <span class="id">:</span> <span class="id">monad</span>.<br/>
<span class="vernacular">Variable</span> <span class="id">prod</span> <span class="id">:</span> <span class="id">N</span> <span class="id">\o</span> (<span class="id">M</span> <span class="id">\o</span> <span class="id">N</span>) <span class="id">~~&gt;</span> <span class="id">M</span> <span class="id">\o</span> <span class="id">N</span>.<br/>
<span class="vernacular">Arguments</span> <span class="id">prod</span> <span class="id">{_}</span>.<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">JOIN</span> <span class="id">:</span> (<span class="id">M</span> <span class="id">\o</span> <span class="id">N</span>) <span class="id">\o</span> (<span class="id">M</span> <span class="id">\o</span> <span class="id">N</span>) <span class="id">~~&gt;</span> <span class="id">M</span> <span class="id">\o</span> <span class="id">N</span> <span class="id">:=</span> <span class="gallina-kwd">fun</span> <span class="id">_</span> <span class="id">=&gt;</span> <span class="id">Join</span> <span class="id">\o</span> <span class="id">M</span> <span class="id">#</span> <span class="id">prod</span>.<br/>
<span class="vernacular">Arguments</span> <span class="id">JOIN</span> <span class="id">{_}</span>.<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">prod1</span> <span class="id">:=</span> <span class="gallina-kwd">forall</span> (<span class="id">A</span> <span class="id">B</span> <span class="id">:</span> <span class="id">UU0</span>) (<span class="id">f</span> <span class="id">:</span> <span class="id">A</span> <span class="id">-&gt;</span> <span class="id">B</span>)<span class="id">,</span> <span class="id">prod</span> <span class="id">\o</span> <span class="id">N</span> <span class="id">#</span> (<span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">M</span> <span class="id">\o</span> <span class="id">N]</span> <span class="id">#</span> <span class="id">f</span>) <span class="id">=</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">M</span> <span class="id">\o</span> <span class="id">N]</span> <span class="id">#</span> <span class="id">f</span> <span class="id">\o</span> <span class="id">prod</span>.<br/>
<span class="vernacular">Definition</span> <span class="id">prod2</span> <span class="id">:=</span> <span class="gallina-kwd">forall</span> <span class="id">A,</span> <span class="id">prod</span> <span class="id">\o</span> <span class="id">Ret</span> <span class="id">=</span> <span class="id">id</span> <span class="id">:&gt;</span> (<span class="id">_</span> <span class="id">-&gt;</span> (<span class="id">M</span> <span class="id">\o</span> <span class="id">N</span>) <span class="id">A</span>).<br/>
<span class="vernacular">Definition</span> <span class="id">prod3</span> <span class="id">:=</span> <span class="gallina-kwd">forall</span> <span class="id">A,</span> <span class="id">prod</span> <span class="id">\o</span> <span class="id">N</span> <span class="id">#</span> <span class="id">CRet</span> <span class="id">M</span> <span class="id">N</span> <span class="id">_</span> <span class="id">=</span> <span class="id">Ret</span> <span class="id">:&gt;</span> (<span class="id">_</span> <span class="id">-&gt;</span> (<span class="id">M</span> <span class="id">\o</span> <span class="id">N</span>) <span class="id">A</span>).<br/>
<span class="vernacular">Definition</span> <span class="id">prod4</span> <span class="id">:=</span> <span class="gallina-kwd">forall</span> <span class="id">A,</span> <span class="id">prod</span> <span class="id">\o</span> <span class="id">N</span> <span class="id">#</span> <span class="id">JOIN</span> <span class="id">=</span> <span class="id">JOIN</span> <span class="id">\o</span> <span class="id">prod</span> <span class="id">:&gt;</span> (<span class="id">_</span> <span class="id">-&gt;</span> (<span class="id">M</span> <span class="id">\o</span> <span class="id">N</span>) <span class="id">A</span>).<br/>
<span class="vernacular">Hypothesis</span> <span class="id">Hprod1</span> <span class="id">:</span> <span class="id">prod1</span>.<br/>
<span class="vernacular">Hypothesis</span> <span class="id">Hprod2</span> <span class="id">:</span> <span class="id">prod2</span>.<br/>
<span class="vernacular">Hypothesis</span> <span class="id">Hprod3</span> <span class="id">:</span> <span class="id">prod3</span>.<br/>
<span class="vernacular">Hypothesis</span> <span class="id">Hprod4</span> <span class="id">:</span> <span class="id">prod4</span>.<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">JOIN_naturality</span> <span class="id">:</span> <span class="id">naturality</span> <span class="id">_</span> <span class="id">_</span> (<span class="id">@JOIN</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof2')">Proof.</span></div>
<div class="proofscript" id="proof2">
<span class="id">move=&gt;</span> <span class="id">A</span> <span class="id">B</span> <span class="id">g;</span> <span class="id">apply/esym;</span> <span class="id">rewrite</span> <span class="id">{1}/JOIN</span> <span class="id">-[in</span> <span class="id">LHS]compA</span>.<br/>
<span class="id">transitivity</span> (<br/>
&nbsp;&nbsp;<span class="id">Join</span> <span class="id">\o</span> (<span class="id">M</span> <span class="id">#</span> <span class="id">prod</span> <span class="id">\o</span> <span class="id">M</span> <span class="id">#</span> (<span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">N</span> <span class="id">\o</span> (<span class="id">M</span> <span class="id">\o</span> <span class="id">N</span>)<span class="id">]</span> <span class="id">#</span> <span class="id">g</span>))).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">[]</span>.<br/>
<span class="id">rewrite</span> <span class="id">-functor_o</span> <span class="id">Hprod1</span>.<br/>
<span class="id">rewrite</span> <span class="id">functor_o</span> <span class="id">[LHS]compA</span> <span class="id">/JOIN</span> <span class="id">FCompE</span> <span class="id">-</span>(<span class="id">FCompE</span> <span class="id">M</span> <span class="id">M</span>).<br/>
<span class="id">rewrite</span> <span class="id">-</span>(<span class="id">natural</span> <span class="id">join</span>).<br/>
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">-compA</span>.<br/>
Qed.</div>
<br/>
<span class="id">HB.instance</span> <span class="vernacular">Definition</span> <span class="id">_</span> <span class="id">:=</span> <span class="id">isNatural.Build</span><br/>
&nbsp;&nbsp;<span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> (<span class="id">M</span> <span class="id">\o</span> <span class="id">N</span>) <span class="id">\o</span> (<span class="id">M</span> <span class="id">\o</span> <span class="id">N</span>)<span class="id">]</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">M</span> <span class="id">\o</span> <span class="id">N]</span> (<span class="id">@JOIN</span>) <span class="id">JOIN_naturality</span>.<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">JOIN'</span> <span class="id">:</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> (<span class="id">M</span> <span class="id">\o</span> <span class="id">N</span>) <span class="id">\o</span> (<span class="id">M</span> <span class="id">\o</span> <span class="id">N</span>)<span class="id">]</span> <span class="id">~&gt;</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">M</span> <span class="id">\o</span> <span class="id">N]</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="id">[the</span> <span class="id">_</span> <span class="id">~&gt;</span> <span class="id">_</span> <span class="id">of</span> <span class="id">@JOIN]</span>.<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">JOIN_ret</span> <span class="id">:</span> <span class="id">JoinLaws.left_unit</span> (<span class="id">CRet</span> <span class="id">M</span> <span class="id">N</span>) (<span class="id">@JOIN'</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof3')">Proof.</span></div>
<div class="proofscript" id="proof3">
<span class="id">move=&gt;</span> <span class="id">A;</span> <span class="id">rewrite</span> <span class="id">/JOIN'</span>.<br/>
<span class="id">rewrite</span> <span class="id">/=</span>.<br/>
<span class="id">rewrite</span> <span class="id">/CRet</span>.<br/>
<span class="id">rewrite</span> <span class="id">compA</span>.<br/>
<span class="id">rewrite</span> <span class="id">-</span>(<span class="id">compA</span> <span class="id">Join</span> (<span class="id">M</span> <span class="id">#</span> <span class="id">prod</span>) <span class="id">Ret</span>) (<span class="id">natural</span> <span class="id">ret</span>).<br/>
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">[LHS]compA</span> (<span class="id">compA</span> <span class="id">Join</span>) <span class="id">joinretM</span> <span class="id">compidf</span> <span class="id">Hprod2</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">Lemma</span> <span class="id">JOIN_fmap_ret</span> <span class="id">:</span> <span class="id">JoinLaws.right_unit</span> (<span class="id">@CRet</span> <span class="id">M</span> <span class="id">N</span>) (<span class="id">@JOIN'</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof4')">Proof.</span></div>
<div class="proofscript" id="proof4">
<span class="id">move=&gt;</span> <span class="id">A</span>.<br/>
<span class="id">rewrite</span> <span class="id">/JOIN'</span> <span class="id">/=</span>.<br/>
<span class="id">rewrite</span> <span class="id">-compA</span>.<br/>
<span class="id">rewrite</span> <span class="id">FCompE</span>.<br/>
<span class="id">rewrite</span> <span class="id">-</span>(<span class="id">@functor_o</span> <span class="id">M</span>).<br/>
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">Hprod3</span> <span class="id">joinMret</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">Lemma</span> <span class="id">JOIN_fmap_JOIN</span> <span class="id">:</span> <span class="id">JoinLaws.associativity</span> (<span class="id">@JOIN'</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof5')">Proof.</span></div>
<div class="proofscript" id="proof5">
<span class="id">move=&gt;</span> <span class="id">A;</span> <span class="id">rewrite</span> <span class="id">{1</span> <span class="id">2}/JOIN'</span> <span class="id">-[LHS]compA</span> <span class="id">/=</span>.<br/>
<span class="id">rewrite</span> <span class="id">-functor_o</span>.<br/>
<span class="id">rewrite</span> <span class="id">Hprod4</span>.<br/>
<span class="id">rewrite</span> <span class="id">{1}/JOIN</span>.<br/>
<span class="id">rewrite</span> <span class="id">-</span>(<span class="id">compA</span> <span class="id">Join</span> (<span class="id">M</span> <span class="id">#</span> <span class="id">prod</span>) <span class="id">prod</span>).<br/>
<span class="id">rewrite</span> <span class="id">functor_o</span>.<br/>
<span class="id">rewrite</span> <span class="id">[LHS]compA</span>.<br/>
<span class="id">rewrite</span> <span class="id">joinA</span>.<br/>
<span class="id">rewrite</span> <span class="id">-compA</span>.<br/>
<span class="id">rewrite</span> <span class="id">functor_o</span>.<br/>
<span class="id">rewrite</span> (<span class="id">compA</span> <span class="id">Join</span> (<span class="id">M</span> <span class="id">#</span> (<span class="id">M</span> <span class="id">#</span> <span class="id">prod</span>)) (<span class="id">M</span> <span class="id">#</span> <span class="id">prod</span>)).<br/>
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">-</span>(<span class="id">natural</span> <span class="id">_</span>).<br/>
Qed.</div>
<br/>
<span class="vernacular">End</span> <span class="id">prod</span>.<br/>
<span class="vernacular">End</span> <span class="id">Prod</span>.<br/>
<br/>
<span class="vernacular">Module</span> <span class="id">Dorp</span>.<br/>
<span class="vernacular">Section</span> <span class="id">dorp</span>.<br/>
<span class="vernacular">Variables</span> <span class="id">M</span>   <span class="id">N</span> <span class="id">:</span> <span class="id">monad</span>.<br/>
<span class="vernacular">Variable</span> <span class="id">dorp</span> <span class="id">:</span> <span class="id">M</span> <span class="id">\o</span> (<span class="id">N</span> <span class="id">\o</span> <span class="id">M</span>) <span class="id">~~&gt;</span> <span class="id">M</span> <span class="id">\o</span> <span class="id">N</span>.<br/>
<span class="vernacular">Arguments</span> <span class="id">dorp</span> <span class="id">{_}</span>.<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">JOIN</span> <span class="id">:</span> (<span class="id">M</span> <span class="id">\o</span> <span class="id">N</span>) <span class="id">\o</span> (<span class="id">M</span> <span class="id">\o</span> <span class="id">N</span>) <span class="id">~~&gt;</span> <span class="id">M</span> <span class="id">\o</span> <span class="id">N</span> <span class="id">:=</span> <span class="gallina-kwd">fun</span> <span class="id">_</span> <span class="id">=&gt;</span> <span class="id">M</span> <span class="id">#</span> <span class="id">Join</span> <span class="id">\o</span> <span class="id">dorp</span>.<br/>
<span class="vernacular">Arguments</span> <span class="id">JOIN</span> <span class="id">{_}</span>.<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">dorp1</span> <span class="id">:=</span> <span class="gallina-kwd">forall</span> (<span class="id">A</span> <span class="id">B</span> <span class="id">:</span> <span class="id">UU0</span>) (<span class="id">f</span> <span class="id">:</span> <span class="id">A</span> <span class="id">-&gt;</span> <span class="id">B</span>)<span class="id">,</span> <span class="id">dorp</span> <span class="id">\o</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">M</span> <span class="id">\o</span> <span class="id">N]</span> <span class="id">#</span> (<span class="id">M</span> <span class="id">#</span> <span class="id">f</span>) <span class="id">=</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">M</span> <span class="id">\o</span> <span class="id">N]</span> <span class="id">#</span> <span class="id">f</span> <span class="id">\o</span> <span class="id">dorp</span>.<br/>
<span class="vernacular">Definition</span> <span class="id">dorp2</span> <span class="id">:=</span> <span class="gallina-kwd">forall</span> <span class="id">A,</span> (<span class="id">@dorp</span> <span class="id">A</span>) <span class="id">\o</span> <span class="id">CRet</span> <span class="id">M</span> <span class="id">N</span> <span class="id">_</span> <span class="id">=</span> <span class="id">M</span> <span class="id">#</span> <span class="id">Ret</span>.<br/>
<span class="vernacular">Definition</span> <span class="id">dorp3</span> <span class="id">:=</span> <span class="gallina-kwd">forall</span> <span class="id">A,</span> (<span class="id">@dorp</span> <span class="id">A</span>) <span class="id">\o</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">M</span> <span class="id">\o</span> <span class="id">N]</span> <span class="id">#</span> <span class="id">Ret</span> <span class="id">=</span> <span class="id">id</span>.<br/>
<span class="vernacular">Definition</span> <span class="id">dorp4</span> <span class="id">:=</span> <span class="gallina-kwd">forall</span> <span class="id">A,</span> (<span class="id">@dorp</span> <span class="id">A</span>) <span class="id">\o</span> <span class="id">JOIN</span> <span class="id">=</span> <span class="id">JOIN</span> <span class="id">\o</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">M</span> <span class="id">\o</span> <span class="id">N]</span> <span class="id">#</span> <span class="id">dorp</span>.<br/>
<span class="vernacular">Hypothesis</span> <span class="id">Hdorp1</span> <span class="id">:</span> <span class="id">dorp1</span>.<br/>
<span class="vernacular">Hypothesis</span> <span class="id">Hdorp2</span> <span class="id">:</span> <span class="id">dorp2</span>.<br/>
<span class="vernacular">Hypothesis</span> <span class="id">Hdorp3</span> <span class="id">:</span> <span class="id">dorp3</span>.<br/>
<span class="vernacular">Hypothesis</span> <span class="id">Hdorp4</span> <span class="id">:</span> <span class="id">dorp4</span>.<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">join_naturality</span> <span class="id">:</span> <span class="id">naturality</span> <span class="id">_</span> <span class="id">_</span> (<span class="id">@JOIN</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof6')">Proof.</span></div>
<div class="proofscript" id="proof6">
<span class="id">move=&gt;</span> <span class="id">A</span> <span class="id">B</span> <span class="id">g;</span> <span class="id">apply/esym;</span> <span class="id">rewrite</span> <span class="id">{1}/JOIN</span> <span class="id">-compA</span> <span class="id">Hdorp1</span>.<br/>
<span class="id">rewrite</span> <span class="id">[LHS]compA</span>.<br/>
<span class="id">rewrite</span> (<span class="id">FCompE</span> <span class="id">M</span> <span class="id">N</span> (<span class="id">N</span> <span class="id">#</span> <span class="id">g</span>)).<br/>
<span class="id">rewrite</span> <span class="id">-</span>(<span class="id">@functor_o</span> <span class="id">M</span>).<br/>
<span class="id">rewrite</span> <span class="id">-natural</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">functor_o</span>.<br/>
Qed.</div>
<br/>
<span class="id">HB.instance</span> <span class="vernacular">Definition</span> <span class="id">_</span> <span class="id">:=</span> <span class="id">isNatural.Build</span><br/>
&nbsp;&nbsp;<span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> ((<span class="id">M</span> <span class="id">\o</span> <span class="id">N</span>) <span class="id">\o</span> (<span class="id">M</span> <span class="id">\o</span> <span class="id">N</span>))<span class="id">]</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> (<span class="id">M</span> <span class="id">\o</span> <span class="id">N</span>)<span class="id">]</span> (<span class="id">@JOIN</span>) <span class="id">join_naturality</span>.<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">JOIN'</span> <span class="id">:</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> (<span class="id">M</span> <span class="id">\o</span> <span class="id">N</span>) <span class="id">\o</span> (<span class="id">M</span> <span class="id">\o</span> <span class="id">N</span>)<span class="id">]</span> <span class="id">~&gt;</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">M</span> <span class="id">\o</span> <span class="id">N]</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="id">[the</span> <span class="id">_</span> <span class="id">~&gt;</span> <span class="id">_</span> <span class="id">of</span> (<span class="id">@JOIN</span>)<span class="id">]</span>.<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">JOIN_ret</span> <span class="id">:</span> <span class="id">JoinLaws.left_unit</span> (<span class="id">@CRet</span> <span class="id">M</span> <span class="id">N</span>) (<span class="id">@JOIN'</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof7')">Proof.</span></div>
<div class="proofscript" id="proof7">
<span class="id">move=&gt;</span> <span class="id">A;</span> <span class="id">rewrite</span> <span class="id">/JOIN</span> <span class="id">-[LHS]compA</span> <span class="id">Hdorp2</span>.<br/>
<span class="id">rewrite</span> <span class="id">-</span>(<span class="id">@functor_o</span> <span class="id">M</span>).<br/>
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">joinretM</span> <span class="id">functor_id</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">Lemma</span> <span class="id">JOIN_fmap_ret</span> <span class="id">:</span> <span class="id">JoinLaws.right_unit</span> (<span class="id">@CRet</span> <span class="id">M</span> <span class="id">N</span>) (<span class="id">@JOIN'</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof8')">Proof.</span></div>
<div class="proofscript" id="proof8">
<span class="id">move=&gt;</span> <span class="id">A;</span> <span class="id">rewrite</span> <span class="id">/JOIN</span> <span class="id">/CRet</span>.<br/>
<span class="id">rewrite</span> <span class="id">-</span>(<span class="id">compA</span> (<span class="id">M</span> <span class="id">#</span> <span class="id">Join</span>) <span class="id">dorp</span>).<br/>
<span class="id">rewrite</span> (<span class="id">@functor_o</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">M</span> <span class="id">\o</span> <span class="id">N]</span>).<br/>
<span class="id">rewrite</span> (<span class="id">compA</span> <span class="id">dorp</span>) <span class="id">Hdorp3</span>.<br/>
<span class="id">rewrite</span> <span class="id">compidf</span> <span class="id">-functor_o</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">joinMret</span> <span class="id">functor_id</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">Lemma</span> <span class="id">JOIN_fmap_JOIN</span> <span class="id">:</span> <span class="id">JoinLaws.associativity</span> (<span class="id">@JOIN'</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof9')">Proof.</span></div>
<div class="proofscript" id="proof9">
<span class="id">move=&gt;</span> <span class="id">A;</span> <span class="id">rewrite</span> <span class="id">{1</span> <span class="id">2}/JOIN'</span>.<br/>
<span class="id">rewrite</span> <span class="id">FCompE</span>.<br/>
<span class="id">rewrite</span> (<span class="id">@functor_o</span> <span class="id">N</span>).<br/>
<span class="id">rewrite</span> <span class="id">-[LHS]compA</span>.<br/>
<span class="id">rewrite</span> <span class="id">functor_o</span>.<br/>
<span class="id">rewrite</span> (<span class="id">compA</span> <span class="id">dorp</span>).<br/>
<span class="id">rewrite</span> <span class="id">Hdorp1</span>.<br/>
<span class="id">rewrite</span> <span class="id">-</span>(<span class="id">compA</span> <span class="id">_</span> <span class="id">dorp</span>).<br/>
<span class="id">rewrite</span> (<span class="id">compA</span> (<span class="id">M</span> <span class="id">#</span> <span class="id">Join</span>)) <span class="id">-functor_o</span>.<br/>
<span class="id">rewrite</span> <span class="id">joinA</span>.<br/>
<span class="id">rewrite</span> <span class="id">functor_o</span>.<br/>
<span class="id">rewrite</span> <span class="id">-[LHS]compA</span>.<br/>
<span class="id">rewrite</span> (<span class="id">compA</span> (<span class="id">M</span> <span class="id">#</span> <span class="id">Join</span>) <span class="id">dorp</span>).<br/>
<span class="id">rewrite</span> <span class="id">-/JOIN</span>.<br/>
<span class="id">rewrite</span> <span class="id">-Hdorp4</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">[LHS]compA</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">End</span> <span class="id">dorp</span>.<br/>
<span class="vernacular">End</span> <span class="id">Dorp</span>.<br/>
<br/>
<span class="vernacular">Module</span> <span class="id">Swap</span>.<br/>
<span class="vernacular">Section</span> <span class="id">swap</span>.<br/>
<span class="vernacular">Variables</span> <span class="id">M</span> <span class="id">N</span> <span class="id">:</span> <span class="id">monad</span>.<br/>
<span class="vernacular">Variable</span> <span class="id">swap</span> <span class="id">:</span> <span class="id">N</span> <span class="id">\o</span> <span class="id">M</span> <span class="id">~~&gt;</span> <span class="id">M</span> <span class="id">\o</span> <span class="id">N</span>.<br/>
<span class="vernacular">Arguments</span> <span class="id">swap</span> <span class="id">{_}</span>.<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">JOIN</span> <span class="id">:</span> (<span class="id">M</span> <span class="id">\o</span> <span class="id">N</span>) <span class="id">\o</span> (<span class="id">M</span> <span class="id">\o</span> <span class="id">N</span>) <span class="id">~~&gt;</span> <span class="id">M</span> <span class="id">\o</span> <span class="id">N</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">fun</span> <span class="id">A</span> <span class="id">=&gt;</span> <span class="id">M</span> <span class="id">#</span> <span class="id">Join</span> <span class="id">\o</span> <span class="id">Join</span> <span class="id">\o</span> <span class="id">M</span> <span class="id">#</span> (<span class="id">@swap</span> (<span class="id">N</span> <span class="id">A</span>)).<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">JOINE</span> <span class="id">A</span> <span class="id">:</span> <span class="id">@JOIN</span> <span class="id">A</span> <span class="id">=</span> <span class="id">Join</span> <span class="id">\o</span> <span class="id">M</span> <span class="id">#</span> (<span class="id">M</span> <span class="id">#</span> <span class="id">Join</span> <span class="id">\o</span> <span class="id">swap</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof10')">Proof.</span></div>
<div class="proofscript" id="proof10">
<span class="id">rewrite</span> <span class="id">/JOIN</span>.<br/>
<span class="id">rewrite</span> <span class="id">natural</span>.<br/>
<span class="id">rewrite</span> <span class="id">-</span>(<span class="id">compA</span> <span class="id">Join</span>) <span class="id">FCompE</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">-</span>(<span class="id">@functor_o</span> <span class="id">M</span>).<br/>
Qed.</div>
<br/>
<span class="vernacular">Let</span> <span class="id">prod</span> <span class="id">A</span> <span class="id">:=</span> <span class="id">M</span> <span class="id">#</span> (<span class="id">join</span> <span class="id">A</span>) <span class="id">\o</span> (<span class="id">@swap</span> <span class="id">_</span>).<br/>
<span class="vernacular">Arguments</span> <span class="id">prod</span> <span class="id">{A}</span>.<br/>
<span class="vernacular">Let</span> <span class="id">dorp</span> <span class="id">A</span> <span class="id">:=</span> <span class="id">Join</span> <span class="id">\o</span> <span class="id">M</span> <span class="id">#</span> (<span class="id">@swap</span> <span class="id">A</span>).<br/>
<span class="vernacular">Arguments</span> <span class="id">dorp</span> <span class="id">{A}</span>.<br/>
<br/>
<span class="vernacular">Fact</span> <span class="id">JOIN_prod</span> <span class="id">A</span> <span class="id">:</span> <span class="id">@JOIN</span> <span class="id">A</span> <span class="id">=</span> <span class="id">Join</span> <span class="id">\o</span> <span class="id">M</span> <span class="id">#</span> <span class="id">prod</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof11')">Proof.</span></div>
<div class="proofscript" id="proof11">
 <span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">JOINE</span>. Qed.</div>
<br/>
<span class="vernacular">Fact</span> <span class="id">JOIN_dorp</span> <span class="id">A</span> <span class="id">:</span> <span class="id">@JOIN</span> <span class="id">A</span> <span class="id">=</span> <span class="id">M</span> <span class="id">#</span> <span class="id">Join</span> <span class="id">\o</span> <span class="id">dorp</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof12')">Proof.</span></div>
<div class="proofscript" id="proof12">
 <span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">/dorp</span>. Qed.</div>
<br/>
<span class="vernacular">Definition</span> <span class="id">swap1</span> <span class="id">:=</span> <span class="gallina-kwd">forall</span> (<span class="id">A</span> <span class="id">B</span> <span class="id">:</span> <span class="id">UU0</span>) (<span class="id">f</span> <span class="id">:</span> <span class="id">A</span> <span class="id">-&gt;</span> <span class="id">B</span>)<span class="id">,</span> <span class="id">swap</span> <span class="id">\o</span> <span class="id">N</span> <span class="id">#</span> (<span class="id">M</span> <span class="id">#</span> <span class="id">f</span>) <span class="id">=</span> <span class="id">M</span> <span class="id">#</span> (<span class="id">N</span> <span class="id">#</span> <span class="id">f</span>) <span class="id">\o</span> <span class="id">swap</span> <span class="id">.</span><br/>
<span class="vernacular">Definition</span> <span class="id">swap2</span> <span class="id">:=</span> <span class="gallina-kwd">forall</span> <span class="id">A,</span> <span class="id">@swap</span> <span class="id">A</span> <span class="id">\o</span> <span class="id">Ret</span> <span class="id">=</span> <span class="id">M</span> <span class="id">#</span> <span class="id">Ret</span> <span class="id">:&gt;</span> (<span class="id">M</span> <span class="id">A</span> <span class="id">-&gt;</span> (<span class="id">M</span> <span class="id">\o</span> <span class="id">N</span>) <span class="id">A</span>).<br/>
<span class="vernacular">Definition</span> <span class="id">swap3</span> <span class="id">:=</span> <span class="gallina-kwd">forall</span> <span class="id">A,</span> <span class="id">@swap</span> <span class="id">A</span> <span class="id">\o</span> <span class="id">N</span> <span class="id">#</span> <span class="id">Ret</span> <span class="id">=</span> <span class="id">Ret</span> <span class="id">:&gt;</span> (<span class="id">N</span> <span class="id">A</span> <span class="id">-&gt;</span> (<span class="id">M</span> <span class="id">\o</span> <span class="id">N</span>) <span class="id">A</span>).<br/>
<span class="vernacular">Definition</span> <span class="id">swap4</span> <span class="id">:=</span> <span class="gallina-kwd">forall</span> <span class="id">A,</span> (<span class="id">@prod</span> <span class="id">A</span>) <span class="id">\o</span> <span class="id">N</span> <span class="id">#</span> (<span class="id">@dorp</span> <span class="id">_</span>) <span class="id">=</span> (<span class="id">@dorp</span> <span class="id">_</span>) <span class="id">\o</span> (<span class="id">@prod</span> <span class="id">_</span>).<br/>
<span class="vernacular">Hypothesis</span> <span class="id">Hswap1</span> <span class="id">:</span> <span class="id">swap1</span>.<br/>
<span class="vernacular">Hypothesis</span> <span class="id">Hswap2</span> <span class="id">:</span> <span class="id">swap2</span>.<br/>
<span class="vernacular">Hypothesis</span> <span class="id">Hswap3</span> <span class="id">:</span> <span class="id">swap3</span>.<br/>
<span class="vernacular">Hypothesis</span> <span class="id">Hswap4</span> <span class="id">:</span> <span class="id">swap4</span>.<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">prod1</span> <span class="id">:</span> <span class="id">Prod.prod1</span> (<span class="id">@prod</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof13')">Proof.</span></div>
<div class="proofscript" id="proof13">
<span class="id">move=&gt;</span> <span class="id">A</span> <span class="id">B</span> <span class="id">f;</span> <span class="id">rewrite</span> <span class="id">{1}/prod</span>.<br/>
<span class="id">rewrite</span> <span class="id">-[LHS]compA</span> <span class="id">Hswap1</span> (<span class="id">compA</span> (<span class="id">M</span> <span class="id">#</span> <span class="id">Join</span>)) <span class="id">-functor_o</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">-natural</span> <span class="id">functor_o</span> <span class="id">-compA</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">Lemma</span> <span class="id">prod2</span> <span class="id">:</span> <span class="id">Prod.prod2</span> (<span class="id">@prod</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof14')">Proof.</span></div>
<div class="proofscript" id="proof14">
<span class="gallina-kwd">by</span> <span class="id">move=&gt;</span> <span class="id">A;</span> <span class="id">rewrite</span> <span class="id">/prod</span> <span class="id">-[LHS]compA</span> <span class="id">Hswap2</span> <span class="id">-</span>(<span class="id">@functor_o</span> <span class="id">M</span>) <span class="id">joinretM</span> <span class="id">functor_id</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">Lemma</span> <span class="id">prod3</span> <span class="id">:</span> <span class="id">Prod.prod3</span> (<span class="id">@prod</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof15')">Proof.</span></div>
<div class="proofscript" id="proof15">
<span class="id">move=&gt;</span> <span class="id">A;</span> <span class="id">rewrite</span> <span class="id">/prod</span> <span class="id">/CRet</span>.<br/>
<span class="id">rewrite</span> (<span class="id">@functor_o</span> <span class="id">N</span>) (<span class="id">compA</span> (<span class="id">M</span> <span class="id">#</span> <span class="id">Join</span> <span class="id">\o</span> <span class="id">swap</span>)) <span class="id">-</span>(<span class="id">compA</span> (<span class="id">_</span> <span class="id">#</span> <span class="id">Join</span>)) <span class="id">Hswap3</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> (<span class="id">natural</span> <span class="id">ret</span>) <span class="id">-[LHS]compA</span> <span class="id">joinMret</span> <span class="id">compfid</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">Lemma</span> <span class="id">prod4</span> <span class="id">:</span> <span class="id">Prod.prod4</span> (<span class="id">@prod</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof16')">Proof.</span></div>
<div class="proofscript" id="proof16">
<span class="id">move=&gt;</span> <span class="id">A;</span> <span class="id">rewrite</span> <span class="id">{1}/Prod</span>.<span class="id">JOIN</span> <span class="id">-JOIN_prod</span> <span class="id">JOIN_dorp</span> <span class="id">{1}/prod</span> (<span class="id">@functor_o</span> <span class="id">N</span>).<br/>
<span class="id">rewrite</span> (<span class="id">compA</span> (<span class="id">M</span> <span class="id">#</span> <span class="id">Join</span> <span class="id">\o</span> <span class="id">swap</span>)) <span class="id">-</span>(<span class="id">compA</span> (<span class="id">_</span> <span class="id">#</span> <span class="id">Join</span>)) <span class="id">Hswap1</span>.<br/>
<span class="id">rewrite</span> (<span class="id">compA</span> (<span class="id">M</span> <span class="id">#</span> <span class="id">Join</span>)) <span class="id">-functor_o</span> <span class="id">joinA</span> <span class="id">functor_o</span>.<br/>
<span class="id">rewrite</span> <span class="id">-[LHS]compA</span> <span class="id">-</span>(<span class="id">compA</span> (<span class="id">_</span> <span class="id">#</span> <span class="id">Join</span>)) (<span class="id">compA</span> (<span class="id">M</span> <span class="id">#</span> <span class="id">Join</span>) <span class="id">swap</span>) <span class="id">-/prod</span> <span class="id">Hswap4</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">[LHS]compA</span> <span class="id">/Prod</span>.<span class="id">JOIN</span> <span class="id">-JOIN_prod</span> <span class="id">JOIN_dorp</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">Lemma</span> <span class="id">dorp1</span> <span class="id">:</span> <span class="id">Dorp.dorp1</span> (<span class="id">@dorp</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof17')">Proof.</span></div>
<div class="proofscript" id="proof17">
<span class="id">move=&gt;</span> <span class="id">A</span> <span class="id">B</span> <span class="id">g;</span> <span class="id">rewrite</span> <span class="id">{1}/dorp</span> <span class="id">-[LHS]compA</span>.<br/>
<span class="id">rewrite</span> <span class="id">-</span>(<span class="id">@functor_o</span> <span class="id">M</span>).<br/>
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">Hswap1</span> <span class="id">functor_o</span> (<span class="id">compA</span> <span class="id">Join</span>) <span class="id">-natural</span> <span class="id">-[LHS]compA</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">Lemma</span> <span class="id">dorp2</span> <span class="id">:</span> <span class="id">Dorp.dorp2</span> (<span class="id">@dorp</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof18')">Proof.</span></div>
<div class="proofscript" id="proof18">
<span class="id">move=&gt;</span> <span class="id">A;</span> <span class="id">rewrite</span> <span class="id">/dorp</span> <span class="id">/CRet</span> (<span class="id">compA</span> (<span class="id">Join</span> <span class="id">\o</span> <span class="id">M</span> <span class="id">#</span> <span class="id">swap</span>)) <span class="id">-</span>(<span class="id">compA</span> <span class="id">Join</span>).<br/>
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> (<span class="id">natural</span> <span class="id">ret</span>) (<span class="id">compA</span> <span class="id">Join</span>) <span class="id">joinretM</span> <span class="id">compidf</span> <span class="id">Hswap2</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">Lemma</span> <span class="id">dorp3</span> <span class="id">:</span> <span class="id">Dorp.dorp3</span> (<span class="id">@dorp</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof19')">Proof.</span></div>
<div class="proofscript" id="proof19">
<span class="id">move=&gt;</span> <span class="id">A;</span> <span class="id">rewrite</span> <span class="id">/dorp</span> <span class="id">-[LHS]compA</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">-</span>(<span class="id">@functor_o</span> <span class="id">M</span>) <span class="id">Hswap3</span> <span class="id">joinMret</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">Lemma</span> <span class="id">dorp4</span> <span class="id">:</span> <span class="id">Dorp.dorp4</span> (<span class="id">@dorp</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof20')">Proof.</span></div>
<div class="proofscript" id="proof20">
<span class="id">move=&gt;</span> <span class="id">A;</span> <span class="id">rewrite</span> <span class="id">{1}/dorp</span> <span class="id">{1}/Dorp</span>.<span class="id">JOIN</span> <span class="id">-JOIN_dorp</span> <span class="id">JOIN_prod</span>.<br/>
<span class="id">rewrite</span> (<span class="id">compA</span> (<span class="id">Join</span> <span class="id">\o</span> <span class="id">M</span> <span class="id">#</span> <span class="id">swap</span>)) <span class="id">-</span>(<span class="id">compA</span> <span class="id">Join</span>).<br/>
<span class="id">rewrite</span> (<span class="id">natural</span> <span class="id">join</span>).<br/>
<span class="id">rewrite</span> (<span class="id">compA</span> <span class="id">Join</span> <span class="id">Join</span>) <span class="id">-joinA</span>.<br/>
<span class="id">rewrite</span> <span class="id">-2![LHS]compA</span> <span class="id">FCompE</span>.<br/>
<span class="id">rewrite</span> <span class="id">-</span>(<span class="id">@functor_o</span> <span class="id">M</span>) <span class="id">-</span>(<span class="id">@functor_o</span> <span class="id">M</span>).<br/>
<span class="id">rewrite</span> (<span class="id">compA</span> <span class="id">Join</span> (<span class="id">M</span> <span class="id">#</span> <span class="id">swap</span>) <span class="id">prod</span>) <span class="id">-/dorp</span> <span class="id">-Hswap4</span> <span class="id">functor_o</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">[LHS]compA</span> <span class="id">-JOINE</span> <span class="id">JOIN_dorp</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">Lemma</span> <span class="id">JOIN_naturality</span> <span class="id">:</span> <span class="id">@naturality</span> <span class="id">_</span> <span class="id">_</span> (<span class="id">JOIN</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof21')">Proof.</span></div>
<div class="proofscript" id="proof21">
 <span class="gallina-kwd">by</span> <span class="id">move=&gt;</span> <span class="id">??</span> <span class="id">g;</span> <span class="id">rewrite</span> <span class="id">JOINE</span> <span class="id">-/prod</span> (<span class="id">Prod.JOIN_naturality</span> <span class="id">prod1</span> <span class="id">g</span>) <span class="id">JOINE</span>. Qed.</div>
<br/>
<span class="id">HB.instance</span> <span class="vernacular">Definition</span> <span class="id">_</span> <span class="id">:=</span> <span class="id">isNatural.Build</span><br/>
&nbsp;&nbsp;<span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> ((<span class="id">M</span> <span class="id">\o</span> <span class="id">N</span>) <span class="id">\o</span> (<span class="id">M</span> <span class="id">\o</span> <span class="id">N</span>))<span class="id">]</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> (<span class="id">M</span> <span class="id">\o</span> <span class="id">N</span>)<span class="id">]</span> (<span class="id">@JOIN</span>) <span class="id">JOIN_naturality</span>.<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">JOIN'</span> <span class="id">:</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> (<span class="id">M</span> <span class="id">\o</span> <span class="id">N</span>) <span class="id">\o</span> (<span class="id">M</span> <span class="id">\o</span> <span class="id">N</span>)<span class="id">]</span> <span class="id">~&gt;</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">M</span> <span class="id">\o</span> <span class="id">N]</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="id">[the</span> <span class="id">_</span> <span class="id">~&gt;</span> <span class="id">_</span> <span class="id">of</span> (<span class="id">@JOIN</span>)<span class="id">]</span>.<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">JOIN_ret</span> <span class="id">:</span> <span class="id">JoinLaws.left_unit</span> (<span class="id">@CRet</span> <span class="id">M</span> <span class="id">N</span>) (<span class="id">@JOIN'</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof22')">Proof.</span></div>
<div class="proofscript" id="proof22">
<span class="id">move=&gt;</span> <span class="id">A</span>.<br/>
<span class="id">rewrite</span> <span class="id">[JOIN'</span> <span class="id">_]/=</span>.<br/>
<span class="id">rewrite</span> <span class="id">JOINE</span> <span class="id">-/prod</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> (<span class="id">Prod.JOIN_ret</span> <span class="id">prod1</span> <span class="id">prod2</span>).<br/>
Qed.</div>
<br/>
<span class="vernacular">Lemma</span> <span class="id">JOIN_fmap_ret</span> <span class="id">:</span> <span class="id">JoinLaws.right_unit</span> (<span class="id">@CRet</span> <span class="id">M</span> <span class="id">N</span>) (<span class="id">@JOIN'</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof23')">Proof.</span></div>
<div class="proofscript" id="proof23">
<span class="id">move=&gt;</span> <span class="id">A</span>.<br/>
<span class="id">rewrite</span> <span class="id">[JOIN'</span> <span class="id">_]/=</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">JOINE</span> <span class="id">-/prod</span> (<span class="id">Prod.JOIN_fmap_ret</span> <span class="id">prod1</span> <span class="id">prod3</span>).<br/>
Qed.</div>
<br/>
<span class="vernacular">Lemma</span> <span class="id">JOIN_fmap_JOIN</span> <span class="id">:</span> <span class="id">JoinLaws.associativity</span> (<span class="id">@JOIN'</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof24')">Proof.</span></div>
<div class="proofscript" id="proof24">
<span class="id">move=&gt;</span> <span class="id">A</span>.<br/>
<span class="id">rewrite</span> <span class="id">[JOIN'</span> <span class="id">_]/=</span>.<br/>
<span class="id">rewrite</span> <span class="id">[X</span> <span class="gallina-kwd">in</span> <span class="id">_</span> <span class="id">=</span> <span class="id">_</span> <span class="id">\o</span> <span class="id">X]/=</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">!JOINE</span> <span class="id">-!/prod</span> (<span class="id">Prod.JOIN_fmap_JOIN</span> <span class="id">prod1</span> <span class="id">prod4</span>).<br/>
Qed.</div>
<br/>
<span class="vernacular">End</span> <span class="id">swap</span>.<br/>
<span class="vernacular">End</span> <span class="id">Swap</span>.<br/>
<br/>
<br/>
<span class="vernacular">Section</span> <span class="id">nattrans_cast_lemmas</span>.<br/>
<span class="vernacular">Variables</span> (<span class="id">F</span> <span class="id">G</span> <span class="id">:</span> <span class="id">functor</span>).<br/>
<span class="vernacular">Lemma</span> <span class="id">IV</span> <span class="id">:</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">idfun</span> <span class="id">\o</span> <span class="id">G]</span> <span class="id">~&gt;</span> <span class="id">F</span> <span class="id">-&gt;</span> <span class="id">G</span> <span class="id">~&gt;</span> <span class="id">F</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof25')">Proof.</span></div>
<div class="proofscript" id="proof25">
<span class="id">move=&gt;</span> <span class="id">[s</span> <span class="id">[]</span> <span class="id">[GFs]]</span>.<br/>
<span class="id">apply:</span> (<span class="id">@Nattrans</span>.<span class="id">Pack</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">G]</span> <span class="id">F</span> <span class="id">_</span> (<span class="id">Nattrans.Class</span> (<span class="id">isNatural.Axioms_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>))).<br/>
<span class="id">exact:</span> <span class="id">GFs</span>.<br/>
Qed.</div>
<span class="vernacular">Lemma</span> <span class="id">VI</span> <span class="id">:</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">G</span> <span class="id">\o</span> <span class="id">idfun]</span> <span class="id">~&gt;</span> <span class="id">F</span> <span class="id">-&gt;</span> <span class="id">G</span> <span class="id">~&gt;</span> <span class="id">F</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof26')">Proof.</span></div>
<div class="proofscript" id="proof26">
<span class="id">move=&gt;</span> <span class="id">[s</span> <span class="id">[]</span> <span class="id">[GFs]]</span>.<br/>
<span class="id">apply:</span> (<span class="id">@Nattrans</span>.<span class="id">Pack</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">G]</span> <span class="id">F</span> <span class="id">_</span> (<span class="id">Nattrans.Class</span> (<span class="id">isNatural.Axioms_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>))).<br/>
<span class="id">exact:</span> <span class="id">GFs</span>.<br/>
Qed.</div>
<span class="vernacular">Variable</span> <span class="id">K</span> <span class="id">J</span> <span class="id">:</span> <span class="id">functor</span>.<br/>
<span class="vernacular">Lemma</span> <span class="id">AV</span> <span class="id">:</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">G</span> <span class="id">\o</span> <span class="id">K</span> <span class="id">\o</span> <span class="id">J]</span> <span class="id">~&gt;</span> <span class="id">F</span> <span class="id">-&gt;</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">G</span> <span class="id">\o</span> (<span class="id">K</span> <span class="id">\o</span> <span class="id">J</span>)<span class="id">]</span> <span class="id">~&gt;</span> <span class="id">F</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof27')">Proof.</span></div>
<div class="proofscript" id="proof27">
<span class="id">move=&gt;</span> <span class="id">[s</span> <span class="id">[]</span> <span class="id">[GFs]]</span>.<br/>
<span class="id">apply:</span> (<span class="id">@Nattrans</span>.<span class="id">Pack</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> (<span class="id">G</span> <span class="id">\o</span> (<span class="id">K</span> <span class="id">\o</span> <span class="id">J</span>))<span class="id">]</span> <span class="id">F</span> <span class="id">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Nattrans.Class</span> (<span class="id">isNatural.Axioms_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>))).<br/>
<span class="id">exact:</span> <span class="id">GFs</span>.<br/>
Qed.</div>
<span class="vernacular">Lemma</span> <span class="id">AV'</span> <span class="id">:</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">G</span> <span class="id">\o</span> (<span class="id">K</span> <span class="id">\o</span> <span class="id">J</span>)<span class="id">]</span> <span class="id">~&gt;</span> <span class="id">F</span> <span class="id">-&gt;</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">G</span> <span class="id">\o</span> <span class="id">K</span> <span class="id">\o</span> <span class="id">J]</span> <span class="id">~&gt;</span> <span class="id">F</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof28')">Proof.</span></div>
<div class="proofscript" id="proof28">
<span class="id">move=&gt;</span> <span class="id">[s</span> <span class="id">[]</span> <span class="id">[GFs]]</span>.<br/>
<span class="id">apply:</span> (<span class="id">@Nattrans</span>.<span class="id">Pack</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> (<span class="id">G</span> <span class="id">\o</span> <span class="id">K</span> <span class="id">\o</span> <span class="id">J</span>)<span class="id">]</span> <span class="id">F</span> <span class="id">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Nattrans.Class</span> (<span class="id">isNatural.Axioms_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>))).<br/>
<span class="id">exact:</span> <span class="id">GFs</span>.<br/>
Qed.</div>
<span class="vernacular">Lemma</span> <span class="id">VA</span> <span class="id">:</span> <span class="id">F</span> <span class="id">~&gt;</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">G</span> <span class="id">\o</span> <span class="id">K</span> <span class="id">\o</span> <span class="id">J]</span> <span class="id">-&gt;</span> <span class="id">F</span> <span class="id">~&gt;</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">G</span> <span class="id">\o</span> (<span class="id">K</span> <span class="id">\o</span> <span class="id">J</span>)<span class="id">]</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof29')">Proof.</span></div>
<div class="proofscript" id="proof29">
<span class="id">move=&gt;</span> <span class="id">[s</span> <span class="id">[]</span> <span class="id">[GFs]]</span>.<br/>
<span class="id">apply:</span> (<span class="id">@Nattrans</span>.<span class="id">Pack</span> <span class="id">F</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> (<span class="id">G</span> <span class="id">\o</span> (<span class="id">K</span> <span class="id">\o</span> <span class="id">J</span>))<span class="id">]</span> <span class="id">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Nattrans.Class</span> (<span class="id">isNatural.Axioms_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>))).<br/>
<span class="id">exact:</span> <span class="id">GFs</span>.<br/>
Qed.</div>
<span class="vernacular">Lemma</span> <span class="id">VA'</span> <span class="id">:</span> <span class="id">F</span> <span class="id">~&gt;</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">G</span> <span class="id">\o</span> (<span class="id">K</span> <span class="id">\o</span> <span class="id">J</span>)<span class="id">]</span> <span class="id">-&gt;</span> <span class="id">F</span> <span class="id">~&gt;</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">G</span> <span class="id">\o</span> <span class="id">K</span> <span class="id">\o</span> <span class="id">J]</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof30')">Proof.</span></div>
<div class="proofscript" id="proof30">
<span class="id">move=&gt;</span> <span class="id">[s</span> <span class="id">[]</span> <span class="id">[GFs]]</span>.<br/>
<span class="id">apply:</span> (<span class="id">@Nattrans</span>.<span class="id">Pack</span> <span class="id">F</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> (<span class="id">G</span> <span class="id">\o</span> <span class="id">K</span>) <span class="id">\o</span> <span class="id">J]</span> <span class="id">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Nattrans.Class</span> (<span class="id">isNatural.Axioms_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>))).<br/>
<span class="id">exact:</span> <span class="id">GFs</span>.<br/>
Qed.</div>
<span class="vernacular">End</span> <span class="id">nattrans_cast_lemmas</span>.<br/>
<br/>
<span class="vernacular">Module</span> <span class="id">DistributiveLaw</span>.<br/>
<span class="vernacular">Section</span> <span class="id">distributivelaw</span>.<br/>
<span class="vernacular">Variables</span> <span class="id">S</span> <span class="id">T</span> <span class="id">:</span> <span class="id">monad</span>.<br/>
<span class="vernacular">Record</span> <span class="id">t</span> <span class="id">:=</span> <span class="id">mk</span> <span class="id">{</span><br/>
&nbsp;&nbsp;<span class="id">f</span> <span class="id">:</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">S</span> <span class="id">\o</span> <span class="id">T]</span> <span class="id">~&gt;</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">T</span> <span class="id">\o</span> <span class="id">S]</span> <span class="id">;</span><br/>
&nbsp;&nbsp;<span class="id">unit1</span> <span class="id">:</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">IV</span> (<span class="id">f</span> <span class="id">\v</span> (<span class="id">@ret</span> <span class="id">S</span> <span class="id">\h</span> <span class="id">NId</span> <span class="id">T</span>)) <span class="id">=</span> <span class="id">VI</span> (<span class="id">NId</span> <span class="id">T</span> <span class="id">\h</span> <span class="id">@ret</span> <span class="id">S</span>) <span class="id">;</span><br/>
&nbsp;&nbsp;<span class="id">unit2</span> <span class="id">:</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">VI</span> (<span class="id">f</span> <span class="id">\v</span> (<span class="id">NId</span> <span class="id">S</span> <span class="id">\h</span> <span class="id">@ret</span> <span class="id">T</span>)) <span class="id">=</span> <span class="id">IV</span> (<span class="id">@ret</span> <span class="id">T</span> <span class="id">\h</span> <span class="id">NId</span> <span class="id">S</span>) <span class="id">;</span><br/>
&nbsp;&nbsp;<span class="id">multiplication1</span> <span class="id">:</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">AV</span> (<span class="id">f</span> <span class="id">\v</span> (<span class="id">@join</span> <span class="id">S</span> <span class="id">\h</span> <span class="id">NId</span> <span class="id">T</span>)) <span class="id">=</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">NId</span> <span class="id">T</span> <span class="id">\h</span> <span class="id">@join</span> <span class="id">S</span>) <span class="id">\v</span> <span class="id">VA</span> ((<span class="id">f</span> <span class="id">\h</span> <span class="id">NId</span> <span class="id">S</span>) <span class="id">\v</span> <span class="id">VA'</span> (<span class="id">NId</span> <span class="id">S</span> <span class="id">\h</span> <span class="id">f</span>)) <span class="id">;</span><br/>
&nbsp;&nbsp;<span class="id">multiplication2</span> <span class="id">:</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">AV'</span> (<span class="id">f</span> <span class="id">\v</span> (<span class="id">NId</span> <span class="id">S</span> <span class="id">\h</span> <span class="id">@join</span> <span class="id">T</span>)) <span class="id">=</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">@join</span> <span class="id">T</span> <span class="id">\h</span> <span class="id">NId</span> <span class="id">S</span>) <span class="id">\v</span> <span class="id">VA'</span> ((<span class="id">NId</span> <span class="id">T</span> <span class="id">\h</span> <span class="id">f</span>) <span class="id">\v</span> <span class="id">VA</span> (<span class="id">f</span> <span class="id">\h</span> <span class="id">NId</span> <span class="id">T</span>))<br/>
<span class="id">}</span>.<br/>
<span class="vernacular">End</span> <span class="id">distributivelaw</span>.<br/>
<span class="vernacular">End</span> <span class="id">DistributiveLaw</span>.<br/>
<span class="vernacular">Coercion</span> <span class="id">DistributiveLaw.f</span> <span class="id">:</span> <span class="id">DistributiveLaw.t</span> <span class="id">&gt;-&gt;</span> <span class="id">nattrans</span>.<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">beck</span> (<span class="id">S</span> <span class="id">T</span> <span class="id">:</span> <span class="id">monad</span>) (<span class="id">f</span> <span class="id">:</span> <span class="id">DistributiveLaw.t</span> <span class="id">S</span> <span class="id">T</span>) <span class="id">:</span> <span class="id">monad</span>.<br/>
<span class="id">have</span> <span class="id">@join</span> <span class="id">:</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> (<span class="id">T</span> <span class="id">\o</span> <span class="id">S</span>) <span class="id">\o</span> (<span class="id">T</span> <span class="id">\o</span> <span class="id">S</span>)<span class="id">]</span> <span class="id">~&gt;</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">T</span> <span class="id">\o</span> <span class="id">S]</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">VComp</span> ((<span class="id">@join</span> <span class="id">T</span>) <span class="id">\h</span> (<span class="id">@join</span> <span class="id">S</span>)) <span class="id">_</span>).<br/>
&nbsp;&nbsp;<span class="id">apply:</span> <span class="id">VA</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> <span class="id">AV</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> <span class="id">HComp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span> <span class="id">NId</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> <span class="id">VA'</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> <span class="id">AV'</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> <span class="id">HComp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span> <span class="id">f</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span> <span class="id">NId</span>.<br/>
<span class="id">apply:</span> (<span class="id">Monad.Pack</span> (<span class="id">Monad.Class</span> (<span class="id">isMonad.Axioms_</span> (<span class="id">CRet</span> <span class="id">T</span> <span class="id">S</span>) <span class="id">join</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>))).<br/>
<span class="id">move=&gt;</span> <span class="id">A</span>.<br/>
<span class="id">rewrite</span> <span class="id">/join</span>.<br/>
Abort.</div>

</div>
<div class="footer"><hr/>Generated by <a href="https://github.com/yoshihiro503/coq2html/">a fork of coq2html</a></div>
</body>
</html>
