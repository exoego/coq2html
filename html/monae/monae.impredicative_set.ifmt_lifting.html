
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module monae.impredicative_set.ifmt_lifting</title>
<meta name="description" content="Documentation of Coq module monae.impredicative_set.ifmt_lifting" />
<link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
<script src="https://cdn.jsdelivr.net/npm/markdown-it/dist/markdown-it.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/markdown-it-texmath/texmath.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script>
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="init('proofscript')">

  <main>
    <div class="sidebar">
      <h2>Files</h2>
      <li><details id="monae"><summary>monae</summary>
          <ul>
          <li><a href="monae.altprob_model.html">altprob_model</a></li>
<li><a href="monae.array_lib.html">array_lib</a></li>
<li><a href="monae.category.html">category</a></li>
<li><a href="monae.category_ext.html">category_ext</a></li>
<li><a href="monae.example_iquicksort.html">example_iquicksort</a></li>
<li><a href="monae.example_monty.html">example_monty</a></li>
<li><a href="monae.example_nqueens.html">example_nqueens</a></li>
<li><a href="monae.example_quicksort.html">example_quicksort</a></li>
<li><a href="monae.example_relabeling.html">example_relabeling</a></li>
<li><a href="monae.example_spark.html">example_spark</a></li>
<li><a href="monae.example_transformer.html">example_transformer</a></li>
<li><a href="monae.example_typed_store.html">example_typed_store</a></li>
<li><a href="monae.fail_lib.html">fail_lib</a></li>
<li><a href="monae.gcm_model.html">gcm_model</a></li>
<li><a href="monae.hierarchy.html">hierarchy</a></li>
<li><a href="monae.monad_composition.html">monad_composition</a></li>
<li><a href="monae.monad_lib.html">monad_lib</a></li>
<li><a href="monae.monad_model.html">monad_model</a></li>
<li><a href="monae.monad_transformer.html">monad_transformer</a></li>
<li><a href="monae.monae_lib.html">monae_lib</a></li>
<li><a href="monae.proba_lib.html">proba_lib</a></li>
<li><a href="monae.proba_monad_model.html">proba_monad_model</a></li>
<li><a href="monae.smallstep.html">smallstep</a></li>
<li><a href="monae.state_lib.html">state_lib</a></li>
<li><a href="monae.trace_lib.html">trace_lib</a></li>
<li><a href="monae.typed_store_lib.html">typed_store_lib</a></li>
<li><a href="monae.typed_store_model.html">typed_store_model</a></li>
          </ul>
          </details>
          </li>
<li><details id="monaeImpredicativeSet"><summary>monaeImpredicativeSet</summary>
          <ul>
          <li><a href="monaeImpredicativeSet.ifail_lib.html">ifail_lib</a></li>
<li><a href="monaeImpredicativeSet.ihierarchy.html">ihierarchy</a></li>
<li><a href="monaeImpredicativeSet.imonad_composition.html">imonad_composition</a></li>
<li><a href="monaeImpredicativeSet.imonad_lib.html">imonad_lib</a></li>
<li><a href="monaeImpredicativeSet.imonae_lib.html">imonae_lib</a></li>
          </ul>
          </details>
          </li>
    </div>

  <div class="coq">

    <div class="content">
      <p><a href="./index.html">Top</a></p>
      <h1 class="title">Module monae.impredicative_set.ifmt_lifting</h1>
<span class="vernacular">From</span> <span class="id">mathcomp</span> <span class="vernacular">Require</span> <span class="vernacular">Import</span> <span class="id">all_ssreflect</span>.<br/>
<span class="vernacular">From</span> <span class="id">HB</span> <span class="vernacular">Require</span> <span class="vernacular">Import</span> <span class="id">structures</span>.<br/>
<span class="vernacular">Require</span> <span class="vernacular">Import</span> <span class="id">imonae_lib</span> <span class="id">ihierarchy</span> <span class="id">imonad_lib</span> <span class="id">imonad_transformer</span>.<br/>
<br/>
<pre class="ssrdoc">
  Uniform Lifting of Sigma-operations Along Functorial Monad Transformers  
                                                                           
This file corresponds to the formalization of [Mauro Jaskelioff,           
Modular Monad Transformers, ESOP 2009] (from Sect. 5, definition 23).      
                                                                           
           codensityT == codensity monad transformer                       
             slifting == definition of a sigma-operation using a           
                         sigma-operation and a functorial monad            
                         transformer                                       
uniform_sigma_lifting == Theorem: given a functorial monad transformer t,  
                         slifting is a lifting along Lift t                
      slifting_stateT == lifting of a sigma-operation along stateT         
     slifting_exceptT == lifting of a sigma-operation along exceptT        
        slifting_envT == lifting of a sigma-operation along envT           
     slifting_outputT == lifting of a sigma-operation along outputT        
  slifting_alifting_* == Lemmas: slifting and alifting of algebraic        
                         operations coincide                               
             local_*E == Lemmas: liftings of local                         
            handle_*E == Lemmas: liftings of handle                        
             flush_*E == Lemmas: liftings of flush                         
</pre>
<br/>
<span class="gallina-kwd">Set</span> <span class="vernacular">Implicit</span> <span class="vernacular">Arguments</span>.<br/>
<span class="vernacular">Unset</span> <span class="vernacular">Strict</span> <span class="vernacular">Implicit</span>.<br/>
<span class="vernacular">Unset</span> <span class="vernacular">Printing</span> <span class="vernacular">Implicit</span> <span class="vernacular">Defensive</span>.<br/>
<br/>
<span class="vernacular">Local</span> <span class="vernacular">Open</span> <span class="vernacular">Scope</span> <span class="id">monae_scope</span>.<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">MK</span> (<span class="id">m</span> <span class="id">:</span> <span class="id">UU0</span> <span class="id">-&gt;</span> <span class="id">UU0</span>) (<span class="id">A</span> <span class="id">:</span> <span class="id">UU0</span>) <span class="id">:=</span> <span class="gallina-kwd">forall</span> (<span class="id">B</span> <span class="id">:</span> <span class="id">UU0</span>)<span class="id">,</span> (<span class="id">A</span> <span class="id">-&gt;</span> <span class="id">m</span> <span class="id">B</span>) <span class="id">-&gt;</span> <span class="id">m</span> <span class="id">B</span>.<br/>
<br/>
<span class="vernacular">Section</span> <span class="id">codensity</span>.<br/>
<span class="vernacular">Variable</span> (<span class="id">M</span> <span class="id">:</span> <span class="id">monad</span>).<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">retK</span> <span class="id">:</span> <span class="id">FId</span> <span class="id">~~&gt;</span> <span class="id">MK</span> <span class="id">M</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">fun</span> (<span class="id">A</span> <span class="id">:</span> <span class="id">UU0</span>) (<span class="id">a</span> <span class="id">:</span> <span class="id">A</span>) (<span class="id">B</span> <span class="id">:</span> <span class="id">UU0</span>) (<span class="id">k</span> <span class="id">:</span> <span class="id">A</span> <span class="id">-&gt;</span> <span class="id">M</span> <span class="id">B</span>) <span class="id">=&gt;</span> <span class="id">k</span> <span class="id">a</span>.<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">bindK</span> (<span class="id">A</span> <span class="id">B</span> <span class="id">:</span> <span class="id">UU0</span>) (<span class="id">m</span> <span class="id">:</span> <span class="id">MK</span> <span class="id">M</span> <span class="id">A</span>) <span class="id">f</span> <span class="id">:</span> <span class="id">MK</span> <span class="id">M</span> <span class="id">B</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">fun</span> (<span class="id">C</span> <span class="id">:</span> <span class="id">UU0</span>) (<span class="id">k</span> <span class="id">:</span> <span class="id">B</span> <span class="id">-&gt;</span> <span class="id">M</span> <span class="id">C</span>) <span class="id">=&gt;</span> <span class="id">m</span> <span class="id">C</span> (<span class="gallina-kwd">fun</span> <span class="id">a</span> <span class="id">:</span> <span class="id">A</span> <span class="id">=&gt;</span> (<span class="id">f</span> <span class="id">a</span>) <span class="id">C</span> <span class="id">k</span>).<br/>
<br/>
<span class="vernacular">Let</span> <span class="id">left_neutral</span> <span class="id">:</span> <span class="id">BindLaws.left_neutral</span> <span class="id">bindK</span> <span class="id">retK</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof1')">Proof.</span></div>
<div class="proofscript" id="proof1">
<span class="gallina-kwd">by</span> <span class="id">move=&gt;</span> <span class="id">A</span> <span class="id">B</span> <span class="id">a</span> <span class="id">f;</span> <span class="id">rewrite</span> <span class="id">/bindK</span> <span class="id">/=;</span> <span class="id">apply</span> <span class="id">funext_dep</span> <span class="id">=&gt;</span> <span class="id">C;</span> <span class="id">exact:</span> <span class="id">funext</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">Let</span> <span class="id">right_neutral</span> <span class="id">:</span> <span class="id">BindLaws.right_neutral</span> <span class="id">bindK</span> <span class="id">retK</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof2')">Proof.</span></div>
<div class="proofscript" id="proof2">
<span class="gallina-kwd">by</span> <span class="id">move=&gt;</span> <span class="id">A</span> <span class="id">m;</span> <span class="id">rewrite</span> <span class="id">/bindK</span> <span class="id">/retK;</span> <span class="id">apply</span> <span class="id">funext_dep</span> <span class="id">=&gt;</span> <span class="id">C;</span> <span class="id">exact:</span> <span class="id">funext</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">Lemma</span> <span class="id">associative</span> <span class="id">:</span> <span class="id">BindLaws.associative</span> <span class="id">bindK</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof3')">Proof.</span></div>
<div class="proofscript" id="proof3">
 <span class="gallina-kwd">by</span> <span class="id">move=&gt;</span> <span class="id">A</span> <span class="id">B</span> <span class="id">C</span> <span class="id">m</span> <span class="id">f</span> <span class="id">g;</span> <span class="id">rewrite</span> <span class="id">/bindK;</span> <span class="id">exact:</span> <span class="id">funext_dep</span>. Qed.</div>
<br/>
<span class="id">HB.instance</span> <span class="vernacular">Definition</span> <span class="id">_</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="id">isMonad_ret_bind.Build</span> (<span class="id">MK</span> <span class="id">M</span>) <span class="id">left_neutral</span> <span class="id">right_neutral</span> <span class="id">associative</span>.<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">liftK</span> <span class="id">:</span> <span class="id">M</span> <span class="id">~~&gt;</span> <span class="id">MK</span> <span class="id">M</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">fun</span> (<span class="id">A</span> <span class="id">:</span> <span class="id">UU0</span>) (<span class="id">m</span> <span class="id">:</span> <span class="id">M</span> <span class="id">A</span>) (<span class="id">B</span> <span class="id">:</span> <span class="id">UU0</span>) (<span class="id">k</span> <span class="id">:</span> <span class="id">A</span> <span class="id">-&gt;</span> <span class="id">M</span> <span class="id">B</span>) <span class="id">=&gt;</span> <span class="id">m</span> <span class="id">&gt;&gt;=</span> <span class="id">k</span>.<br/>
<br/>
<span class="vernacular">Let</span> <span class="id">retliftK</span> <span class="id">:</span> <span class="id">MonadMLaws.ret</span> <span class="id">liftK</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof4')">Proof.</span></div>
<div class="proofscript" id="proof4">
<span class="id">move=&gt;</span> <span class="id">A;</span> <span class="id">rewrite</span> <span class="id">/liftK/=</span> <span class="id">/retK/=;</span> <span class="id">apply</span> <span class="id">funext</span> <span class="id">=&gt;</span> <span class="id">a</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">apply</span> <span class="id">funext_dep</span> <span class="id">=&gt;</span> <span class="id">B</span> <span class="id">/=;</span> <span class="id">apply:</span> <span class="id">funext</span> <span class="id">=&gt;</span> <span class="id">b;</span> <span class="id">rewrite</span> <span class="id">bindretf</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">Let</span> <span class="id">bindliftK</span> <span class="id">:</span> <span class="id">MonadMLaws.bind</span> <span class="id">liftK</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof5')">Proof.</span></div>
<div class="proofscript" id="proof5">
<span class="id">move=&gt;</span> <span class="id">A</span> <span class="id">B</span> <span class="id">m</span> <span class="id">f;</span> <span class="id">rewrite</span> <span class="id">/liftK;</span> <span class="id">apply</span> <span class="id">funext_dep</span> <span class="id">=&gt;</span> <span class="id">C</span> <span class="id">/=</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">apply</span> <span class="id">funext</span> <span class="id">=&gt;</span> <span class="id">g;</span> <span class="id">rewrite</span> <span class="id">bindA</span>.<br/>
Qed.</div>
<br/>
<span class="id">HB.instance</span> <span class="vernacular">Definition</span> <span class="id">_</span> <span class="id">:=</span> <span class="id">isMonadM_ret_bind.Build</span><br/>
&nbsp;&nbsp;<span class="id">M</span> <span class="id">[the</span> <span class="id">monad</span> <span class="id">of</span> <span class="id">MK</span> <span class="id">M]</span> <span class="id">liftK</span> <span class="id">retliftK</span> <span class="id">bindliftK</span>.<br/>
<br/>
<span class="vernacular">End</span> <span class="id">codensity</span>.<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">codensityT</span> <span class="id">:=</span> <span class="gallina-kwd">fun</span> <span class="id">M</span> <span class="id">:</span> <span class="id">monad</span> <span class="id">=&gt;</span> <span class="id">[the</span> <span class="id">monad</span> <span class="id">of</span> <span class="id">MK</span> <span class="id">M]</span>.<br/>
<br/>
<span class="id">HB.instance</span> <span class="vernacular">Definition</span> <span class="id">_</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="id">isMonadT.Build</span> <span class="id">codensityT</span> (<span class="gallina-kwd">fun</span> <span class="id">M</span> <span class="id">=&gt;</span> <span class="id">[the</span> <span class="id">monadM</span> <span class="id">_</span> <span class="id">_</span> <span class="id">of</span> @<span class="id">liftK</span> <span class="id">M]</span>).<br/>
<br/>
<span class="vernacular">Section</span> <span class="id">kappa</span>.<br/>
<span class="vernacular">Variables</span> (<span class="id">M</span> <span class="id">:</span> <span class="id">monad</span>) (<span class="id">E</span> <span class="id">:</span> <span class="id">functor</span>) (<span class="id">op</span> <span class="id">:</span> <span class="id">E</span>.<span class="id">-operation</span> <span class="id">M</span>).<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">kappa'</span> <span class="id">:</span> <span class="id">E</span> <span class="id">~~&gt;</span> <span class="id">codensityT</span> <span class="id">M</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">fun</span> (<span class="id">A</span> <span class="id">:</span> <span class="id">UU0</span>) (<span class="id">s</span> <span class="id">:</span> <span class="id">E</span> <span class="id">A</span>) (<span class="id">B</span> <span class="id">:</span> <span class="id">UU0</span>) (<span class="id">k</span> <span class="id">:</span> <span class="id">A</span> <span class="id">-&gt;</span> <span class="id">M</span> <span class="id">B</span>) <span class="id">=&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">op</span> <span class="id">B</span> ((<span class="id">E</span> <span class="id">#</span> <span class="id">k</span>) <span class="id">s</span>).<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">naturality_kappa'</span> <span class="id">:</span> <span class="id">naturality</span> <span class="id">_</span> <span class="id">_</span> <span class="id">kappa'</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof6')">Proof.</span></div>
<div class="proofscript" id="proof6">
<span class="id">move=&gt;</span> <span class="id">A</span> <span class="id">B</span> <span class="id">h;</span> <span class="id">rewrite</span> <span class="id">/kappa';</span> <span class="id">apply</span> <span class="id">funext</span> <span class="id">=&gt;</span> <span class="id">ea;</span> <span class="id">rewrite</span> <span class="id">[in</span> <span class="id">RHS]/=</span>.<br/>
<span class="id">transitivity</span> (<span class="gallina-kwd">fun</span> <span class="id">B0</span> (<span class="id">k</span> <span class="id">:</span> <span class="id">B</span> <span class="id">-&gt;</span> <span class="id">M</span> <span class="id">B0</span>) <span class="id">=&gt;</span> <span class="id">op</span> <span class="id">B0</span> ((<span class="id">E</span> <span class="id">#</span> (<span class="id">k</span> <span class="id">\o</span> <span class="id">h</span>)) <span class="id">ea</span>)) <span class="id">=&gt;</span> <span class="id">//</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">apply</span> <span class="id">funext_dep</span> <span class="id">=&gt;</span> <span class="id">C;</span> <span class="id">apply</span> <span class="id">funext</span> <span class="id">=&gt;</span> <span class="id">D;</span> <span class="id">rewrite</span> <span class="id">functor_o</span>.<br/>
Qed.</div>
<br/>
<span class="id">HB.instance</span> <span class="vernacular">Definition</span> <span class="id">_</span> <span class="id">:=</span> <span class="id">isNatural.Build</span><br/>
&nbsp;&nbsp;<span class="id">_</span> (<span class="id">codensityT</span> <span class="id">M</span>) <span class="id">kappa'</span> <span class="id">naturality_kappa'</span>.<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">kappa</span> <span class="id">:=</span> <span class="id">[the</span> <span class="id">_</span> <span class="id">~&gt;</span> <span class="id">_</span> <span class="id">of</span> <span class="id">kappa']</span>.<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">kappaE</span> <span class="id">X</span> <span class="id">:</span> <span class="id">kappa</span> <span class="id">X</span> <span class="id">=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">fun</span> (<span class="id">s</span> <span class="id">:</span> <span class="id">E</span> <span class="id">X</span>) (<span class="id">B</span> <span class="id">:</span> <span class="id">UU0</span>) (<span class="id">k</span> <span class="id">:</span> <span class="id">X</span> <span class="id">-&gt;</span> <span class="id">M</span> <span class="id">B</span>) <span class="id">=&gt;</span> <span class="id">op</span> <span class="id">B</span> ((<span class="id">E</span> <span class="id">#</span> <span class="id">k</span>) <span class="id">s</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof7')">Proof.</span></div>
<div class="proofscript" id="proof7">
 <span class="gallina-kwd">by</span> <span class="id">[]</span>. Qed.</div>
<br/>
<span class="vernacular">End</span> <span class="id">kappa</span>.<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">naturality_MK</span> (<span class="id">M</span> <span class="id">:</span> <span class="id">functor</span>) (<span class="id">A</span> <span class="id">:</span> <span class="id">UU0</span>) (<span class="id">m</span> <span class="id">:</span> <span class="id">MK</span> <span class="id">M</span> <span class="id">A</span>) <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="id">naturality</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">exponential_F</span> <span class="id">A</span> <span class="id">\o</span> <span class="id">M]</span> <span class="id">M</span> <span class="id">m</span>.<br/>
<br/>
<span class="vernacular">Section</span> <span class="id">from</span>.<br/>
<span class="vernacular">Variables</span> (<span class="id">M</span> <span class="id">:</span> <span class="id">monad</span>).<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">from_component</span> <span class="id">:</span> <span class="id">codensityT</span> <span class="id">M</span> <span class="id">~~&gt;</span> <span class="id">M</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">fun</span> (<span class="id">A</span> <span class="id">:</span> <span class="id">UU0</span>) (<span class="id">c</span> <span class="id">:</span> <span class="id">codensityT</span> <span class="id">M</span> <span class="id">A</span>) <span class="id">=&gt;</span> <span class="id">c</span> <span class="id">A</span> <span class="id">Ret</span>.<br/>
<br/>
<span class="vernacular">Hypothesis</span> <span class="id">naturality_MK</span> <span class="id">:</span> <span class="gallina-kwd">forall</span> (<span class="id">A</span> <span class="id">:</span> <span class="id">UU0</span>) (<span class="id">m</span> <span class="id">:</span> <span class="id">MK</span> <span class="id">M</span> <span class="id">A</span>)<span class="id">,</span><br/>
&nbsp;&nbsp;<span class="id">naturality_MK</span> <span class="id">m</span>.<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">natural_from_component</span> <span class="id">:</span> <span class="id">naturality</span> (<span class="id">codensityT</span> <span class="id">M</span>) <span class="id">M</span> <span class="id">from_component</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof8')">Proof.</span></div>
<div class="proofscript" id="proof8">
<span class="id">move=&gt;</span> <span class="id">A</span> <span class="id">B</span> <span class="id">h;</span> <span class="id">apply</span> <span class="id">funext</span> <span class="id">=&gt;</span> <span class="id">m</span> <span class="id">/=</span>.<br/>
<span class="id">rewrite</span> <span class="id">[RHS]</span>(<span class="id">_</span> <span class="id">:</span> <span class="id">_</span> <span class="id">=</span> <span class="id">m</span> <span class="id">B</span> (<span class="id">Ret</span> <span class="id">\o</span> <span class="id">h</span>)) <span class="id">//</span>. <span class="comment">(*&nbsp;by&nbsp;definition&nbsp;of&nbsp;from&nbsp;*)</span><br/>
<span class="id">rewrite</span> <span class="id">-natural</span>.<br/>
<span class="id">rewrite</span> <span class="id">[LHS]</span>(<span class="id">_</span> <span class="id">:</span> <span class="id">_</span> <span class="id">=</span> (<span class="id">M</span> <span class="id">#</span> <span class="id">h</span> <span class="id">\o</span> <span class="id">m</span> <span class="id">A</span>) <span class="id">Ret</span>) <span class="id">//</span>. <span class="comment">(*&nbsp;by&nbsp;definition&nbsp;of&nbsp;from&nbsp;*)</span><br/>
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">naturality_MK</span>.<br/>
Qed.</div>
<br/>
<span class="id">HB.instance</span> <span class="vernacular">Definition</span> <span class="id">_</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="id">isNatural.Build</span> <span class="id">_</span> <span class="id">M</span> <span class="id">from_component</span> <span class="id">natural_from_component</span>.<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">from</span> <span class="id">:=</span> <span class="id">[the</span> <span class="id">_</span> <span class="id">~&gt;</span> <span class="id">_</span> <span class="id">of</span> <span class="id">from_component]</span>.<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">from_component_liftK</span> <span class="id">A</span> <span class="id">:</span><br/>
&nbsp;&nbsp;@<span class="id">from_component</span> <span class="id">A</span> <span class="id">\o</span> <span class="id">Lift</span> <span class="id">[the</span> <span class="id">monadT</span> <span class="id">of</span> <span class="id">codensityT]</span> <span class="id">M</span> <span class="id">A</span> <span class="id">=</span> <span class="id">id</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof9')">Proof.</span></div>
<div class="proofscript" id="proof9">
<span class="gallina-kwd">by</span> <span class="id">apply</span> <span class="id">funext</span> <span class="id">=&gt;</span> <span class="id">m</span> <span class="id">/=;</span> <span class="id">rewrite</span> <span class="id">/from_component/=</span> <span class="id">/liftK</span> <span class="id">/=</span> <span class="id">bindmret</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">End</span> <span class="id">from</span>.<br/>
<br/>
<span class="vernacular">Section</span> <span class="id">psi_kappa</span>.<br/>
<span class="vernacular">Variables</span> (<span class="id">E</span> <span class="id">:</span> <span class="id">functor</span>) (<span class="id">M</span> <span class="id">:</span> <span class="id">monad</span>) (<span class="id">op</span> <span class="id">:</span> <span class="id">E</span>.<span class="id">-operation</span> <span class="id">M</span>).<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">psik</span> <span class="id">:</span> <span class="id">E</span>.<span class="id">-aoperation</span> (<span class="id">codensityT</span> <span class="id">M</span>) <span class="id">:=</span> <span class="id">psi</span> (<span class="id">kappa</span> <span class="id">op</span>).<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">psikE</span> (<span class="id">A</span> <span class="id">:</span> <span class="id">UU0</span>) <span class="id">:</span> <span class="id">op</span> <span class="id">A</span> <span class="id">=</span> (@<span class="id">from_component</span> <span class="id">M</span> <span class="id">A</span>) <span class="id">\o</span> (@<span class="id">psik</span> <span class="id">A</span>) <span class="id">\o</span><br/>
&nbsp;&nbsp;((<span class="id">E</span> <span class="id">##</span> <span class="id">Lift</span> <span class="id">[the</span> <span class="id">monadT</span> <span class="id">of</span> <span class="id">codensityT]</span> <span class="id">M</span>) <span class="id">A</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof10')">Proof.</span></div>
<div class="proofscript" id="proof10">
<span class="id">apply</span> <span class="id">funext</span> <span class="id">=&gt;</span> <span class="id">m</span> <span class="id">/=</span>.<br/>
<span class="id">rewrite</span> <span class="id">/from_component</span> <span class="id">/psik</span> <span class="id">/=</span> <span class="id">/psi'</span> <span class="id">/kappa'</span> <span class="id">/fun_app_nt</span> <span class="id">/=</span>.<br/>
<span class="id">rewrite</span> <span class="id">/bindK</span> <span class="id">/=</span>.<br/>
<span class="id">rewrite</span> <span class="id">-[in</span> <span class="id">RHS]compE</span>.<br/>
<span class="id">rewrite</span> <span class="id">-[in</span> <span class="id">RHS]compE</span>.<br/>
<span class="id">rewrite</span> <span class="id">-compA</span>.<br/>
<span class="id">rewrite</span> <span class="id">-functor_o</span>.<br/>
<span class="id">rewrite</span> <span class="id">from_component_liftK</span>.<br/>
<span class="id">rewrite</span> <span class="id">functor_id</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">compfid</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">End</span> <span class="id">psi_kappa</span>.<br/>
<br/>
<span class="vernacular">Section</span> <span class="id">uniform_sigma_lifting</span>.<br/>
<span class="vernacular">Variables</span> (<span class="id">E</span> <span class="id">:</span> <span class="id">functor</span>) (<span class="id">M</span> <span class="id">:</span> <span class="id">monad</span>) (<span class="id">op</span> <span class="id">:</span> <span class="id">E</span>.<span class="id">-operation</span> <span class="id">M</span>) (<span class="id">t</span> <span class="id">:</span> <span class="id">fmt</span>).<br/>
<span class="vernacular">Hypothesis</span> <span class="id">naturality_MK</span> <span class="id">:</span> <span class="gallina-kwd">forall</span> (<span class="id">A</span> <span class="id">:</span> <span class="id">UU0</span>) (<span class="id">m</span> <span class="id">:</span> <span class="id">MK</span> <span class="id">M</span> <span class="id">A</span>)<span class="id">,</span> <span class="id">naturality_MK</span> <span class="id">m</span>.<br/>
<br/>
<span class="vernacular">Let</span> <span class="id">op1</span> <span class="id">:</span> <span class="id">t</span> (<span class="id">codensityT</span> <span class="id">M</span>) <span class="id">~&gt;</span> <span class="id">t</span> <span class="id">M</span> <span class="id">:=</span> <span class="id">hmap</span> <span class="id">t</span> (<span class="id">from</span> <span class="id">naturality_MK</span>).<br/>
<span class="vernacular">Let</span> <span class="id">op2</span> <span class="id">:=</span> <span class="id">alifting</span> (<span class="id">psik</span> <span class="id">op</span>) (<span class="id">Lift</span> <span class="id">t</span> <span class="id">_</span>).<br/>
<span class="vernacular">Let</span> <span class="id">op3</span> <span class="id">:</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">E</span> <span class="id">\o</span> <span class="id">t</span> <span class="id">M]</span> <span class="id">~&gt;</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">E</span> <span class="id">\o</span> <span class="id">t</span> (<span class="id">codensityT</span> <span class="id">M</span>)<span class="id">]</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="id">E</span> <span class="id">##</span> <span class="id">hmap</span> <span class="id">t</span> (<span class="id">Lift</span> <span class="id">[the</span> <span class="id">monadT</span> <span class="id">of</span> <span class="id">codensityT]</span> <span class="id">M</span>).<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">slifting</span> <span class="id">:</span> <span class="id">E</span>.<span class="id">-operation</span> (<span class="id">t</span> <span class="id">M</span>) <span class="id">:=</span> <span class="id">op1</span> <span class="id">\v</span> <span class="id">op2</span> <span class="id">\v</span> <span class="id">op3</span>.<br/>
<br/>
<span class="vernacular">Theorem</span> <span class="id">uniform_sigma_lifting</span> <span class="id">:</span> <span class="id">lifting_monadT</span> <span class="id">op</span> <span class="id">slifting</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof11')">Proof.</span></div>
<div class="proofscript" id="proof11">
<span class="id">rewrite</span> <span class="id">/lifting_monadT</span> <span class="id">/slifting</span> <span class="id">=&gt;</span> <span class="id">X</span>.<br/>
<span class="id">apply/esym</span>.<br/>
<span class="id">transitivity</span> ((<span class="id">op1</span> <span class="id">\v</span> <span class="id">op2</span>) <span class="id">X</span> <span class="id">\o</span> <span class="id">op3</span> <span class="id">X</span> <span class="id">\o</span> <span class="id">E</span> <span class="id">#</span> <span class="id">Lift</span> <span class="id">t</span> <span class="id">M</span> <span class="id">X</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">rewrite</span> (<span class="id">vassoc</span> <span class="id">op1</span>) <span class="id">vcompE/=</span> <span class="id">!vcompE</span>.<br/>
<span class="id">rewrite</span> <span class="id">-compA</span>.<br/>
<span class="id">transitivity</span> ((<span class="id">op1</span> <span class="id">\v</span> <span class="id">op2</span>) <span class="id">X</span> <span class="id">\o</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id">E</span> <span class="id">#</span> <span class="id">Lift</span> <span class="id">t</span> (<span class="id">codensityT</span> <span class="id">M</span>) <span class="id">X</span>) <span class="id">\o</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">E</span> <span class="id">#</span> <span class="id">Lift</span> <span class="id">[the</span> <span class="id">monadT</span> <span class="id">of</span> <span class="id">codensityT]</span> <span class="id">M</span> <span class="id">X</span>))).<br/>
&nbsp;&nbsp;<span class="id">congr</span> (<span class="id">_</span> <span class="id">\o</span> <span class="id">_</span>)<span class="id">;</span> <span class="id">rewrite</span> <span class="id">/op3</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">-functor_o</span> <span class="id">-natural_hmapE</span> <span class="id">functor_app_naturalE</span> <span class="id">-</span>(@<span class="id">functor_o</span> <span class="id">E</span>).<br/>
<span class="id">transitivity</span> (<span class="id">op1</span> <span class="id">X</span> <span class="id">\o</span><br/>
&nbsp;&nbsp;(<span class="id">op2</span> <span class="id">X</span> <span class="id">\o</span> <span class="id">E</span> <span class="id">#</span> <span class="id">Lift</span> <span class="id">t</span> (<span class="id">codensityT</span> <span class="id">M</span>) <span class="id">X</span>) <span class="id">\o</span> <span class="id">E</span> <span class="id">#</span> <span class="id">Lift</span> <span class="id">[the</span> <span class="id">monadT</span> <span class="id">of</span> <span class="id">codensityT]</span> <span class="id">M</span> <span class="id">X</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">vcompE</span> <span class="id">-compA</span>.<br/>
<span class="id">rewrite</span> <span class="id">-uniform_algebraic_lifting</span>.<br/>
<span class="id">transitivity</span> (<span class="id">Lift</span> <span class="id">t</span> <span class="id">M</span> <span class="id">X</span> <span class="id">\o</span> <span class="id">from</span> <span class="id">naturality_MK</span> <span class="id">X</span> <span class="id">\o</span> (<span class="id">psik</span> <span class="id">op</span>) <span class="id">X</span> <span class="id">\o</span><br/>
&nbsp;&nbsp;<span class="id">E</span> <span class="id">#</span> <span class="id">Lift</span> <span class="id">[the</span> <span class="id">monadT</span> <span class="id">of</span> <span class="id">codensityT]</span> <span class="id">M</span> <span class="id">X</span>).<br/>
&nbsp;&nbsp;<span class="id">congr</span> (<span class="id">_</span> <span class="id">\o</span> <span class="id">_</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">compA</span> <span class="id">natural_hmapE</span>.<br/>
<span class="id">rewrite</span> <span class="id">-2!compA</span>.<br/>
<span class="id">congr</span> (<span class="id">_</span> <span class="id">\o</span> <span class="id">_</span>).<br/>
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">compA</span> <span class="id">-psikE</span>.<br/>
Qed.</div>
<span class="vernacular">End</span> <span class="id">uniform_sigma_lifting</span>.<br/>
<br/>
<span class="vernacular">Section</span> <span class="id">slifting_instances</span>.<br/>
<br/>
<span class="vernacular">Variables</span> (<span class="id">E</span> <span class="id">:</span> <span class="id">functor</span>) (<span class="id">M</span> <span class="id">:</span> <span class="id">monad</span>) (<span class="id">op</span> <span class="id">:</span> <span class="id">E</span>.<span class="id">-operation</span> <span class="id">M</span>).<br/>
<span class="vernacular">Hypothesis</span> <span class="id">naturality_MK</span> <span class="id">:</span> <span class="gallina-kwd">forall</span> (<span class="id">A</span> <span class="id">:</span> <span class="id">UU0</span>) (<span class="id">m</span> <span class="id">:</span> <span class="id">MK</span> <span class="id">M</span> <span class="id">A</span>)<span class="id">,</span> <span class="id">naturality_MK</span> <span class="id">m</span>.<br/>
<br/>
<span class="vernacular">Section</span> <span class="id">slifting_stateT</span>.<br/>
<span class="vernacular">Variable</span> <span class="id">S</span> <span class="id">:</span> <span class="id">UU0</span>.<br/>
<br/>
<span class="vernacular">Let</span> <span class="id">tau</span> (<span class="id">X</span> <span class="id">:</span> <span class="id">UU0</span>) <span class="id">s</span> (<span class="id">f</span> <span class="id">:</span> <span class="id">S</span> <span class="id">-&gt;</span> <span class="id">M</span> (<span class="id">X</span> <span class="id">*</span> <span class="id">S</span>)%<span class="id">type</span>) <span class="id">:=</span> <span class="id">f</span> <span class="id">s</span>.<br/>
<br/>
<span class="vernacular">Let</span> <span class="id">op'</span> <span class="id">:</span> <span class="id">E</span> <span class="id">\o</span> <span class="id">stateT</span> <span class="id">S</span> <span class="id">M</span> <span class="id">~~&gt;</span> <span class="id">stateT</span> <span class="id">S</span> <span class="id">M</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">fun</span> (<span class="id">X</span> <span class="id">:</span> <span class="id">UU0</span>) <span class="id">t</span> <span class="id">s</span> <span class="id">=&gt;</span> <span class="id">op</span> (<span class="id">X</span> <span class="id">*</span> <span class="id">S</span>)%<span class="id">type</span> ((<span class="id">E</span> <span class="id">#</span> <span class="id">tau</span> <span class="id">s</span>) <span class="id">t</span>).<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">slifting_stateT</span> (<span class="id">X</span> <span class="id">:</span> <span class="id">UU0</span>) <span class="id">:</span><br/>
&nbsp;&nbsp;(<span class="id">slifting</span> <span class="id">op</span> <span class="id">[the</span> <span class="id">fmt</span> <span class="id">of</span> <span class="id">stateT</span> <span class="id">S]</span> <span class="id">naturality_MK</span>) <span class="id">X</span> <span class="id">=</span> @<span class="id">op'</span> <span class="id">_</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof12')">Proof.</span></div>
<div class="proofscript" id="proof12">
<span class="id">apply</span> <span class="id">funext</span> <span class="id">=&gt;</span> <span class="id">emx</span>.<br/>
<span class="id">rewrite</span> <span class="id">/op'</span>.<br/>
<span class="id">apply</span> <span class="id">funext</span> <span class="id">=&gt;</span> <span class="id">s</span>.<br/>
<span class="id">rewrite</span> <span class="id">/slifting</span>.<br/>
<span class="id">rewrite</span> <span class="id">2!vcompE</span>.<br/>
<span class="id">set</span> <span class="id">h</span> <span class="id">:=</span> <span class="id">hmap</span> <span class="id">_</span>.<br/>
<span class="id">rewrite</span> <span class="id">[in</span> <span class="id">RHS]</span>(<span class="id">psikE</span> <span class="id">op</span>).<br/>
<span class="id">rewrite</span> <span class="id">2!functor_app_naturalE</span>.<br/>
<span class="id">rewrite</span> <span class="id">/=</span>.<br/>
<span class="id">congr</span> (<span class="id">from_component</span> <span class="id">_</span>).<br/>
<span class="id">apply</span> <span class="id">funext_dep</span> <span class="id">=&gt;</span> <span class="id">A;</span> <span class="id">apply</span> <span class="id">funext</span> <span class="id">=&gt;</span> <span class="id">f</span>.<br/>
<span class="id">rewrite</span> <span class="id">{1}/psi'</span> <span class="id">/=</span>.<br/>
<span class="id">rewrite</span> <span class="id">/bindS</span> <span class="id">/=</span>.<br/>
<span class="id">rewrite</span> <span class="id">vcompE/=</span>.<br/>
<span class="id">rewrite</span> <span class="id">/liftS</span> <span class="id">/=</span>.<br/>
<span class="id">rewrite</span> <span class="id">bindA</span>.<br/>
<span class="id">set</span> <span class="id">ret_id</span> <span class="id">:=</span> (<span class="id">X</span> <span class="gallina-kwd">in</span> <span class="id">_</span> <span class="id">&gt;&gt;=</span> <span class="id">X</span>).<br/>
<span class="id">have</span> <span class="id">-&gt;</span> <span class="id">:</span> <span class="id">ret_id</span> <span class="id">=</span> <span class="gallina-kwd">fun</span> (<span class="id">x</span> <span class="id">:</span> <span class="id">MS</span> <span class="id">S</span> (<span class="id">codensityT</span> <span class="id">M</span>) <span class="id">X</span>) (<span class="id">C</span> <span class="id">:</span> <span class="id">UU0</span>) <span class="id">=&gt;</span> (<span class="gallina-kwd">fun</span> <span class="id">t</span> <span class="id">=&gt;</span> <span class="id">x</span> <span class="id">s</span> <span class="id">C</span> <span class="id">t</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">apply</span> <span class="id">funext</span>.<br/>
<span class="id">rewrite</span> <span class="id">/psi'</span> <span class="id">/=</span> <span class="id">/bindK</span> <span class="id">/kappa'</span> <span class="id">/=</span>.<br/>
<span class="id">congr</span> (<span class="id">op</span> <span class="id">A</span>).<br/>
<span class="id">rewrite</span> <span class="id">-2![in</span> <span class="id">LHS]</span>(<span class="id">compE</span> <span class="id">_</span> <span class="id">_</span> <span class="id">emx</span>) <span class="id">-2![in</span> <span class="id">RHS]</span>(<span class="id">compE</span> <span class="id">_</span> <span class="id">_</span> <span class="id">emx</span>).<br/>
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">-!functor_o</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">End</span> <span class="id">slifting_stateT</span>.<br/>
<br/>
<span class="vernacular">Section</span> <span class="id">slifting_exceptT</span>.<br/>
<span class="vernacular">Variable</span> <span class="id">Z</span> <span class="id">:</span> <span class="id">UU0</span>.<br/>
<br/>
<span class="vernacular">Let</span> <span class="id">op'</span> <span class="id">:</span> <span class="id">E</span> <span class="id">\o</span> <span class="id">exceptT</span> <span class="id">Z</span> <span class="id">M</span> <span class="id">~~&gt;</span> <span class="id">exceptT</span> <span class="id">Z</span> <span class="id">M</span> <span class="id">:=</span> <span class="gallina-kwd">fun</span> (<span class="id">Y</span> <span class="id">:</span> <span class="id">UU0</span>) <span class="id">=&gt;</span> @<span class="id">op</span> <span class="id">_</span>.<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">slifting_exceptT</span> (<span class="id">X</span> <span class="id">:</span> <span class="id">UU0</span>) <span class="id">:</span><br/>
&nbsp;&nbsp;(<span class="id">slifting</span> <span class="id">op</span> <span class="id">[the</span> <span class="id">fmt</span> <span class="id">of</span> <span class="id">exceptT</span> <span class="id">Z]</span> <span class="id">naturality_MK</span>) <span class="id">X</span> <span class="id">=</span> @<span class="id">op'</span> <span class="id">X</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof13')">Proof.</span></div>
<div class="proofscript" id="proof13">
<span class="id">apply</span> <span class="id">funext</span> <span class="id">=&gt;</span> <span class="id">emx</span>.<br/>
<span class="id">rewrite</span> <span class="id">/op'</span>.<br/>
<span class="id">rewrite</span> (<span class="id">psikE</span> <span class="id">op</span> (<span class="id">Z</span> <span class="id">+</span> <span class="id">X</span>)%<span class="id">type</span>).<br/>
<span class="id">rewrite</span> <span class="id">/slifting</span>.<br/>
<span class="id">rewrite</span> <span class="id">2!vcompE</span>.<br/>
<span class="id">set</span> <span class="id">h</span> <span class="id">:=</span> <span class="id">hmap</span> <span class="id">_</span>.<br/>
<span class="id">rewrite</span> <span class="id">/=</span>.<br/>
<span class="id">f_equal</span>.<br/>
<span class="id">rewrite</span> <span class="id">/psi'</span> <span class="id">/=</span>.<br/>
<span class="id">rewrite</span> <span class="id">/bindX</span> <span class="id">bindE</span> <span class="id">/=</span>.<br/>
<span class="id">apply</span> <span class="id">funext_dep</span> <span class="id">=&gt;</span> <span class="id">A;</span> <span class="id">apply</span> <span class="id">funext</span> <span class="id">=&gt;</span> <span class="id">k</span>.<br/>
<span class="id">rewrite</span> <span class="id">vcompE/=</span>.<br/>
<span class="id">rewrite</span> <span class="id">/liftX</span> <span class="id">/=</span>.<br/>
<span class="id">rewrite</span> <span class="id">bindE</span> <span class="id">/=</span> <span class="id">/bindK</span> <span class="id">/=</span>.<br/>
<span class="id">rewrite</span> <span class="id">/psi'</span> <span class="id">/=</span> <span class="id">/bindK</span> <span class="id">/=</span>.<br/>
<span class="id">rewrite</span> <span class="id">/kappa'</span> <span class="id">/=</span>.<br/>
<span class="id">congr</span> (<span class="id">op</span> <span class="id">_</span> <span class="id">_</span>).<br/>
<span class="id">rewrite</span> <span class="id">-</span>(<span class="id">compE</span> (<span class="id">E</span> <span class="id">#</span> <span class="id">_</span>)).<br/>
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">-functor_o</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">End</span> <span class="id">slifting_exceptT</span>.<br/>
<br/>
<span class="vernacular">Section</span> <span class="id">slifting_envT</span>.<br/>
<span class="vernacular">Variable</span> <span class="id">Env</span> <span class="id">:</span> <span class="id">UU0</span>.<br/>
<br/>
<span class="vernacular">Let</span> <span class="id">tau</span> (<span class="id">X</span> <span class="id">:</span> <span class="id">UU0</span>) <span class="id">e</span> (<span class="id">f</span> <span class="id">:</span> <span class="id">Env</span> <span class="id">-&gt;</span> <span class="id">M</span> <span class="id">X</span>) <span class="id">:=</span> <span class="id">f</span> <span class="id">e</span>.<br/>
<br/>
<span class="vernacular">Let</span> <span class="id">op'</span> <span class="id">:</span> <span class="id">E</span> <span class="id">\o</span> <span class="id">envT</span> <span class="id">Env</span> <span class="id">M</span> <span class="id">~~&gt;</span> <span class="id">envT</span> <span class="id">Env</span> <span class="id">M</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">fun</span> (<span class="id">X</span> <span class="id">:</span> <span class="id">UU0</span>) <span class="id">t</span> <span class="id">=&gt;</span> <span class="gallina-kwd">fun</span> <span class="id">e</span> <span class="id">=&gt;</span> <span class="id">op</span> <span class="id">X</span> ((<span class="id">E</span> <span class="id">#</span> <span class="id">tau</span> <span class="id">e</span>) <span class="id">t</span>).<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">slifting_envT</span> (<span class="id">X</span> <span class="id">:</span> <span class="id">UU0</span>) <span class="id">:</span><br/>
&nbsp;&nbsp;(<span class="id">slifting</span> <span class="id">op</span> <span class="id">[the</span> <span class="id">fmt</span> <span class="id">of</span> <span class="id">envT</span> <span class="id">Env]</span> <span class="id">naturality_MK</span>) <span class="id">X</span> <span class="id">=</span> @<span class="id">op'</span> <span class="id">_</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof14')">Proof.</span></div>
<div class="proofscript" id="proof14">
<span class="id">apply</span> <span class="id">funext</span> <span class="id">=&gt;</span> <span class="id">emx</span>.<br/>
<span class="id">rewrite</span> <span class="id">/op'</span>.<br/>
<span class="id">apply</span> <span class="id">funext</span> <span class="id">=&gt;</span> <span class="id">s</span>.<br/>
<span class="id">rewrite</span> <span class="id">/slifting</span>.<br/>
<span class="id">rewrite</span> <span class="id">2!vcompE</span>.<br/>
<span class="id">set</span> <span class="id">h</span> <span class="id">:=</span> <span class="id">hmap</span> <span class="id">_</span>.<br/>
<span class="id">rewrite</span> (<span class="id">psikE</span> <span class="id">op</span>).<br/>
<span class="id">rewrite</span> <span class="id">2!functor_app_naturalE</span>.<br/>
<span class="id">rewrite</span> <span class="id">/=</span>.<br/>
<span class="id">congr</span> (<span class="id">from_component</span> <span class="id">_</span>).<br/>
<span class="id">apply</span> <span class="id">funext_dep</span> <span class="id">=&gt;</span> <span class="id">A;</span> <span class="id">apply</span> <span class="id">funext</span> <span class="id">=&gt;</span> <span class="id">f</span>.<br/>
<span class="id">rewrite</span> <span class="id">{1}/psi'</span> <span class="id">/=</span>.<br/>
<span class="id">rewrite</span> <span class="id">/bindEnv</span> <span class="id">/=</span>.<br/>
<span class="id">rewrite</span> <span class="id">vcompE/=</span>.<br/>
<span class="id">rewrite</span> <span class="id">bindE</span> <span class="id">/=</span> <span class="id">/bindK</span>.<br/>
<span class="id">rewrite</span> <span class="id">fmapE</span> <span class="id">/bindK</span>.<br/>
<span class="id">rewrite</span> <span class="id">/liftEnv</span> <span class="id">/=</span>.<br/>
<span class="id">rewrite</span> <span class="id">-</span>(<span class="id">compE</span> <span class="id">_</span> <span class="id">_</span> <span class="id">emx</span>) <span class="id">-functor_o</span>.<br/>
<span class="id">rewrite</span> <span class="id">-[in</span> <span class="id">RHS]</span>(<span class="id">compE</span> <span class="id">_</span> <span class="id">_</span> <span class="id">emx</span>) <span class="id">-functor_o</span>.<br/>
<span class="id">rewrite</span> <span class="id">/psi'</span> <span class="id">/=</span> <span class="id">/bindK</span> <span class="id">/=</span> <span class="id">/kappa'</span> <span class="id">/=</span>.<br/>
<span class="id">congr</span> (<span class="id">op</span> <span class="id">A</span>).<br/>
<span class="id">rewrite</span> <span class="id">-</span>(<span class="id">compE</span> <span class="id">_</span> <span class="id">_</span> <span class="id">emx</span>) <span class="id">-[in</span> <span class="id">RHS]</span>(<span class="id">compE</span> <span class="id">_</span> <span class="id">_</span> <span class="id">emx</span>).<br/>
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">-2!functor_o</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">End</span> <span class="id">slifting_envT</span>.<br/>
<br/>
<span class="vernacular">Section</span> <span class="id">slifting_outputT</span>.<br/>
<span class="vernacular">Variable</span> <span class="id">R</span> <span class="id">:</span> <span class="id">UU0</span>.<br/>
<br/>
<span class="vernacular">Let</span> <span class="id">op'</span> <span class="id">:</span> <span class="id">E</span> <span class="id">\o</span> <span class="id">outputT</span> <span class="id">R</span> <span class="id">M</span> <span class="id">~~&gt;</span> <span class="id">outputT</span> <span class="id">R</span> <span class="id">M</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">fun</span> (<span class="id">X</span> <span class="id">:</span> <span class="id">UU0</span>) <span class="id">=&gt;</span> @<span class="id">op</span> (<span class="id">X</span> <span class="id">*</span> <span class="id">seq</span> <span class="id">R</span>)%<span class="id">type</span>.<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">slifting_outputT</span> (<span class="id">X</span> <span class="id">:</span> <span class="id">UU0</span>) <span class="id">:</span><br/>
&nbsp;&nbsp;(<span class="id">slifting</span> <span class="id">op</span> <span class="id">[the</span> <span class="id">fmt</span> <span class="id">of</span> <span class="id">outputT</span> <span class="id">R]</span> <span class="id">naturality_MK</span>) <span class="id">X</span> <span class="id">=</span> @<span class="id">op'</span> <span class="id">_</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof15')">Proof.</span></div>
<div class="proofscript" id="proof15">
<span class="id">apply</span> <span class="id">funext</span> <span class="id">=&gt;</span> <span class="id">emx</span>.<br/>
<span class="id">rewrite</span> <span class="id">/op'</span>.<br/>
<span class="id">rewrite</span> <span class="id">/slifting</span>.<br/>
<span class="id">rewrite</span> <span class="id">2!vcompE</span>.<br/>
<span class="id">set</span> <span class="id">h</span> <span class="id">:=</span> <span class="id">hmap</span> <span class="id">_</span>.<br/>
<span class="id">rewrite</span> (<span class="id">psikE</span> <span class="id">op</span>).<br/>
<span class="id">rewrite</span> <span class="id">2!functor_app_naturalE</span>.<br/>
<span class="id">rewrite</span> <span class="id">/=</span>.<br/>
<span class="id">f_equal</span>.<br/>
<span class="id">rewrite</span> <span class="id">/psi'</span> <span class="id">/=</span> <span class="id">/bindK</span> <span class="id">/bindO</span> <span class="id">/=</span> <span class="id">bindE</span> <span class="id">/=</span> <span class="id">/bindK</span> <span class="id">/=</span>.<br/>
<span class="id">apply</span> <span class="id">funext_dep</span> <span class="id">=&gt;</span> <span class="id">A;</span> <span class="id">apply</span> <span class="id">funext</span> <span class="id">=&gt;</span> <span class="id">f</span>.<br/>
<span class="id">rewrite</span> <span class="id">fmapE</span> <span class="id">/bindK</span>.<br/>
<span class="id">rewrite</span> <span class="id">vcompE/=</span>.<br/>
<span class="id">rewrite</span> <span class="id">/liftO</span> <span class="id">/=</span>.<br/>
<span class="id">rewrite</span> <span class="id">-</span>(<span class="id">compE</span> <span class="id">_</span> <span class="id">_</span> <span class="id">emx</span>) <span class="id">-functor_o</span>.<br/>
<span class="id">rewrite</span> <span class="id">bindE</span> <span class="id">/=</span> <span class="id">/bindK</span> <span class="id">/=</span>.<br/>
<span class="id">rewrite</span> <span class="id">fmapE</span>.<br/>
<span class="id">rewrite</span> <span class="id">/bindK</span>.<br/>
<span class="id">rewrite</span> <span class="id">/psi'</span> <span class="id">/=</span> <span class="id">/bindK</span> <span class="id">/=</span> <span class="id">/kappa'</span> <span class="id">/=</span>.<br/>
<span class="id">congr</span> (<span class="id">op</span> <span class="id">A</span>).<br/>
<span class="id">rewrite</span> <span class="id">-</span>(<span class="id">compE</span> <span class="id">_</span> <span class="id">_</span> <span class="id">emx</span>) <span class="id">-[in</span> <span class="id">RHS]</span>(<span class="id">compE</span> <span class="id">_</span> <span class="id">_</span> <span class="id">emx</span>).<br/>
<span class="id">rewrite</span> <span class="id">-2!functor_o</span>.<br/>
<span class="id">congr</span> ((<span class="id">E</span> <span class="id">#</span> <span class="id">_</span>) <span class="id">_</span>).<br/>
<span class="id">apply</span> <span class="id">funext</span> <span class="id">=&gt;</span> <span class="id">rmx</span> <span class="id">/=</span>.<br/>
<span class="id">rewrite</span> <span class="id">/retK</span> <span class="id">/=</span> <span class="id">bindE</span> <span class="id">fmapE</span> <span class="id">/=</span> <span class="id">/bindK</span>.<br/>
<span class="id">congr</span> (<span class="id">Lift</span> <span class="id">[the</span> <span class="id">monadT</span> <span class="id">of</span> <span class="id">codensityT]</span> <span class="id">M</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>).<br/>
<span class="gallina-kwd">by</span> <span class="id">apply</span> <span class="id">funext</span> <span class="id">=&gt;</span> <span class="id">-[]</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">End</span> <span class="id">slifting_outputT</span>.<br/>
<br/>
<span class="vernacular">End</span> <span class="id">slifting_instances</span>.<br/>
<br/>
<span class="vernacular">Section</span> <span class="id">slifting_alifting_coincide</span>.<br/>
<br/>
<span class="vernacular">Variables</span> (<span class="id">E</span> <span class="id">:</span> <span class="id">functor</span>) (<span class="id">M</span> <span class="id">:</span> <span class="id">monad</span>) (<span class="id">aop</span> <span class="id">:</span> <span class="id">E</span>.<span class="id">-aoperation</span> <span class="id">M</span>).<br/>
<span class="vernacular">Hypothesis</span> <span class="id">naturality_MK</span> <span class="id">:</span> <span class="gallina-kwd">forall</span> (<span class="id">A</span> <span class="id">:</span> <span class="id">UU0</span>) (<span class="id">m</span> <span class="id">:</span> <span class="id">MK</span> <span class="id">M</span> <span class="id">A</span>)<span class="id">,</span><br/>
&nbsp;&nbsp;<span class="id">naturality_MK</span> <span class="id">m</span>.<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">slifting_alifting_stateFMT</span> (<span class="id">S</span> <span class="id">:</span> <span class="id">UU0</span>) (<span class="id">t</span> <span class="id">:=</span> <span class="id">[the</span> <span class="id">fmt</span> <span class="id">of</span> <span class="id">stateT</span> <span class="id">S]</span>) <span class="id">:</span><br/>
&nbsp;&nbsp;<span class="id">slifting</span> <span class="id">aop</span> <span class="id">t</span> <span class="id">naturality_MK</span> <span class="id">=</span> <span class="id">alifting</span> <span class="id">aop</span> (<span class="id">Lift</span> <span class="id">t</span> <span class="id">M</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof16')">Proof.</span></div>
<div class="proofscript" id="proof16">
<span class="id">apply</span> <span class="id">nattrans_ext</span> <span class="id">=&gt;</span> <span class="id">X</span>.<br/>
<span class="id">rewrite</span> (<span class="id">slifting_stateT</span> <span class="id">aop</span> <span class="id">naturality_MK</span> <span class="id">S</span>).<br/>
<span class="id">apply</span> <span class="id">funext</span> <span class="id">=&gt;</span> <span class="id">m;</span> <span class="id">apply</span> <span class="id">funext</span> <span class="id">=&gt;</span> <span class="id">s</span>.<br/>
<span class="id">rewrite</span> <span class="id">/alifting</span>.<br/>
<span class="id">rewrite</span> <span class="id">/=</span>.<br/>
<span class="id">rewrite</span> <span class="id">psiE</span> <span class="id">/=</span>.<br/>
<span class="id">rewrite</span> <span class="id">/bindS</span>.<br/>
<span class="id">rewrite</span> <span class="id">vcompE/=</span>.<br/>
<span class="id">rewrite</span> <span class="id">/liftS/=</span>.<br/>
<span class="id">rewrite</span> <span class="id">2!algebraic</span>.<br/>
<span class="id">congr</span> (<span class="id">aop</span> <span class="id">_</span> <span class="id">_</span>).<br/>
<span class="id">rewrite</span> <span class="id">-[RHS]</span>(<span class="id">compE</span> <span class="id">_</span> (<span class="id">E</span> <span class="id">#</span> <span class="id">_</span>)).<br/>
<span class="id">rewrite</span> <span class="id">-functor_o</span>.<br/>
<span class="id">rewrite</span> <span class="id">-[RHS]</span>(<span class="id">compE</span> <span class="id">_</span> (<span class="id">E</span> <span class="id">#</span> <span class="id">_</span>)).<br/>
<span class="id">rewrite</span> <span class="id">-functor_o</span>.<br/>
<span class="id">congr</span> ((<span class="id">E</span> <span class="id">#</span> <span class="id">_</span>) <span class="id">m</span>).<br/>
<span class="id">apply</span> <span class="id">funext</span> <span class="id">=&gt;</span> <span class="id">x</span> <span class="id">/=</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">2!bindretf</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">Lemma</span> <span class="id">slifting_alifting_exceptFMT</span> (<span class="id">Z</span> <span class="id">:</span> <span class="id">UU0</span>) (<span class="id">t</span> <span class="id">:=</span> <span class="id">[the</span> <span class="id">fmt</span> <span class="id">of</span> <span class="id">exceptT</span> <span class="id">Z]</span>) <span class="id">:</span><br/>
&nbsp;&nbsp;<span class="id">slifting</span> <span class="id">aop</span> <span class="id">t</span> <span class="id">naturality_MK</span> <span class="id">=</span> <span class="id">alifting</span> <span class="id">aop</span> (<span class="id">Lift</span> <span class="id">t</span> <span class="id">M</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof17')">Proof.</span></div>
<div class="proofscript" id="proof17">
<span class="id">apply</span> <span class="id">nattrans_ext</span> <span class="id">=&gt;</span> <span class="id">X</span>.<br/>
<span class="id">rewrite</span> (<span class="id">slifting_exceptT</span> <span class="id">aop</span> <span class="id">naturality_MK</span> <span class="id">Z</span>).<br/>
<span class="id">apply</span> <span class="id">funext</span> <span class="id">=&gt;</span> <span class="id">m</span>.<br/>
<span class="id">rewrite</span> <span class="id">/alifting</span>.<br/>
<span class="id">rewrite</span> <span class="id">/=</span>.<br/>
<span class="id">rewrite</span> <span class="id">psiE</span> <span class="id">/=</span> <span class="id">/bindX</span>.<br/>
<span class="id">rewrite</span> <span class="id">vcompE/=</span>.<br/>
<span class="id">rewrite</span> <span class="id">/liftX</span>.<br/>
<span class="id">rewrite</span> <span class="id">2!algebraic</span>.<br/>
<span class="id">congr</span> (<span class="id">aop</span> <span class="id">_</span> <span class="id">_</span>).<br/>
<span class="id">rewrite</span> <span class="id">-[RHS]</span>(<span class="id">compE</span> <span class="id">_</span> (<span class="id">E</span> <span class="id">#</span> <span class="id">_</span>)).<br/>
<span class="id">rewrite</span> <span class="id">-functor_o</span>.<br/>
<span class="id">rewrite</span> <span class="id">-[RHS]</span>(<span class="id">compE</span> <span class="id">_</span> (<span class="id">E</span> <span class="id">#</span> <span class="id">_</span>)).<br/>
<span class="id">rewrite</span> <span class="id">-functor_o</span>.<br/>
<span class="id">rewrite</span> (<span class="id">_</span> <span class="id">:</span> <span class="id">_</span> <span class="id">\o</span> <span class="id">Ret</span> <span class="id">=</span> <span class="id">id</span>) <span class="id">?functor_id</span> <span class="id">//</span>.<br/>
<span class="id">apply</span> <span class="id">funext</span> <span class="id">=&gt;</span> <span class="id">n</span> <span class="id">/=</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">2!bindretf</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">Lemma</span> <span class="id">slifting_alifting_envFMT</span> (<span class="id">Env</span> <span class="id">:</span> <span class="id">UU0</span>) (<span class="id">t</span> <span class="id">:=</span> <span class="id">[the</span> <span class="id">fmt</span> <span class="id">of</span> <span class="id">envT</span> <span class="id">Env]</span>) <span class="id">:</span><br/>
&nbsp;&nbsp;<span class="id">slifting</span> <span class="id">aop</span> <span class="id">t</span> <span class="id">naturality_MK</span> <span class="id">=</span> <span class="id">alifting</span> <span class="id">aop</span> (<span class="id">Lift</span> <span class="id">t</span> <span class="id">M</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof18')">Proof.</span></div>
<div class="proofscript" id="proof18">
<span class="id">apply</span> <span class="id">nattrans_ext</span> <span class="id">=&gt;</span> <span class="id">X</span>.<br/>
<span class="id">rewrite</span> (<span class="id">slifting_envT</span> <span class="id">aop</span> <span class="id">naturality_MK</span> <span class="id">Env</span>).<br/>
<span class="id">apply</span> <span class="id">funext</span> <span class="id">=&gt;</span> <span class="id">m;</span> <span class="id">apply</span> <span class="id">funext</span> <span class="id">=&gt;</span> <span class="id">e</span>.<br/>
<span class="id">rewrite</span> <span class="id">/alifting</span>.<br/>
<span class="id">rewrite</span> <span class="id">/=</span>.<br/>
<span class="id">rewrite</span> <span class="id">psiE</span> <span class="id">/=</span> <span class="id">/bindEnv</span>.<br/>
<span class="id">rewrite</span> <span class="id">vcompE/=</span>.<br/>
<span class="id">rewrite</span> <span class="id">/liftEnv</span>.<br/>
<span class="id">rewrite</span> <span class="id">algebraic</span>.<br/>
<span class="id">congr</span> (<span class="id">aop</span> <span class="id">_</span> <span class="id">_</span>).<br/>
<span class="id">rewrite</span> <span class="id">-[RHS]</span>(<span class="id">compE</span> <span class="id">_</span> (<span class="id">E</span> <span class="id">#</span> <span class="id">_</span>)).<br/>
<span class="id">rewrite</span> <span class="id">-functor_o</span>.<br/>
<span class="id">congr</span> ((<span class="id">E</span> <span class="id">#</span> <span class="id">_</span>) <span class="id">m</span>).<br/>
<span class="id">apply</span> <span class="id">funext</span> <span class="id">=&gt;</span> <span class="id">x</span> <span class="id">/=</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">bindretf</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">Lemma</span> <span class="id">slifting_alifting_outputFMT</span> (<span class="id">R</span> <span class="id">:</span> <span class="id">UU0</span>) (<span class="id">t</span> <span class="id">:=</span> <span class="id">[the</span> <span class="id">fmt</span> <span class="id">of</span> <span class="id">outputT</span> <span class="id">R]</span>) <span class="id">:</span><br/>
&nbsp;&nbsp;<span class="id">slifting</span> <span class="id">aop</span> <span class="id">t</span> <span class="id">naturality_MK</span> <span class="id">=</span> <span class="id">alifting</span> <span class="id">aop</span> (<span class="id">Lift</span> <span class="id">t</span> <span class="id">M</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof19')">Proof.</span></div>
<div class="proofscript" id="proof19">
<span class="id">apply</span> <span class="id">nattrans_ext</span> <span class="id">=&gt;</span> <span class="id">X</span>.<br/>
<span class="id">rewrite</span> (<span class="id">slifting_outputT</span> <span class="id">aop</span> <span class="id">naturality_MK</span> <span class="id">R</span>).<br/>
<span class="id">apply</span> <span class="id">funext</span> <span class="id">=&gt;</span> <span class="id">m</span>.<br/>
<span class="id">rewrite</span> <span class="id">/alifting</span>.<br/>
<span class="id">rewrite</span> <span class="id">/=</span>.<br/>
<span class="id">rewrite</span> <span class="id">psiE</span> <span class="id">/=</span> <span class="id">/bindO</span>.<br/>
<span class="id">rewrite</span> <span class="id">vcompE/=</span>.<br/>
<span class="id">rewrite</span> <span class="id">/liftO</span>.<br/>
<span class="id">rewrite</span> <span class="id">2!algebraic</span>.<br/>
<span class="id">congr</span> (<span class="id">aop</span> <span class="id">_</span> <span class="id">_</span>).<br/>
<span class="id">rewrite</span> <span class="id">-[RHS]</span>(<span class="id">compE</span> <span class="id">_</span> (<span class="id">E</span> <span class="id">#</span> <span class="id">_</span>)).<br/>
<span class="id">rewrite</span> <span class="id">-functor_o</span>.<br/>
<span class="id">rewrite</span> <span class="id">-[RHS]</span>(<span class="id">compE</span> <span class="id">_</span> (<span class="id">E</span> <span class="id">#</span> <span class="id">_</span>)).<br/>
<span class="id">rewrite</span> <span class="id">-functor_o</span>.<br/>
<span class="id">rewrite</span> (<span class="id">_</span> <span class="id">:</span> <span class="id">_</span> <span class="id">\o</span> <span class="id">Ret</span> <span class="id">=</span> <span class="id">id</span>) <span class="id">?functor_id</span> <span class="id">//</span>.<br/>
<span class="id">apply</span> <span class="id">funext</span> <span class="id">=&gt;</span> <span class="id">n</span> <span class="id">/=</span>.<br/>
<span class="id">rewrite</span> <span class="id">2!bindretf</span>.<br/>
<span class="vernacular">Open</span> (<span class="id">X</span> <span class="gallina-kwd">in</span> <span class="id">_</span> <span class="id">&gt;&gt;=</span> <span class="id">X</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">case</span> <span class="id">:</span> <span class="id">x</span> <span class="id">=&gt;</span> <span class="id">?</span> <span class="id">?;</span> <span class="id">rewrite</span> <span class="id">cat0s</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">bindmret</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">End</span> <span class="id">slifting_alifting_coincide</span>.<br/>
<br/>
<span class="vernacular">Require</span> <span class="vernacular">Import</span> <span class="id">imonad_model</span>.<br/>
<br/>
<span class="vernacular">Section</span> <span class="id">slifting_local</span>.<br/>
<span class="vernacular">Variable</span> <span class="id">Env</span> <span class="id">:</span> <span class="id">UU0</span>.<br/>
<span class="vernacular">Let</span> <span class="id">E</span> <span class="id">:=</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">Local.acto</span> <span class="id">Env]</span>.<br/>
<span class="vernacular">Let</span> <span class="id">M</span> <span class="id">:=</span> <span class="id">[the</span> <span class="id">monad</span> <span class="id">of</span> <span class="id">EnvironmentMonad.acto</span> <span class="id">Env]</span>.<br/>
<span class="vernacular">Let</span> <span class="id">local</span> <span class="id">:</span> <span class="id">E</span>.<span class="id">-operation</span> <span class="id">M</span> <span class="id">:=</span> <span class="id">local_op</span> <span class="id">Env</span>.<br/>
<span class="vernacular">Hypothesis</span> <span class="id">naturality_MK</span> <span class="id">:</span> <span class="gallina-kwd">forall</span> (<span class="id">A</span> <span class="id">:</span> <span class="id">UU0</span>) (<span class="id">m</span> <span class="id">:</span> <span class="id">MK</span> <span class="id">M</span> <span class="id">A</span>)<span class="id">,</span> <span class="id">naturality_MK</span> <span class="id">m</span>.<br/>
<br/>
<span class="vernacular">Section</span> <span class="id">slifting_local_FMT</span>.<br/>
<span class="vernacular">Variable</span> <span class="id">T</span> <span class="id">:</span> <span class="id">fmt</span>.<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">localKT</span> (<span class="id">f</span> <span class="id">:</span> <span class="id">Env</span> <span class="id">-&gt;</span> <span class="id">Env</span>) <span class="id">:</span> <span class="id">T</span> (<span class="id">codensityT</span> <span class="id">M</span>) <span class="id">~~&gt;</span> <span class="id">T</span> (<span class="id">codensityT</span> <span class="id">M</span>) <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">fun</span> (<span class="id">X</span> <span class="id">:</span> <span class="id">UU0</span>) <span class="id">t</span> <span class="id">=&gt;</span> <span class="id">Join</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Lift</span> <span class="id">T</span> (<span class="id">codensityT</span> <span class="id">M</span>) (<span class="id">T</span> (<span class="id">codensityT</span> <span class="id">M</span>) <span class="id">X</span>) (<span class="gallina-kwd">fun</span> <span class="id">Y</span> <span class="id">k</span> <span class="id">=&gt;</span> <span class="id">local</span> <span class="id">Y</span> (<span class="id">f,</span> <span class="id">k</span> <span class="id">t</span>))).<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">localT</span> (<span class="id">f</span> <span class="id">:</span> <span class="id">Env</span> <span class="id">-&gt;</span> <span class="id">Env</span>) <span class="id">:</span> <span class="id">T</span> <span class="id">M</span> <span class="id">~~&gt;</span> <span class="id">T</span> <span class="id">M</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">fun</span> <span class="id">X</span> <span class="id">t</span> <span class="id">=&gt;</span> <span class="gallina-kwd">let</span> <span class="id">t'</span> <span class="id">:=</span> <span class="id">hmap</span> <span class="id">T</span> (<span class="id">Lift</span> <span class="id">[the</span> <span class="id">monadT</span> <span class="id">of</span> <span class="id">codensityT]</span> <span class="id">M</span>) <span class="id">X</span> <span class="id">t</span> <span class="gallina-kwd">in</span><br/>
&nbsp;&nbsp;<span class="id">hmap</span> <span class="id">T</span> (<span class="id">from</span> <span class="id">naturality_MK</span>) <span class="id">X</span> (<span class="id">localKT</span> <span class="id">f</span> <span class="id">t'</span>).<br/>
<br/>
<span class="vernacular">End</span> <span class="id">slifting_local_FMT</span>.<br/>
<br/>
<span class="vernacular">Section</span> <span class="id">slifting_local_stateT</span>.<br/>
<span class="vernacular">Variable</span> <span class="id">S</span> <span class="id">:</span> <span class="id">UU0</span>.<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">local_stateT</span> (<span class="id">f</span> <span class="id">:</span> <span class="id">Env</span> <span class="id">-&gt;</span> <span class="id">Env</span>) <span class="id">:</span> <span class="id">stateT</span> <span class="id">S</span> <span class="id">M</span> <span class="id">~~&gt;</span> <span class="id">stateT</span> <span class="id">S</span> <span class="id">M</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">fun</span> <span class="id">X</span> <span class="id">t</span> <span class="id">s</span> <span class="id">e</span> <span class="id">=&gt;</span> <span class="id">t</span> <span class="id">s</span> (<span class="id">f</span> <span class="id">e</span>).<br/>
<br/>
<span class="vernacular">Let</span> <span class="id">local_stateT'</span> <span class="id">:</span> (<span class="id">E</span> <span class="id">\o</span> <span class="id">stateT</span> <span class="id">S</span> <span class="id">M</span>) <span class="id">~~&gt;</span> (<span class="id">stateT</span> <span class="id">S</span> <span class="id">M</span>) <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">fun</span> <span class="id">X</span> <span class="id">=&gt;</span> <span class="id">uncurry</span> (@<span class="id">local_stateT</span> <span class="id">^~</span> <span class="id">X</span>).<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">local_stateTE</span> (<span class="id">X</span> <span class="id">:</span> <span class="id">UU0</span>) <span class="id">:</span><br/>
&nbsp;&nbsp;(<span class="id">slifting</span> <span class="id">local</span> <span class="id">[the</span> <span class="id">fmt</span> <span class="id">of</span> <span class="id">stateT</span> <span class="id">S]</span> <span class="id">naturality_MK</span>) <span class="id">X</span> <span class="id">=</span> @<span class="id">local_stateT'</span> <span class="id">X</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof20')">Proof.</span></div>
<div class="proofscript" id="proof20">
 <span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">slifting_stateT;</span> <span class="id">apply</span> <span class="id">funext</span> <span class="id">=&gt;</span> <span class="id">-[]</span>. Qed.</div>
<span class="vernacular">End</span> <span class="id">slifting_local_stateT</span>.<br/>
<br/>
<span class="vernacular">Section</span> <span class="id">slifting_local_exceptT</span>.<br/>
<span class="vernacular">Variable</span> <span class="id">Z</span> <span class="id">:</span> <span class="id">UU0</span>.<br/>
<span class="vernacular">Definition</span> <span class="id">local_exceptT</span> (<span class="id">f</span> <span class="id">:</span> <span class="id">Env</span> <span class="id">-&gt;</span> <span class="id">Env</span>) <span class="id">:</span> <span class="id">exceptT</span> <span class="id">Z</span> <span class="id">M</span> <span class="id">~~&gt;</span> <span class="id">exceptT</span> <span class="id">Z</span> <span class="id">M</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">fun</span> <span class="id">X</span> <span class="id">t</span> <span class="id">e</span> <span class="id">=&gt;</span> <span class="id">t</span> (<span class="id">f</span> <span class="id">e</span>).<br/>
<br/>
<span class="vernacular">Let</span> <span class="id">local_exceptT'</span> <span class="id">:</span> (<span class="id">E</span> <span class="id">\o</span> <span class="id">exceptT</span> <span class="id">Z</span> <span class="id">M</span>) <span class="id">~~&gt;</span> (<span class="id">exceptT</span> <span class="id">Z</span> <span class="id">M</span>) <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">fun</span> <span class="id">X</span> <span class="id">=&gt;</span> <span class="id">uncurry</span> (@<span class="id">local_exceptT</span> <span class="id">^~</span> <span class="id">X</span>).<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">local_exceptTE</span> (<span class="id">X</span> <span class="id">:</span> <span class="id">UU0</span>) <span class="id">:</span><br/>
&nbsp;&nbsp;(<span class="id">slifting</span> <span class="id">local</span> <span class="id">[the</span> <span class="id">fmt</span> <span class="id">of</span> <span class="id">exceptT</span> <span class="id">Z]</span> <span class="id">naturality_MK</span>) <span class="id">X</span> <span class="id">=</span> @<span class="id">local_exceptT'</span> <span class="id">X</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof21')">Proof.</span></div>
<div class="proofscript" id="proof21">
 <span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">slifting_exceptT;</span> <span class="id">apply</span> <span class="id">funext</span> <span class="id">=&gt;</span> <span class="id">-[]</span>. Qed.</div>
<br/>
<span class="vernacular">End</span> <span class="id">slifting_local_exceptT</span>.<br/>
<br/>
<span class="vernacular">Section</span> <span class="id">slifting_local_envT</span>.<br/>
<span class="vernacular">Variable</span> <span class="id">Z</span> <span class="id">:</span> <span class="id">UU0</span>.<br/>
<span class="vernacular">Definition</span> <span class="id">local_envT</span> (<span class="id">f</span> <span class="id">:</span> <span class="id">Env</span> <span class="id">-&gt;</span> <span class="id">Env</span>) <span class="id">:</span> <span class="id">envT</span> <span class="id">Z</span> <span class="id">M</span> <span class="id">~~&gt;</span> <span class="id">envT</span> <span class="id">Z</span> <span class="id">M</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">fun</span> <span class="id">X</span> <span class="id">t</span> <span class="id">e</span> <span class="id">e'</span> <span class="id">=&gt;</span> <span class="id">t</span> <span class="id">e</span> (<span class="id">f</span> <span class="id">e'</span>).<br/>
<br/>
<span class="vernacular">Let</span> <span class="id">local_envT'</span> <span class="id">:</span> <span class="id">E</span> <span class="id">\o</span> <span class="id">envT</span> <span class="id">Z</span> <span class="id">M</span> <span class="id">~~&gt;</span> <span class="id">envT</span> <span class="id">Z</span> <span class="id">M</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">fun</span> <span class="id">X</span> <span class="id">=&gt;</span> <span class="id">uncurry</span> (@<span class="id">local_envT</span> <span class="id">^~</span> <span class="id">X</span>).<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">local_envTE</span> (<span class="id">X</span> <span class="id">:</span> <span class="id">UU0</span>) <span class="id">:</span><br/>
&nbsp;&nbsp;(<span class="id">slifting</span> <span class="id">local</span> <span class="id">[the</span> <span class="id">fmt</span> <span class="id">of</span> <span class="id">envT</span> <span class="id">Z]</span> <span class="id">naturality_MK</span>) <span class="id">X</span> <span class="id">=</span> @<span class="id">local_envT'</span> <span class="id">X</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof22')">Proof.</span></div>
<div class="proofscript" id="proof22">
<span class="id">rewrite</span> <span class="id">slifting_envT</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">apply</span> <span class="id">funext</span> <span class="id">=&gt;</span> <span class="id">-[]</span>.<br/>
Qed.</div>
<span class="vernacular">End</span> <span class="id">slifting_local_envT</span>.<br/>
<br/>
<span class="vernacular">Section</span> <span class="id">slifting_local_outputT</span>.<br/>
<span class="vernacular">Variable</span> <span class="id">R</span> <span class="id">:</span> <span class="id">UU0</span>.<br/>
<span class="vernacular">Definition</span> <span class="id">local_outputT</span> (<span class="id">f</span> <span class="id">:</span> <span class="id">Env</span> <span class="id">-&gt;</span> <span class="id">Env</span>) <span class="id">:</span> <span class="id">outputT</span> <span class="id">R</span> <span class="id">M</span> <span class="id">~~&gt;</span> <span class="id">outputT</span> <span class="id">R</span> <span class="id">M</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">fun</span> (<span class="id">X</span> <span class="id">:</span> <span class="id">UU0</span>) <span class="id">t</span> <span class="id">e</span> <span class="id">=&gt;</span> <span class="id">t</span> (<span class="id">f</span> <span class="id">e</span>).<br/>
<br/>
<span class="vernacular">Let</span> <span class="id">local_outputT'</span> <span class="id">:</span> <span class="id">E</span> <span class="id">\o</span> <span class="id">outputT</span> <span class="id">R</span> <span class="id">M</span> <span class="id">~~&gt;</span> <span class="id">outputT</span> <span class="id">R</span> <span class="id">M</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">fun</span> (<span class="id">X</span> <span class="id">:</span> <span class="id">UU0</span>) <span class="id">=&gt;</span> <span class="id">uncurry</span> (@<span class="id">local_outputT</span> <span class="id">^~</span> <span class="id">X</span>).<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">local_outputTE</span> (<span class="id">X</span> <span class="id">:</span> <span class="id">UU0</span>) <span class="id">:</span><br/>
&nbsp;&nbsp;(<span class="id">slifting</span> <span class="id">local</span> <span class="id">[the</span> <span class="id">fmt</span> <span class="id">of</span> <span class="id">outputT</span> <span class="id">R]</span> <span class="id">naturality_MK</span>) <span class="id">X</span> <span class="id">=</span> @<span class="id">local_outputT'</span> <span class="id">X</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof23')">Proof.</span></div>
<div class="proofscript" id="proof23">
 <span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">slifting_outputT;</span> <span class="id">apply</span> <span class="id">funext</span> <span class="id">=&gt;</span> <span class="id">-[]</span>. Qed.</div>
<span class="vernacular">End</span> <span class="id">slifting_local_outputT</span>.<br/>
<br/>
<span class="vernacular">End</span> <span class="id">slifting_local</span>.<br/>
<br/>
<span class="vernacular">Section</span> <span class="id">slifting_handle</span>. <br/>
<span class="vernacular">Let</span> <span class="id">E</span> <span class="id">:=</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">Handle.acto</span> <span class="id">unit]</span>.<br/>
<span class="vernacular">Let</span> <span class="id">M</span> <span class="id">:=</span> <span class="id">[the</span> <span class="id">monad</span> <span class="id">of</span> <span class="id">ExceptMonad.acto</span> <span class="id">unit]</span>.<br/>
<span class="vernacular">Let</span> <span class="id">handle</span> <span class="id">:</span> <span class="id">E</span>.<span class="id">-operation</span> <span class="id">M</span> <span class="id">:=</span> @<span class="id">handle_op</span> <span class="id">unit</span>.<br/>
<span class="vernacular">Hypothesis</span> <span class="id">naturality_MK</span> <span class="id">:</span> <span class="gallina-kwd">forall</span> (<span class="id">A</span> <span class="id">:</span> <span class="id">UU0</span>) (<span class="id">m</span> <span class="id">:</span> <span class="id">MK</span> <span class="id">M</span> <span class="id">A</span>)<span class="id">,</span><br/>
&nbsp;&nbsp;<span class="id">naturality_MK</span> <span class="id">m</span>.<br/>
<br/>
<span class="vernacular">Section</span> <span class="id">slifting_handle_stateT</span>.<br/>
<span class="vernacular">Variable</span> <span class="id">S</span> <span class="id">:</span> <span class="id">UU0</span>.<br/>
<span class="vernacular">Definition</span> <span class="id">handle_stateT</span> (<span class="id">X</span> <span class="id">:</span> <span class="id">UU0</span>) (<span class="id">t</span> <span class="id">:</span> <span class="id">stateT</span> <span class="id">S</span> <span class="id">M</span> <span class="id">X</span>) (<span class="id">h</span> <span class="id">:</span> <span class="id">unit</span> <span class="id">-&gt;</span> <span class="id">stateT</span> <span class="id">S</span> <span class="id">M</span> <span class="id">X</span>)<br/>
&nbsp;&nbsp;<span class="id">:</span> <span class="id">stateT</span> <span class="id">S</span> <span class="id">M</span> <span class="id">X</span> <span class="id">:=</span> <span class="gallina-kwd">fun</span> <span class="id">s</span> <span class="id">=&gt;</span> <span class="gallina-kwd">match</span> <span class="id">t</span> <span class="id">s</span> <span class="gallina-kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|</span> <span class="id">inl</span> <span class="id">z</span> <span class="id">=&gt;</span> <span class="id">h</span> <span class="id">z</span> <span class="id">s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|</span> <span class="id">inr</span> <span class="id">x</span> <span class="id">=&gt;</span> <span class="id">inr</span> <span class="id">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">end</span>.<br/>
<br/>
<span class="vernacular">Let</span> <span class="id">handle_stateT'</span> <span class="id">:</span> (<span class="id">E</span> <span class="id">\o</span> <span class="id">stateT</span> <span class="id">S</span> <span class="id">M</span>) <span class="id">~~&gt;</span> (<span class="id">stateT</span> <span class="id">S</span> <span class="id">M</span>) <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">fun</span> (<span class="id">X</span> <span class="id">:</span> <span class="id">UU0</span>) <span class="id">=&gt;</span> <span class="id">uncurry</span> (@<span class="id">handle_stateT</span> <span class="id">X</span>).<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">handle_stateTE</span> (<span class="id">X</span> <span class="id">:</span> <span class="id">UU0</span>) <span class="id">:</span><br/>
&nbsp;&nbsp;(<span class="id">slifting</span> <span class="id">handle</span> <span class="id">[the</span> <span class="id">fmt</span> <span class="id">of</span> <span class="id">stateT</span> <span class="id">S]</span> <span class="id">naturality_MK</span>) <span class="id">X</span> <span class="id">=</span> @<span class="id">handle_stateT'</span> <span class="id">X</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof24')">Proof.</span></div>
<div class="proofscript" id="proof24">
 <span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">slifting_stateT;</span> <span class="id">apply</span> <span class="id">funext</span> <span class="id">=&gt;</span> <span class="id">-[m</span> <span class="id">f]</span>. Qed.</div>
<span class="vernacular">End</span> <span class="id">slifting_handle_stateT</span>.<br/>
<br/>
<span class="vernacular">Section</span> <span class="id">slifting_handle_exceptT</span>.<br/>
<span class="vernacular">Variable</span> <span class="id">Z</span> <span class="id">:</span> <span class="id">UU0</span>.<br/>
<span class="vernacular">Definition</span> <span class="id">handle_exceptT</span> (<span class="id">X</span> <span class="id">:</span> <span class="id">UU0</span>) (<span class="id">t</span> <span class="id">:</span> <span class="id">exceptT</span> <span class="id">Z</span> <span class="id">M</span> <span class="id">X</span>)<br/>
&nbsp;&nbsp;(<span class="id">h</span> <span class="id">:</span> <span class="id">unit</span> <span class="id">-&gt;</span> <span class="id">exceptT</span> <span class="id">Z</span> <span class="id">M</span> <span class="id">X</span>) <span class="id">:</span> <span class="id">exceptT</span> <span class="id">Z</span> <span class="id">M</span> <span class="id">X</span> <span class="id">:=</span> <span class="gallina-kwd">match</span> <span class="id">t</span> <span class="gallina-kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|</span> <span class="id">inl</span> <span class="id">z</span> <span class="id">=&gt;</span> <span class="id">h</span> <span class="id">z</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|</span> <span class="id">inr</span> <span class="id">x</span> <span class="id">=&gt;</span> <span class="id">inr</span> <span class="id">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">end</span>.<br/>
<br/>
<span class="vernacular">Let</span> <span class="id">handle_exceptT'</span> <span class="id">:</span> <span class="id">E</span> <span class="id">\o</span> <span class="id">exceptT</span> <span class="id">Z</span> <span class="id">M</span> <span class="id">~~&gt;</span> <span class="id">exceptT</span> <span class="id">Z</span> <span class="id">M</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">fun</span> (<span class="id">X</span> <span class="id">:</span> <span class="id">UU0</span>) <span class="id">=&gt;</span> <span class="id">uncurry</span> (@<span class="id">handle_exceptT</span> <span class="id">X</span>).<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">handle_exceptTE</span> (<span class="id">X</span> <span class="id">:</span> <span class="id">UU0</span>) <span class="id">:</span><br/>
&nbsp;&nbsp;(<span class="id">slifting</span> <span class="id">handle</span> <span class="id">[the</span> <span class="id">fmt</span> <span class="id">of</span> <span class="id">exceptT</span> <span class="id">Z]</span> <span class="id">naturality_MK</span>) <span class="id">X</span> <span class="id">=</span> @<span class="id">handle_exceptT'</span> <span class="id">X</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof25')">Proof.</span></div>
<div class="proofscript" id="proof25">
 <span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">slifting_exceptT;</span> <span class="id">exact:</span> <span class="id">funext</span>. Qed.</div>
<span class="vernacular">End</span> <span class="id">slifting_handle_exceptT</span>.<br/>
<br/>
<span class="vernacular">Section</span> <span class="id">slifting_handle_envT</span>.<br/>
<span class="vernacular">Variable</span> <span class="id">Z</span> <span class="id">:</span> <span class="id">UU0</span>.<br/>
<span class="vernacular">Definition</span> <span class="id">handle_envT</span> (<span class="id">X</span> <span class="id">:</span> <span class="id">UU0</span>) (<span class="id">t</span> <span class="id">:</span> <span class="id">envT</span> <span class="id">Z</span> <span class="id">M</span> <span class="id">X</span>) (<span class="id">h</span> <span class="id">:</span> <span class="id">unit</span> <span class="id">-&gt;</span> <span class="id">envT</span> <span class="id">Z</span> <span class="id">M</span> <span class="id">X</span>)<br/>
&nbsp;&nbsp;<span class="id">:</span> <span class="id">envT</span> <span class="id">Z</span> <span class="id">M</span> <span class="id">X</span> <span class="id">:=</span> <span class="gallina-kwd">fun</span> <span class="id">e</span> <span class="id">=&gt;</span> <span class="gallina-kwd">match</span> <span class="id">t</span> <span class="id">e</span> <span class="gallina-kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|</span> <span class="id">inl</span> <span class="id">z</span> <span class="id">=&gt;</span> <span class="id">h</span> <span class="id">z</span> <span class="id">e</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|</span> <span class="id">inr</span> <span class="id">x</span> <span class="id">=&gt;</span> <span class="id">inr</span> <span class="id">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">end</span>.<br/>
<br/>
<span class="vernacular">Let</span> <span class="id">handle_envT'</span> <span class="id">:</span> <span class="id">E</span> <span class="id">\o</span> <span class="id">envT</span> <span class="id">Z</span> <span class="id">M</span> <span class="id">~~&gt;</span> <span class="id">envT</span> <span class="id">Z</span> <span class="id">M</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">fun</span> (<span class="id">X</span> <span class="id">:</span> <span class="id">UU0</span>) <span class="id">=&gt;</span> <span class="id">uncurry</span> (@<span class="id">handle_envT</span> <span class="id">X</span>).<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">handle_envTE</span> (<span class="id">X</span> <span class="id">:</span> <span class="id">UU0</span>) <span class="id">:</span><br/>
&nbsp;&nbsp;(<span class="id">slifting</span> <span class="id">handle</span> <span class="id">[the</span> <span class="id">fmt</span> <span class="id">of</span> <span class="id">envT</span> <span class="id">Z]</span> <span class="id">naturality_MK</span>) <span class="id">X</span> <span class="id">=</span> @<span class="id">handle_envT'</span> <span class="id">X</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof26')">Proof.</span></div>
<div class="proofscript" id="proof26">
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">slifting_envT;</span> <span class="id">apply</span> <span class="id">funext</span> <span class="id">=&gt;</span> <span class="id">-[m</span> <span class="id">f];</span> <span class="id">exact:</span> <span class="id">funext</span>.<br/>
Qed.</div>
<span class="vernacular">End</span> <span class="id">slifting_handle_envT</span>.<br/>
<br/>
<span class="vernacular">Section</span> <span class="id">slifting_handle_outputT</span>.<br/>
<span class="vernacular">Variable</span> <span class="id">R</span> <span class="id">:</span> <span class="id">UU0</span>.<br/>
<span class="vernacular">Definition</span> <span class="id">handle_outputT</span> (<span class="id">X</span> <span class="id">:</span> <span class="id">UU0</span>) (<span class="id">t</span> <span class="id">:</span> <span class="id">outputT</span> <span class="id">R</span> <span class="id">M</span> <span class="id">X</span>)<br/>
&nbsp;&nbsp;(<span class="id">h</span> <span class="id">:</span> <span class="id">unit</span> <span class="id">-&gt;</span> <span class="id">outputT</span> <span class="id">R</span> <span class="id">M</span> <span class="id">X</span>) <span class="id">:</span> <span class="id">outputT</span> <span class="id">R</span> <span class="id">M</span> <span class="id">X</span> <span class="id">:=</span> <span class="gallina-kwd">match</span> <span class="id">t</span> <span class="gallina-kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|</span> <span class="id">inl</span> <span class="id">z</span> <span class="id">=&gt;</span> <span class="id">h</span> <span class="id">z</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|</span> <span class="id">inr</span> <span class="id">x</span> <span class="id">=&gt;</span> <span class="id">inr</span> <span class="id">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">end</span>.<br/>
<br/>
<span class="vernacular">Let</span> <span class="id">handle_outputT'</span> <span class="id">:</span> <span class="id">E</span> <span class="id">\o</span> <span class="id">outputT</span> <span class="id">R</span> <span class="id">M</span> <span class="id">~~&gt;</span> <span class="id">outputT</span> <span class="id">R</span> <span class="id">M</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">fun</span> (<span class="id">X</span> <span class="id">:</span> <span class="id">UU0</span>) <span class="id">=&gt;</span> <span class="id">uncurry</span> (@<span class="id">handle_outputT</span> <span class="id">X</span>).<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">handle_outputTE</span> (<span class="id">X</span> <span class="id">:</span> <span class="id">UU0</span>) <span class="id">:</span><br/>
&nbsp;&nbsp;(<span class="id">slifting</span> <span class="id">handle</span> <span class="id">[the</span> <span class="id">fmt</span> <span class="id">of</span> <span class="id">outputT</span> <span class="id">R]</span> <span class="id">naturality_MK</span>) <span class="id">X</span> <span class="id">=</span> @<span class="id">handle_outputT'</span> <span class="id">X</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof27')">Proof.</span></div>
<div class="proofscript" id="proof27">
 <span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">slifting_outputT;</span> <span class="id">apply</span> <span class="id">funext</span> <span class="id">=&gt;</span> <span class="id">-[]</span>. Qed.</div>
<span class="vernacular">End</span> <span class="id">slifting_handle_outputT</span>.<br/>
<br/>
<span class="vernacular">End</span> <span class="id">slifting_handle</span>.<br/>
<br/>
<span class="vernacular">Section</span> <span class="id">slifting_flush</span>.<br/>
<span class="vernacular">Variable</span> <span class="id">R</span> <span class="id">:</span> <span class="id">UU0</span>.<br/>
<span class="vernacular">Let</span> <span class="id">E</span> <span class="id">:=</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">Flush.acto</span><span class="id">]</span>.<br/>
<span class="vernacular">Let</span> <span class="id">M</span> <span class="id">:=</span> <span class="id">[the</span> <span class="id">monad</span> <span class="id">of</span> <span class="id">OutputMonad.acto</span> <span class="id">R]</span>.<br/>
<span class="vernacular">Let</span> <span class="id">flush</span> <span class="id">:</span> <span class="id">E</span>.<span class="id">-operation</span> <span class="id">M</span> <span class="id">:=</span> <span class="id">flush_op</span> <span class="id">R</span>.<br/>
<span class="vernacular">Hypothesis</span> <span class="id">naturality_MK</span> <span class="id">:</span> <span class="gallina-kwd">forall</span> (<span class="id">A</span> <span class="id">:</span> <span class="id">UU0</span>) (<span class="id">m</span> <span class="id">:</span> <span class="id">MK</span> <span class="id">M</span> <span class="id">A</span>)<span class="id">,</span><br/>
&nbsp;&nbsp;<span class="id">naturality_MK</span> <span class="id">m</span>.<br/>
<br/>
<span class="vernacular">Section</span> <span class="id">slifting_flush_stateT</span>.<br/>
<span class="vernacular">Variable</span> <span class="id">S</span> <span class="id">:</span> <span class="id">UU0</span>.<br/>
<span class="vernacular">Definition</span> <span class="id">flush_stateT</span> <span class="id">:</span> <span class="id">stateT</span> <span class="id">S</span> <span class="id">M</span> <span class="id">~~&gt;</span> <span class="id">stateT</span> <span class="id">S</span> <span class="id">M</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">fun</span> (<span class="id">X</span> <span class="id">:</span> <span class="id">UU0</span>) <span class="id">t</span> <span class="id">s</span> <span class="id">=&gt;</span> <span class="id">let:</span> (<span class="id">x,</span> <span class="id">_</span>) <span class="id">:=</span> <span class="id">t</span> <span class="id">s</span> <span class="gallina-kwd">in</span> (<span class="id">x,</span> <span class="id">[::]</span>).<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">flush_stateTE</span> (<span class="id">X</span> <span class="id">:</span> <span class="id">UU0</span>) <span class="id">:</span><br/>
&nbsp;&nbsp;(<span class="id">slifting</span> <span class="id">flush</span> <span class="id">[the</span> <span class="id">fmt</span> <span class="id">of</span> <span class="id">stateT</span> <span class="id">S]</span> <span class="id">naturality_MK</span>) <span class="id">X</span> <span class="id">=</span> @<span class="id">flush_stateT</span> <span class="id">X</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof28')">Proof.</span></div>
<div class="proofscript" id="proof28">
 <span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">slifting_stateT</span>. Qed.</div>
<span class="vernacular">End</span> <span class="id">slifting_flush_stateT</span>.<br/>
<br/>
<span class="vernacular">Section</span> <span class="id">slifting_flush_exceptT</span>.<br/>
<span class="vernacular">Variable</span> <span class="id">Z</span> <span class="id">:</span> <span class="id">UU0</span>.<br/>
<span class="vernacular">Definition</span> <span class="id">flush_exceptT</span> (<span class="id">X</span> <span class="id">:</span> <span class="id">UU0</span>) (<span class="id">t</span> <span class="id">:</span> <span class="id">exceptT</span> <span class="id">Z</span> <span class="id">M</span> <span class="id">X</span>) (<span class="id">h</span> <span class="id">:</span> <span class="id">Z</span> <span class="id">-&gt;</span> <span class="id">exceptT</span> <span class="id">Z</span> <span class="id">M</span> <span class="id">X</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">:</span> <span class="id">exceptT</span> <span class="id">Z</span> <span class="id">M</span> <span class="id">X</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="id">let:</span> (<span class="id">c,</span> <span class="id">_</span>) <span class="id">:=</span> <span class="id">t</span> <span class="gallina-kwd">in</span> (<span class="id">c,</span> <span class="id">[::]</span>).<br/>
<br/>
<span class="vernacular">Let</span> <span class="id">flush_exceptT'</span> <span class="id">:</span> <span class="id">E</span> <span class="id">\o</span> <span class="id">exceptT</span> <span class="id">Z</span> <span class="id">M</span> <span class="id">~~&gt;</span> <span class="id">exceptT</span> <span class="id">Z</span> <span class="id">M</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">fun</span> (<span class="id">X</span> <span class="id">:</span> <span class="id">UU0</span>) <span class="id">c</span> <span class="id">=&gt;</span> <span class="gallina-kwd">let</span> <span class="id">:</span> (<span class="id">x,</span> <span class="id">_</span>) <span class="id">:=</span> <span class="id">c</span> <span class="gallina-kwd">in</span> (<span class="id">x,</span> <span class="id">[::]</span>).<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">flush_exceptTE</span> (<span class="id">X</span> <span class="id">:</span> <span class="id">UU0</span>) <span class="id">:</span><br/>
&nbsp;&nbsp;(<span class="id">slifting</span> <span class="id">flush</span> <span class="id">[the</span> <span class="id">fmt</span> <span class="id">of</span> <span class="id">exceptT</span> <span class="id">Z]</span> <span class="id">naturality_MK</span>) <span class="id">X</span> <span class="id">=</span> @<span class="id">flush_exceptT'</span> <span class="id">X</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof29')">Proof.</span></div>
<div class="proofscript" id="proof29">
 <span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">slifting_exceptT</span>. Qed.</div>
<span class="vernacular">End</span> <span class="id">slifting_flush_exceptT</span>.<br/>
<br/>
<span class="vernacular">Section</span> <span class="id">slifting_flush_envT</span>.<br/>
<span class="vernacular">Variable</span> <span class="id">Z</span> <span class="id">:</span> <span class="id">UU0</span>.<br/>
<span class="vernacular">Definition</span> <span class="id">flush_envT</span> <span class="id">:</span> <span class="id">envT</span> <span class="id">Z</span> <span class="id">M</span> <span class="id">~~&gt;</span>  <span class="id">envT</span> <span class="id">Z</span> <span class="id">M</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">fun</span> (<span class="id">X</span> <span class="id">:</span> <span class="id">UU0</span>) <span class="id">t</span> <span class="id">e</span> <span class="id">=&gt;</span> <span class="id">let:</span> (<span class="id">x,</span> <span class="id">_</span>) <span class="id">:=</span> <span class="id">t</span> <span class="id">e</span> <span class="gallina-kwd">in</span> (<span class="id">x,</span> <span class="id">[::]</span>).<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">flush_envTE</span> (<span class="id">X</span> <span class="id">:</span> <span class="id">UU0</span>) <span class="id">:</span><br/>
&nbsp;&nbsp;(<span class="id">slifting</span> <span class="id">flush</span> <span class="id">[the</span> <span class="id">fmt</span> <span class="id">of</span> <span class="id">envT</span> <span class="id">Z]</span> <span class="id">naturality_MK</span>) <span class="id">X</span> <span class="id">=</span> @<span class="id">flush_envT</span> <span class="id">X</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof30')">Proof.</span></div>
<div class="proofscript" id="proof30">
 <span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">slifting_envT</span>. Qed.</div>
<span class="vernacular">End</span> <span class="id">slifting_flush_envT</span>.<br/>
<br/>
<span class="vernacular">Section</span> <span class="id">slifting_flush_outputT</span>.<br/>
<span class="vernacular">Variable</span> <span class="id">Z</span> <span class="id">:</span> <span class="id">UU0</span>.<br/>
<span class="vernacular">Definition</span> <span class="id">flush_outputT</span> (<span class="id">X</span> <span class="id">:</span> <span class="id">UU0</span>) (<span class="id">t</span> <span class="id">:</span> <span class="id">outputT</span> <span class="id">R</span> <span class="id">M</span> <span class="id">X</span>) (<span class="id">h</span> <span class="id">:</span> <span class="id">Z</span> <span class="id">-&gt;</span> <span class="id">outputT</span> <span class="id">R</span> <span class="id">M</span> <span class="id">X</span>)<br/>
&nbsp;&nbsp;<span class="id">:</span> <span class="id">outputT</span> <span class="id">R</span> <span class="id">M</span> <span class="id">X</span> <span class="id">:=</span> <span class="id">let:</span> (<span class="id">p,</span> <span class="id">w</span>) <span class="id">:=</span> <span class="id">t</span> <span class="gallina-kwd">in</span> (<span class="id">p,</span> <span class="id">[::]</span>).<br/>
<br/>
<span class="vernacular">Let</span> <span class="id">flush_outputT'</span> <span class="id">:</span> <span class="id">E</span> <span class="id">\o</span> <span class="id">outputT</span> <span class="id">R</span> <span class="id">M</span> <span class="id">~~&gt;</span> <span class="id">outputT</span> <span class="id">R</span> <span class="id">M</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">fun</span> (<span class="id">X</span> <span class="id">:</span> <span class="id">UU0</span>) <span class="id">e</span> <span class="id">=&gt;</span> <span class="id">let:</span> (<span class="id">pw,</span> <span class="id">w'</span>) <span class="id">:=</span> <span class="id">e</span> <span class="gallina-kwd">in</span> (<span class="id">pw,</span> <span class="id">[::]</span>).<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">flush_outputTE</span> (<span class="id">X</span> <span class="id">:</span> <span class="id">UU0</span>) <span class="id">:</span><br/>
&nbsp;&nbsp;(<span class="id">slifting</span> <span class="id">flush</span> <span class="id">[the</span> <span class="id">fmt</span> <span class="id">of</span> <span class="id">outputT</span> <span class="id">R]</span> <span class="id">naturality_MK</span>) <span class="id">X</span> <span class="id">=</span> @<span class="id">flush_outputT'</span> <span class="id">X</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof31')">Proof.</span></div>
<div class="proofscript" id="proof31">
 <span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">slifting_outputT;</span> <span class="id">exact:</span> <span class="id">funext</span>. Qed.</div>
<span class="vernacular">End</span> <span class="id">slifting_flush_outputT</span>.<br/>
<br/>
<span class="vernacular">End</span> <span class="id">slifting_flush</span>.<br/>

      <div class="footer"><hr/>Generated by <a href="https://github.com/yoshihiro503/coq2html/">a fork of coq2html</a></div>
    </div>
  </div>
    </main>
</body>
</html>
