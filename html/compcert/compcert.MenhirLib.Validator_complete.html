
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module Validator_complete</title>
<meta name="description" content="Documentation of Coq module Validator_complete" />
<link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
<script src="https://cdn.jsdelivr.net/npm/markdown-it/dist/markdown-it.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/markdown-it-texmath/texmath.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script>
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="init('proofscript')">

  <main>
    <div class="sidebar">
      <h2>Files</h2>
      <li><details id="compcert"><summary>compcert</summary>
          <ul>
          <li><details id="compcert.backend"><summary>backend</summary>
          <ul>
          <li><a href="compcert.backend.Allocation.html">Allocation</a></li>
<li><a href="compcert.backend.Allocproof.html">Allocproof</a></li>
<li><a href="compcert.backend.Asmgenproof0.html">Asmgenproof0</a></li>
<li><a href="compcert.backend.Bounds.html">Bounds</a></li>
<li><a href="compcert.backend.CleanupLabels.html">CleanupLabels</a></li>
<li><a href="compcert.backend.CleanupLabelsproof.html">CleanupLabelsproof</a></li>
<li><a href="compcert.backend.Cminor.html">Cminor</a></li>
<li><a href="compcert.backend.CminorSel.html">CminorSel</a></li>
<li><a href="compcert.backend.Cminortyping.html">Cminortyping</a></li>
<li><a href="compcert.backend.Constprop.html">Constprop</a></li>
<li><a href="compcert.backend.Constpropproof.html">Constpropproof</a></li>
<li><a href="compcert.backend.Conventions.html">Conventions</a></li>
<li><a href="compcert.backend.CSE.html">CSE</a></li>
<li><a href="compcert.backend.CSEdomain.html">CSEdomain</a></li>
<li><a href="compcert.backend.CSEproof.html">CSEproof</a></li>
<li><a href="compcert.backend.Deadcode.html">Deadcode</a></li>
<li><a href="compcert.backend.Deadcodeproof.html">Deadcodeproof</a></li>
<li><a href="compcert.backend.Debugvar.html">Debugvar</a></li>
<li><a href="compcert.backend.Debugvarproof.html">Debugvarproof</a></li>
<li><a href="compcert.backend.Inlining.html">Inlining</a></li>
<li><a href="compcert.backend.Inliningproof.html">Inliningproof</a></li>
<li><a href="compcert.backend.Inliningspec.html">Inliningspec</a></li>
<li><a href="compcert.backend.Kildall.html">Kildall</a></li>
<li><a href="compcert.backend.Linear.html">Linear</a></li>
<li><a href="compcert.backend.Linearize.html">Linearize</a></li>
<li><a href="compcert.backend.Linearizeproof.html">Linearizeproof</a></li>
<li><a href="compcert.backend.Lineartyping.html">Lineartyping</a></li>
<li><a href="compcert.backend.Liveness.html">Liveness</a></li>
<li><a href="compcert.backend.Locations.html">Locations</a></li>
<li><a href="compcert.backend.LTL.html">LTL</a></li>
<li><a href="compcert.backend.Mach.html">Mach</a></li>
<li><a href="compcert.backend.NeedDomain.html">NeedDomain</a></li>
<li><a href="compcert.backend.Registers.html">Registers</a></li>
<li><a href="compcert.backend.Renumber.html">Renumber</a></li>
<li><a href="compcert.backend.Renumberproof.html">Renumberproof</a></li>
<li><a href="compcert.backend.RTL.html">RTL</a></li>
<li><a href="compcert.backend.RTLgen.html">RTLgen</a></li>
<li><a href="compcert.backend.RTLgenproof.html">RTLgenproof</a></li>
<li><a href="compcert.backend.RTLgenspec.html">RTLgenspec</a></li>
<li><a href="compcert.backend.RTLtyping.html">RTLtyping</a></li>
<li><a href="compcert.backend.SelectDiv.html">SelectDiv</a></li>
<li><a href="compcert.backend.SelectDivproof.html">SelectDivproof</a></li>
<li><a href="compcert.backend.Selection.html">Selection</a></li>
<li><a href="compcert.backend.Selectionproof.html">Selectionproof</a></li>
<li><a href="compcert.backend.SplitLong.html">SplitLong</a></li>
<li><a href="compcert.backend.SplitLongproof.html">SplitLongproof</a></li>
<li><a href="compcert.backend.Stacking.html">Stacking</a></li>
<li><a href="compcert.backend.Stackingproof.html">Stackingproof</a></li>
<li><a href="compcert.backend.Tailcall.html">Tailcall</a></li>
<li><a href="compcert.backend.Tailcallproof.html">Tailcallproof</a></li>
<li><a href="compcert.backend.Tunneling.html">Tunneling</a></li>
<li><a href="compcert.backend.Tunnelingproof.html">Tunnelingproof</a></li>
<li><a href="compcert.backend.Unusedglob.html">Unusedglob</a></li>
<li><a href="compcert.backend.Unusedglobproof.html">Unusedglobproof</a></li>
<li><a href="compcert.backend.ValueAnalysis.html">ValueAnalysis</a></li>
<li><a href="compcert.backend.ValueDomain.html">ValueDomain</a></li>
          </ul>
          </details>
          </li>
<li><details id="compcert.cfrontend"><summary>cfrontend</summary>
          <ul>
          <li><a href="compcert.cfrontend.Cexec.html">Cexec</a></li>
<li><a href="compcert.cfrontend.Clight.html">Clight</a></li>
<li><a href="compcert.cfrontend.ClightBigstep.html">ClightBigstep</a></li>
<li><a href="compcert.cfrontend.Cminorgen.html">Cminorgen</a></li>
<li><a href="compcert.cfrontend.Cminorgenproof.html">Cminorgenproof</a></li>
<li><a href="compcert.cfrontend.Cop.html">Cop</a></li>
<li><a href="compcert.cfrontend.Csem.html">Csem</a></li>
<li><a href="compcert.cfrontend.Csharpminor.html">Csharpminor</a></li>
<li><a href="compcert.cfrontend.Cshmgen.html">Cshmgen</a></li>
<li><a href="compcert.cfrontend.Cshmgenproof.html">Cshmgenproof</a></li>
<li><a href="compcert.cfrontend.Cstrategy.html">Cstrategy</a></li>
<li><a href="compcert.cfrontend.Csyntax.html">Csyntax</a></li>
<li><a href="compcert.cfrontend.Ctypes.html">Ctypes</a></li>
<li><a href="compcert.cfrontend.Ctyping.html">Ctyping</a></li>
<li><a href="compcert.cfrontend.Initializers.html">Initializers</a></li>
<li><a href="compcert.cfrontend.Initializersproof.html">Initializersproof</a></li>
<li><a href="compcert.cfrontend.SimplExpr.html">SimplExpr</a></li>
<li><a href="compcert.cfrontend.SimplExprproof.html">SimplExprproof</a></li>
<li><a href="compcert.cfrontend.SimplExprspec.html">SimplExprspec</a></li>
<li><a href="compcert.cfrontend.SimplLocals.html">SimplLocals</a></li>
<li><a href="compcert.cfrontend.SimplLocalsproof.html">SimplLocalsproof</a></li>
          </ul>
          </details>
          </li>
<li><details id="compcert.common"><summary>common</summary>
          <ul>
          <li><a href="compcert.common.AST.html">AST</a></li>
<li><a href="compcert.common.Behaviors.html">Behaviors</a></li>
<li><a href="compcert.common.Builtins.html">Builtins</a></li>
<li><a href="compcert.common.Builtins0.html">Builtins0</a></li>
<li><a href="compcert.common.Determinism.html">Determinism</a></li>
<li><a href="compcert.common.Errors.html">Errors</a></li>
<li><a href="compcert.common.Events.html">Events</a></li>
<li><a href="compcert.common.Globalenvs.html">Globalenvs</a></li>
<li><a href="compcert.common.Linking.html">Linking</a></li>
<li><a href="compcert.common.Memdata.html">Memdata</a></li>
<li><a href="compcert.common.Memory.html">Memory</a></li>
<li><a href="compcert.common.Memtype.html">Memtype</a></li>
<li><a href="compcert.common.Separation.html">Separation</a></li>
<li><a href="compcert.common.Smallstep.html">Smallstep</a></li>
<li><a href="compcert.common.Switch.html">Switch</a></li>
<li><a href="compcert.common.Unityping.html">Unityping</a></li>
<li><a href="compcert.common.Values.html">Values</a></li>
          </ul>
          </details>
          </li>
<li><details id="compcert.cparser"><summary>cparser</summary>
          <ul>
          <li><a href="compcert.cparser.Cabs.html">Cabs</a></li>
<li><a href="compcert.cparser.Parser.html">Parser</a></li>
          </ul>
          </details>
          </li>
<li><details id="compcert.driver"><summary>driver</summary>
          <ul>
          <li><a href="compcert.driver.Compiler.html">Compiler</a></li>
<li><a href="compcert.driver.Complements.html">Complements</a></li>
<li><a href="compcert.driver.Compopts.html">Compopts</a></li>
          </ul>
          </details>
          </li>
<li><details id="compcert.lib"><summary>lib</summary>
          <ul>
          <li><a href="compcert.lib.Axioms.html">Axioms</a></li>
<li><a href="compcert.lib.BoolEqual.html">BoolEqual</a></li>
<li><a href="compcert.lib.Coqlib.html">Coqlib</a></li>
<li><a href="compcert.lib.Decidableplus.html">Decidableplus</a></li>
<li><a href="compcert.lib.Floats.html">Floats</a></li>
<li><a href="compcert.lib.FSetAVLplus.html">FSetAVLplus</a></li>
<li><a href="compcert.lib.Heaps.html">Heaps</a></li>
<li><a href="compcert.lib.IEEE754_extra.html">IEEE754_extra</a></li>
<li><a href="compcert.lib.Integers.html">Integers</a></li>
<li><a href="compcert.lib.Intv.html">Intv</a></li>
<li><a href="compcert.lib.IntvSets.html">IntvSets</a></li>
<li><a href="compcert.lib.Iteration.html">Iteration</a></li>
<li><a href="compcert.lib.Lattice.html">Lattice</a></li>
<li><a href="compcert.lib.Maps.html">Maps</a></li>
<li><a href="compcert.lib.Ordered.html">Ordered</a></li>
<li><a href="compcert.lib.Parmov.html">Parmov</a></li>
<li><a href="compcert.lib.Postorder.html">Postorder</a></li>
<li><a href="compcert.lib.UnionFind.html">UnionFind</a></li>
<li><a href="compcert.lib.Wfsimpl.html">Wfsimpl</a></li>
<li><a href="compcert.lib.Zbits.html">Zbits</a></li>
          </ul>
          </details>
          </li>
<li><details id="compcert.x86"><summary>x86</summary>
          <ul>
          <li><a href="compcert.x86.Asm.html">Asm</a></li>
<li><a href="compcert.x86.Asmgen.html">Asmgen</a></li>
<li><a href="compcert.x86.Asmgenproof.html">Asmgenproof</a></li>
<li><a href="compcert.x86.Asmgenproof1.html">Asmgenproof1</a></li>
<li><a href="compcert.x86.Builtins1.html">Builtins1</a></li>
<li><a href="compcert.x86.CombineOp.html">CombineOp</a></li>
<li><a href="compcert.x86.CombineOpproof.html">CombineOpproof</a></li>
<li><a href="compcert.x86.ConstpropOp.html">ConstpropOp</a></li>
<li><a href="compcert.x86.ConstpropOpproof.html">ConstpropOpproof</a></li>
<li><a href="compcert.x86.Conventions1.html">Conventions1</a></li>
<li><a href="compcert.x86.Machregs.html">Machregs</a></li>
<li><a href="compcert.x86.NeedOp.html">NeedOp</a></li>
<li><a href="compcert.x86.Op.html">Op</a></li>
<li><a href="compcert.x86.SelectLong.html">SelectLong</a></li>
<li><a href="compcert.x86.SelectLongproof.html">SelectLongproof</a></li>
<li><a href="compcert.x86.SelectOp.html">SelectOp</a></li>
<li><a href="compcert.x86.SelectOpproof.html">SelectOpproof</a></li>
<li><a href="compcert.x86.Stacklayout.html">Stacklayout</a></li>
<li><a href="compcert.x86.ValueAOp.html">ValueAOp</a></li>
          </ul>
          </details>
          </li>
<li><details id="compcert.x86_64"><summary>x86_64</summary>
          <ul>
          <li><a href="compcert.x86_64.Archi.html">Archi</a></li>
          </ul>
          </details>
          </li>
          </ul>
          </details>
          </li>
<li><details id="Flocq"><summary>Flocq</summary>
          <ul>
          <li><details id="Flocq.Calc"><summary>Calc</summary>
          <ul>
          <li><a href="Flocq.Calc.Bracket.html">Bracket</a></li>
<li><a href="Flocq.Calc.Div.html">Div</a></li>
<li><a href="Flocq.Calc.Operations.html">Operations</a></li>
<li><a href="Flocq.Calc.Plus.html">Plus</a></li>
<li><a href="Flocq.Calc.Round.html">Round</a></li>
<li><a href="Flocq.Calc.Sqrt.html">Sqrt</a></li>
          </ul>
          </details>
          </li>
<li><details id="Flocq.Core"><summary>Core</summary>
          <ul>
          <li><a href="Flocq.Core.Core.html">Core</a></li>
<li><a href="Flocq.Core.Defs.html">Defs</a></li>
<li><a href="Flocq.Core.Digits.html">Digits</a></li>
<li><a href="Flocq.Core.FIX.html">FIX</a></li>
<li><a href="Flocq.Core.Float_prop.html">Float_prop</a></li>
<li><a href="Flocq.Core.FLT.html">FLT</a></li>
<li><a href="Flocq.Core.FLX.html">FLX</a></li>
<li><a href="Flocq.Core.FTZ.html">FTZ</a></li>
<li><a href="Flocq.Core.Generic_fmt.html">Generic_fmt</a></li>
<li><a href="Flocq.Core.Raux.html">Raux</a></li>
<li><a href="Flocq.Core.Round_NE.html">Round_NE</a></li>
<li><a href="Flocq.Core.Round_pred.html">Round_pred</a></li>
<li><a href="Flocq.Core.Ulp.html">Ulp</a></li>
<li><a href="Flocq.Core.Zaux.html">Zaux</a></li>
          </ul>
          </details>
          </li>
<li><details id="Flocq.IEEE754"><summary>IEEE754</summary>
          <ul>
          <li><a href="Flocq.IEEE754.Binary.html">Binary</a></li>
<li><a href="Flocq.IEEE754.BinarySingleNaN.html">BinarySingleNaN</a></li>
<li><a href="Flocq.IEEE754.Bits.html">Bits</a></li>
          </ul>
          </details>
          </li>
<li><details id="Flocq.Prop"><summary>Prop</summary>
          <ul>
          <li><a href="Flocq.Prop.Div_sqrt_error.html">Div_sqrt_error</a></li>
<li><a href="Flocq.Prop.Double_rounding.html">Double_rounding</a></li>
<li><a href="Flocq.Prop.Mult_error.html">Mult_error</a></li>
<li><a href="Flocq.Prop.Plus_error.html">Plus_error</a></li>
<li><a href="Flocq.Prop.Relative.html">Relative</a></li>
<li><a href="Flocq.Prop.Round_odd.html">Round_odd</a></li>
<li><a href="Flocq.Prop.Sterbenz.html">Sterbenz</a></li>
          </ul>
          </details>
          </li>
          </ul>
          </details>
          </li>
<li><details id="MenhirLib"><summary>MenhirLib</summary>
          <ul>
          <li><a href="MenhirLib.Alphabet.html">Alphabet</a></li>
<li><a href="MenhirLib.Automaton.html">Automaton</a></li>
<li><a href="MenhirLib.Grammar.html">Grammar</a></li>
<li><a href="MenhirLib.Interpreter.html">Interpreter</a></li>
<li><a href="MenhirLib.Interpreter_complete.html">Interpreter_complete</a></li>
<li><a href="MenhirLib.Interpreter_correct.html">Interpreter_correct</a></li>
<li><a href="MenhirLib.Main.html">Main</a></li>
<li><a href="MenhirLib.Validator_classes.html">Validator_classes</a></li>
<li><a href="MenhirLib.Validator_complete.html">Validator_complete</a></li>
<li><a href="MenhirLib.Validator_safe.html">Validator_safe</a></li>
          </ul>
          </details>
          </li>
    </div>

  <div class="coq">

    <div class="content">
      <p><a href="./index.html">Top</a></p>
      <h1 class="title">Module Validator_complete</h1>
<pre class="ssrdoc">
                                                                         
                                  Menhir                                 
                                                                         
          Jacques-Henri Jourdan, CNRS, LRI, Université Paris Sud         
                                                                         
 Copyright Inria. All rights reserved. This file is distributed under    
 the terms of the GNU Lesser General Public License as published by the  
 Free Software Foundation, either version 3 of the License, or (at your  
 option) any later version, as described in the file LICENSE.            
                                                                         
</pre>
<br/>
<span class="vernacular">From</span> <span class="id">Coq</span> <span class="vernacular">Require</span> <span class="vernacular">Import</span> <span class="id">List</span> <span class="id">Syntax</span> <span class="id">Derive</span>.<br/>
<span class="vernacular">From</span> <span class="id">Coq.ssr</span> <span class="vernacular">Require</span> <span class="vernacular">Import</span> <span class="id">ssreflect</span>.<br/>
<span class="vernacular">Import</span> <span class="id">ListNotations</span>.<br/>
<span class="vernacular">Require</span> <span class="id">Automaton</span>.<br/>
<span class="vernacular">Require</span> <span class="vernacular">Import</span> <span class="id">Alphabet</span> <span class="id">Validator_classes</span>.<br/>
<br/>
<span class="vernacular">Module</span> <span class="id">Make</span>(<span class="vernacular">Import</span> <span class="id">A:Automaton</span>.<span class="id">T</span>).<br/>
<br/>
<div class="doc">We instantiate some sets/map. *</div>
<span class="vernacular">Module</span> <span class="id">TerminalComparableM</span> <span class="id">&lt;:</span> <span class="id">ComparableM</span>.<br/>
&nbsp;&nbsp;<span class="vernacular">Definition</span> <span class="id">t</span> <span class="id">:=</span> <span class="id">terminal</span>.<br/>
&nbsp;&nbsp;<span class="id">Global</span> <span class="vernacular">Instance</span> <span class="id">tComparable</span> <span class="id">:</span> <span class="id">Comparable</span> <span class="id">t</span> <span class="id">:=</span> <span class="id">_</span>.<br/>
<span class="vernacular">End</span> <span class="id">TerminalComparableM</span>.<br/>
<span class="vernacular">Module</span> <span class="id">TerminalOrderedType</span> <span class="id">:=</span> <span class="id">OrderedType_from_ComparableM</span> <span class="id">TerminalComparableM</span>.<br/>
<span class="vernacular">Module</span> <span class="id">StateProdPosComparableM</span> <span class="id">&lt;:</span> <span class="id">ComparableM</span>.<br/>
&nbsp;&nbsp;<span class="vernacular">Definition</span> <span class="id">t</span> <span class="id">:=</span> (<span class="id">state*production*nat</span>)%<span class="id">type</span>.<br/>
&nbsp;&nbsp;<span class="id">Global</span> <span class="vernacular">Instance</span> <span class="id">tComparable</span> <span class="id">:</span> <span class="id">Comparable</span> <span class="id">t</span> <span class="id">:=</span> <span class="id">_</span>.<br/>
<span class="vernacular">End</span> <span class="id">StateProdPosComparableM</span>.<br/>
<span class="vernacular">Module</span> <span class="id">StateProdPosOrderedType</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="id">OrderedType_from_ComparableM</span> <span class="id">StateProdPosComparableM</span>.<br/>
<br/>
<span class="vernacular">Module</span> <span class="id">TerminalSet</span> <span class="id">:=</span> <span class="id">FSetAVL.Make</span> <span class="id">TerminalOrderedType</span>.<br/>
<span class="vernacular">Module</span> <span class="id">StateProdPosMap</span> <span class="id">:=</span> <span class="id">FMapAVL.Make</span> <span class="id">StateProdPosOrderedType</span>.<br/>
<br/>
<div class="doc">Nullable predicate for symbols and list of symbols. *</div>
<span class="vernacular">Definition</span> <span class="id">nullable_symb</span> (<span class="id">symbol:symbol</span>) <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">match</span> <span class="id">symbol</span> <span class="gallina-kwd">with</span><br/>
&nbsp;&nbsp;<span class="id">|</span> <span class="id">NT</span> <span class="id">nt</span> <span class="id">=&gt;</span> <span class="id">nullable_nterm</span> <span class="id">nt</span><br/>
&nbsp;&nbsp;<span class="id">|</span> <span class="id">_</span> <span class="id">=&gt;</span> <span class="id">false</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">end</span>.<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">nullable_word</span> (<span class="id">word:list</span> <span class="id">symbol</span>) <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="id">forallb</span> <span class="id">nullable_symb</span> <span class="id">word</span>.<br/>
<br/>
<div class="doc">First predicate for non terminal, symbols and list of symbols, given as FSets. *</div>
<span class="vernacular">Definition</span> <span class="id">first_nterm_set</span> (<span class="id">nterm:nonterminal</span>) <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="id">fold_left</span> (<span class="gallina-kwd">fun</span> <span class="id">acc</span> <span class="id">t</span> <span class="id">=&gt;</span> <span class="id">TerminalSet.add</span> <span class="id">t</span> <span class="id">acc</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">first_nterm</span> <span class="id">nterm</span>) <span class="id">TerminalSet.empty</span>.<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">first_symb_set</span> (<span class="id">symbol:symbol</span>) <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">match</span> <span class="id">symbol</span> <span class="gallina-kwd">with</span><br/>
&nbsp;&nbsp;<span class="id">|</span> <span class="id">NT</span> <span class="id">nt</span> <span class="id">=&gt;</span> <span class="id">first_nterm_set</span> <span class="id">nt</span><br/>
&nbsp;&nbsp;<span class="id">|</span> <span class="id">T</span> <span class="id">t</span> <span class="id">=&gt;</span> <span class="id">TerminalSet.singleton</span> <span class="id">t</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">end</span>.<br/>
<br/>
<span class="vernacular">Fixpoint</span> <span class="id">first_word_set</span> (<span class="id">word:list</span> <span class="id">symbol</span>) <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">match</span> <span class="id">word</span> <span class="gallina-kwd">with</span><br/>
&nbsp;&nbsp;<span class="id">|</span> <span class="id">[]</span> <span class="id">=&gt;</span> <span class="id">TerminalSet.empty</span><br/>
&nbsp;&nbsp;<span class="id">|</span> <span class="id">t::q</span> <span class="id">=&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">if</span> <span class="id">nullable_symb</span> <span class="id">t</span> <span class="gallina-kwd">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">TerminalSet.union</span> (<span class="id">first_symb_set</span> <span class="id">t</span>) (<span class="id">first_word_set</span> <span class="id">q</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">first_symb_set</span> <span class="id">t</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">end</span>.<br/>
<br/>
<div class="doc">Small helper for finding the part of an item that is after the dot. *</div>
<span class="vernacular">Definition</span> <span class="id">future_of_prod</span> <span class="id">prod</span> <span class="id">dot_pos</span> <span class="id">:</span> <span class="id">list</span> <span class="id">symbol</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">fix</span> <span class="id">loop</span> <span class="id">n</span> <span class="id">lst</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">match</span> <span class="id">n</span> <span class="gallina-kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|</span> <span class="id">O</span> <span class="id">=&gt;</span> <span class="id">lst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|</span> <span class="id">S</span> <span class="id">x</span> <span class="id">=&gt;</span> <span class="gallina-kwd">match</span> <span class="id">loop</span> <span class="id">x</span> <span class="id">lst</span> <span class="gallina-kwd">with</span> <span class="id">[]</span> <span class="id">=&gt;</span> <span class="id">[]</span> <span class="id">|</span> <span class="id">_::q</span> <span class="id">=&gt;</span> <span class="id">q</span> <span class="gallina-kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">end</span>)<br/>
&nbsp;&nbsp;<span class="id">dot_pos</span> (<span class="id">rev'</span> (<span class="id">prod_rhs_rev</span> <span class="id">prod</span>)).<br/>
<br/>
<div class="doc">We build a fast map to store all the items of all the states. *</div>
<span class="vernacular">Definition</span> <span class="id">items_map</span> (<span class="id">_:unit</span>)<span class="id">:</span> <span class="id">StateProdPosMap.t</span> <span class="id">TerminalSet.t</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="id">fold_left</span> (<span class="gallina-kwd">fun</span> <span class="id">acc</span> <span class="id">state</span> <span class="id">=&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fold_left</span> (<span class="gallina-kwd">fun</span> <span class="id">acc</span> <span class="id">item</span> <span class="id">=&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">let</span> <span class="id">key</span> <span class="id">:=</span> (<span class="id">state,</span> <span class="id">prod_item</span> <span class="id">item,</span> <span class="id">dot_pos_item</span> <span class="id">item</span>) <span class="gallina-kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">let</span> <span class="id">data</span> <span class="id">:=</span> <span class="id">fold_left</span> (<span class="gallina-kwd">fun</span> <span class="id">acc</span> <span class="id">t</span> <span class="id">=&gt;</span> <span class="id">TerminalSet.add</span> <span class="id">t</span> <span class="id">acc</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">lookaheads_item</span> <span class="id">item</span>) <span class="id">TerminalSet.empty</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">let</span> <span class="id">old</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">match</span> <span class="id">StateProdPosMap.find</span> <span class="id">key</span> <span class="id">acc</span> <span class="gallina-kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|</span> <span class="id">Some</span> <span class="id">x</span> <span class="id">=&gt;</span> <span class="id">x</span> <span class="id">|</span> <span class="id">None</span> <span class="id">=&gt;</span> <span class="id">TerminalSet.empty</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">StateProdPosMap.add</span> <span class="id">key</span> (<span class="id">TerminalSet.union</span> <span class="id">data</span> <span class="id">old</span>) <span class="id">acc</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;) (<span class="id">items_of_state</span> <span class="id">state</span>) <span class="id">acc</span><br/>
&nbsp;&nbsp;) <span class="id">all_list</span> (<span class="id">StateProdPosMap.empty</span> <span class="id">TerminalSet.t</span>).<br/>
<br/>
<div class="doc">We need to avoid computing items_map each time we need it. To that
  purpose, we declare a typeclass specifying that some map is equal to
  items_map. </div>
<span class="vernacular">Class</span> <span class="id">IsItemsMap</span> <span class="id">m</span> <span class="id">:=</span> <span class="id">is_items_map</span> <span class="id">:</span> <span class="id">m</span> <span class="id">=</span> <span class="id">items_map</span> ().<br/>
<br/>
<div class="doc">Accessor. *</div>
<span class="vernacular">Definition</span> <span class="id">find_items_map</span> <span class="id">items_map</span> <span class="id">state</span> <span class="id">prod</span> <span class="id">dot_pos</span> <span class="id">:</span> <span class="id">TerminalSet.t</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">match</span> <span class="id">StateProdPosMap.find</span> (<span class="id">state,</span> <span class="id">prod,</span> <span class="id">dot_pos</span>) <span class="id">items_map</span> <span class="gallina-kwd">with</span><br/>
&nbsp;&nbsp;<span class="id">|</span> <span class="id">None</span> <span class="id">=&gt;</span> <span class="id">TerminalSet.empty</span><br/>
&nbsp;&nbsp;<span class="id">|</span> <span class="id">Some</span> <span class="id">x</span> <span class="id">=&gt;</span> <span class="id">x</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">end</span>.<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">state_has_future</span> <span class="id">state</span> <span class="id">prod</span> (<span class="id">fut:list</span> <span class="id">symbol</span>) (<span class="id">lookahead:terminal</span>) <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span> <span class="id">dot_pos:nat,</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fut</span> <span class="id">=</span> <span class="id">future_of_prod</span> <span class="id">prod</span> <span class="id">dot_pos</span> <span class="id">/\</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">TerminalSet.In</span> <span class="id">lookahead</span> (<span class="id">find_items_map</span> (<span class="id">items_map</span> ()) <span class="id">state</span> <span class="id">prod</span> <span class="id">dot_pos</span>).<br/>
<br/>
<div class="doc">Iterator over items. *</div>
<span class="vernacular">Definition</span> <span class="id">forallb_items</span> <span class="id">items_map</span> (<span class="id">P:state</span> <span class="id">-&gt;</span> <span class="id">production</span> <span class="id">-&gt;</span> <span class="id">nat</span> <span class="id">-&gt;</span> <span class="id">TerminalSet.t</span> <span class="id">-&gt;</span> <span class="id">bool</span>)<span class="id">:</span> <span class="id">bool:=</span><br/>
&nbsp;&nbsp;<span class="id">StateProdPosMap.fold</span> (<span class="gallina-kwd">fun</span> <span class="id">key</span> <span class="id">set</span> <span class="id">acc</span> <span class="id">=&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">match</span> <span class="id">key</span> <span class="gallina-kwd">with</span> (<span class="id">st,</span> <span class="id">p,</span> <span class="id">pos</span>) <span class="id">=&gt;</span> (<span class="id">acc</span> &amp;&amp; <span class="id">P</span> <span class="id">st</span> <span class="id">p</span> <span class="id">pos</span> <span class="id">set</span>)%<span class="id">bool</span> <span class="gallina-kwd">end</span><br/>
&nbsp;&nbsp;) <span class="id">items_map</span> <span class="id">true</span>.<br/>
<br/>
<div class="doc">Typeclass instances for synthetizing the validator. </div>
<br/>
<span class="id">Global</span> <span class="vernacular">Instance</span> <span class="id">is_validator_subset</span> <span class="id">S1</span> <span class="id">S2</span> <span class="id">:</span><br/>
&nbsp;&nbsp;<span class="id">IsValidator</span> (<span class="id">TerminalSet.Subset</span> <span class="id">S1</span> <span class="id">S2</span>) (<span class="id">TerminalSet.subset</span> <span class="id">S1</span> <span class="id">S2</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof1')">Proof.</span></div>
<div class="proofscript" id="proof1">
 <span class="id">intros</span> <span class="id">?</span>. <span class="gallina-kwd">by</span> <span class="id">apply</span> <span class="id">TerminalSet.subset_2</span>. Qed.</div>
<br/>
<span class="vernacular">Lemma</span> <span class="id">is_validator_state_has_future_subset</span> <span class="id">st</span> <span class="id">prod</span> <span class="id">pos</span> <span class="id">lookahead</span> <span class="id">lset</span> <span class="id">im</span> <span class="id">fut</span> <span class="id">:</span><br/>
&nbsp;&nbsp;<span class="id">TerminalSet.In</span> <span class="id">lookahead</span> <span class="id">lset</span> <span class="id">-&gt;</span><br/>
&nbsp;&nbsp;<span class="id">fut</span> <span class="id">=</span> <span class="id">future_of_prod</span> <span class="id">prod</span> <span class="id">pos</span> <span class="id">-&gt;</span><br/>
&nbsp;&nbsp;<span class="id">IsItemsMap</span> <span class="id">im</span> <span class="id">-&gt;</span><br/>
&nbsp;&nbsp;<span class="id">IsValidator</span> (<span class="id">state_has_future</span> <span class="id">st</span> <span class="id">prod</span> <span class="id">fut</span> <span class="id">lookahead</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">TerminalSet.subset</span> <span class="id">lset</span> (<span class="id">find_items_map</span> <span class="id">im</span> <span class="id">st</span> <span class="id">prod</span> <span class="id">pos</span>)).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof2')">Proof.</span></div>
<div class="proofscript" id="proof2">
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">?</span> <span class="id">-&gt;</span> <span class="id">-&gt;</span> <span class="id">HSS</span>%<span class="id">TerminalSet.subset_2</span>. <span class="gallina-kwd">exists</span> <span class="id">pos</span>. <span class="id">split=&gt;//</span>. <span class="gallina-kwd">by</span> <span class="id">apply</span> <span class="id">HSS</span>.<br/>
Qed.</div>
<span class="id">Global</span> <span class="vernacular">Hint</span> <span class="id">Extern</span> <span class="id">2</span> (<span class="id">IsValidator</span> (<span class="id">state_has_future</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>) <span class="id">_</span>) <span class="id">=&gt;</span><br/>
&nbsp;&nbsp;<span class="id">eapply</span> <span class="id">is_validator_state_has_future_subset;</span> <span class="id">[eassumption|eassumption</span> <span class="id">||</span> <span class="id">reflexivity|]</span><br/>
<span class="id">:</span> <span class="id">typeclass_instances</span>.<br/>
<br/>
<span class="id">Global</span> <span class="vernacular">Instance</span> <span class="id">is_validator_forall_lookahead_set</span> <span class="id">lset</span> <span class="id">P</span> <span class="id">b:</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span> <span class="id">lookahead,</span> <span class="id">TerminalSet.In</span> <span class="id">lookahead</span> <span class="id">lset</span> <span class="id">-&gt;</span> <span class="id">IsValidator</span> (<span class="id">P</span> <span class="id">lookahead</span>) <span class="id">b</span>) <span class="id">-&gt;</span><br/>
&nbsp;&nbsp;<span class="id">IsValidator</span> (<span class="gallina-kwd">forall</span> <span class="id">lookahead,</span> <span class="id">TerminalSet.In</span> <span class="id">lookahead</span> <span class="id">lset</span> <span class="id">-&gt;</span> <span class="id">P</span> <span class="id">lookahead</span>) <span class="id">b</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof3')">Proof.</span></div>
<div class="proofscript" id="proof3">
 <span class="id">unfold</span> <span class="id">IsValidator</span>. <span class="id">firstorder</span>. Qed.</div>
<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">is_validator_iterate_lset</span> <span class="id">P</span> <span class="id">b</span> <span class="id">lookahead</span> <span class="id">lset</span> <span class="id">:</span><br/>
&nbsp;&nbsp;<span class="id">TerminalSet.In</span> <span class="id">lookahead</span> <span class="id">lset</span> <span class="id">-&gt;</span><br/>
&nbsp;&nbsp;<span class="id">IsValidator</span> <span class="id">P</span> (<span class="id">b</span> <span class="id">lookahead</span>) <span class="id">-&gt;</span><br/>
&nbsp;&nbsp;<span class="id">IsValidator</span> <span class="id">P</span> (<span class="id">TerminalSet.fold</span> (<span class="gallina-kwd">fun</span> <span class="id">lookahead</span> <span class="id">acc</span> <span class="id">=&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">if</span> <span class="id">acc</span> <span class="gallina-kwd">then</span> <span class="id">b</span> <span class="id">lookahead</span> <span class="gallina-kwd">else</span> <span class="id">false</span>) <span class="id">lset</span> <span class="id">true</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof4')">Proof.</span></div>
<div class="proofscript" id="proof4">
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">Hlset</span>%<span class="id">TerminalSet.elements_1</span> <span class="id">Hval</span> <span class="id">Val</span>. <span class="id">apply</span> <span class="id">Hval</span>.<br/>
&nbsp;&nbsp;<span class="id">revert</span> <span class="id">Val</span>. <span class="id">rewrite</span> <span class="id">TerminalSet.fold_1</span>. <span class="id">generalize</span> <span class="id">true</span> <span class="gallina-kwd">at</span> <span class="id">1</span>. <span class="id">clear</span> <span class="id">-Hlset</span>.<br/>
&nbsp;&nbsp;<span class="id">induction</span> <span class="id">Hlset</span> <span class="gallina-kwd">as</span> <span class="id">[?</span> <span class="id">l</span> <span class="id">&lt;-</span>%<span class="id">compare_eq|?</span> <span class="id">l</span> <span class="id">?</span> <span class="id">IH]=&gt;</span> <span class="id">/=</span> <span class="id">b'</span> <span class="id">Val</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span> <span class="id">destruct</span> (<span class="id">b</span> <span class="id">lookahead</span>). <span class="gallina-kwd">by</span> <span class="id">destruct</span> <span class="id">b'</span>. <span class="id">exfalso</span>. <span class="gallina-kwd">by</span> <span class="id">induction</span> <span class="id">l;</span> <span class="id">destruct</span> <span class="id">b'</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span> <span class="id">eauto</span>.<br/>
Qed.</div>
<span class="id">Global</span> <span class="vernacular">Hint</span> <span class="id">Extern</span> <span class="id">100</span> (<span class="id">IsValidator</span> <span class="id">_</span> <span class="id">_</span>) <span class="id">=&gt;</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">match</span> <span class="id">goal</span> <span class="gallina-kwd">with</span><br/>
&nbsp;&nbsp;<span class="id">|</span> <span class="id">H</span> <span class="id">:</span> <span class="id">TerminalSet.In</span> <span class="id">?lookahead</span> <span class="id">?lset</span> <span class="id">|-</span> <span class="id">_</span> <span class="id">=&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> (<span class="id">is_validator_iterate_lset</span> <span class="id">_</span> (<span class="gallina-kwd">fun</span> <span class="id">lookahead</span> <span class="id">=&gt;</span> <span class="id">_</span>) <span class="id">_</span> <span class="id">_</span> <span class="id">H</span>)<span class="id">;</span> <span class="id">clear</span> <span class="id">H</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">end</span><br/>
<span class="id">:</span> <span class="id">typeclass_instances</span>.<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">is_validator_forall_items</span> <span class="id">P1</span> <span class="id">b1</span> <span class="id">P2</span> <span class="id">b2</span> <span class="id">im</span> <span class="id">:</span><br/>
&nbsp;&nbsp;<span class="id">IsItemsMap</span> <span class="id">im</span> <span class="id">-&gt;</span><br/>
<br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span> <span class="id">st</span> <span class="id">prod</span> <span class="id">lookahead</span> <span class="id">lset</span> <span class="id">pos,</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">TerminalSet.In</span> <span class="id">lookahead</span> <span class="id">lset</span> <span class="id">-&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">[]</span> <span class="id">=</span> <span class="id">future_of_prod</span> <span class="id">prod</span> <span class="id">pos</span> <span class="id">-&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">IsValidator</span> (<span class="id">P1</span> <span class="id">st</span> <span class="id">prod</span> <span class="id">lookahead</span>) (<span class="id">b1</span> <span class="id">st</span> <span class="id">prod</span> <span class="id">pos</span> <span class="id">lset</span>)) <span class="id">-&gt;</span><br/>
<br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span> <span class="id">st</span> <span class="id">prod</span> <span class="id">pos</span> <span class="id">lookahead</span> <span class="id">lset</span> <span class="id">s</span> <span class="id">fut',</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">TerminalSet.In</span> <span class="id">lookahead</span> <span class="id">lset</span> <span class="id">-&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fut'</span> <span class="id">=</span> <span class="id">future_of_prod</span> <span class="id">prod</span> (<span class="id">S</span> <span class="id">pos</span>) <span class="id">-&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">IsValidator</span> (<span class="id">P2</span> <span class="id">st</span> <span class="id">prod</span> <span class="id">lookahead</span> <span class="id">s</span> <span class="id">fut'</span>) (<span class="id">b2</span> <span class="id">st</span> <span class="id">prod</span> <span class="id">pos</span> <span class="id">lset</span> <span class="id">s</span> <span class="id">fut'</span>)) <span class="id">-&gt;</span><br/>
<br/>
&nbsp;&nbsp;<span class="id">IsValidator</span> (<span class="gallina-kwd">forall</span> <span class="id">st</span> <span class="id">prod</span> <span class="id">fut</span> <span class="id">lookahead,</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">state_has_future</span> <span class="id">st</span> <span class="id">prod</span> <span class="id">fut</span> <span class="id">lookahead</span> <span class="id">-&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">match</span> <span class="id">fut</span> <span class="gallina-kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|</span> <span class="id">[]</span> <span class="id">=&gt;</span> <span class="id">P1</span> <span class="id">st</span> <span class="id">prod</span> <span class="id">lookahead</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|</span> <span class="id">s</span> <span class="id">::</span> <span class="id">fut'</span> <span class="id">=&gt;</span> <span class="id">P2</span> <span class="id">st</span> <span class="id">prod</span> <span class="id">lookahead</span> <span class="id">s</span> <span class="id">fut'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">end</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">forallb_items</span> <span class="id">im</span> (<span class="gallina-kwd">fun</span> <span class="id">st</span> <span class="id">prod</span> <span class="id">pos</span> <span class="id">lset</span> <span class="id">=&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">match</span> <span class="id">future_of_prod</span> <span class="id">prod</span> <span class="id">pos</span> <span class="gallina-kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|</span> <span class="id">[]</span> <span class="id">=&gt;</span> <span class="id">b1</span> <span class="id">st</span> <span class="id">prod</span> <span class="id">pos</span> <span class="id">lset</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|</span> <span class="id">s</span> <span class="id">::</span> <span class="id">fut'</span> <span class="id">=&gt;</span> <span class="id">b2</span> <span class="id">st</span> <span class="id">prod</span> <span class="id">pos</span> <span class="id">lset</span> <span class="id">s</span> <span class="id">fut'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">end</span>)).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof5')">Proof.</span></div>
<div class="proofscript" id="proof5">
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">-&gt;</span> <span class="id">Hval1</span> <span class="id">Hval2</span> <span class="id">Val</span> <span class="id">st</span> <span class="id">prod</span> <span class="id">fut</span> <span class="id">lookahead</span> (<span class="id">pos</span> &amp; <span class="id">-&gt;</span> &amp; <span class="id">Hlookahead</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">/forallb_items</span> <span class="id">StateProdPosMap.fold_1</span> <span class="gallina-kwd">in</span> <span class="id">Val</span>.<br/>
&nbsp;&nbsp;<span class="id">assert</span> (<span class="gallina-kwd">match</span> <span class="id">future_of_prod</span> <span class="id">prod</span> <span class="id">pos</span> <span class="gallina-kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|</span> <span class="id">[]</span> <span class="id">=&gt;</span> <span class="id">b1</span> <span class="id">st</span> <span class="id">prod</span> <span class="id">pos</span> (<span class="id">find_items_map</span> (<span class="id">items_map</span> ()) <span class="id">st</span> <span class="id">prod</span> <span class="id">pos</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|</span> <span class="id">s</span> <span class="id">::</span> <span class="id">fut'</span> <span class="id">=&gt;</span> <span class="id">b2</span> <span class="id">st</span> <span class="id">prod</span> <span class="id">pos</span> (<span class="id">find_items_map</span> (<span class="id">items_map</span> ()) <span class="id">st</span> <span class="id">prod</span> <span class="id">pos</span>) <span class="id">s</span> <span class="id">fut'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">end</span> <span class="id">=</span> <span class="id">true</span>).<br/>
&nbsp;&nbsp;<span class="id">-</span> <span class="id">unfold</span> <span class="id">find_items_map</span> <span class="gallina-kwd">in</span> <span class="id">*</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">Hfind</span> <span class="id">:=</span> @<span class="id">StateProdPosMap.find_2</span> <span class="id">_</span> (<span class="id">items_map</span> ()) (<span class="id">st,</span> <span class="id">prod,</span> <span class="id">pos</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">StateProdPosMap.find</span> <span class="gallina-kwd">as</span> <span class="id">[lset|];</span> <span class="id">[|by</span> <span class="id">edestruct</span> (<span class="id">TerminalSet.empty_1</span>)<span class="id">;</span> <span class="id">eauto]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">Hfind</span> <span class="id">_</span> <span class="id">eq_refl</span>). <span class="id">apply</span> <span class="id">StateProdPosMap.elements_1</span> <span class="gallina-kwd">in</span> <span class="id">Hfind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">Val</span>. <span class="id">generalize</span> <span class="id">true</span> <span class="gallina-kwd">at</span> <span class="id">1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">induction</span> <span class="id">Hfind</span> <span class="gallina-kwd">as</span> <span class="id">[[?</span> <span class="id">?]</span> <span class="id">l</span> <span class="id">[?</span>%<span class="id">compare_eq</span> <span class="id">?]|???</span> <span class="id">IH]=&gt;?</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span> <span class="id">simpl</span> <span class="gallina-kwd">in</span> <span class="id">*;</span> <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">match</span> <span class="id">goal</span> <span class="gallina-kwd">with</span> <span class="id">|-</span> <span class="id">_</span> <span class="id">-&gt;</span> <span class="id">?X</span> <span class="id">=</span> <span class="id">true</span> <span class="id">=&gt;</span> <span class="id">destruct</span> <span class="id">X</span> <span class="id">end;</span> <span class="id">[done|]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Bool.andb_false_r</span>. <span class="id">clear</span>. <span class="id">induction</span> <span class="id">l</span> <span class="gallina-kwd">as</span> <span class="id">[|[[[??]?]?]</span> <span class="id">l</span> <span class="id">IH]=&gt;//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span> <span class="id">apply</span> <span class="id">IH</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span> <span class="id">destruct</span> <span class="id">future_of_prod</span> <span class="id">eqn:EQ</span>. <span class="gallina-kwd">by</span> <span class="id">eapply</span> <span class="id">Hval1;</span> <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id">Hval2</span> <span class="gallina-kwd">with</span> (<span class="id">pos</span> <span class="id">:=</span> <span class="id">pos</span>)<span class="id">;</span> <span class="id">eauto;</span> <span class="id">[]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">EQ</span>. <span class="id">unfold</span> <span class="id">future_of_prod=&gt;-&gt;</span> <span class="id">//</span>.<br/>
Qed.</div>
<span class="id">Global</span> <span class="vernacular">Hint</span> <span class="id">Extern</span> <span class="id">0</span> (<span class="id">IsValidator</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="gallina-kwd">forall</span> <span class="id">st</span> <span class="id">prod</span> <span class="id">fut</span> <span class="id">lookahead,</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">state_has_future</span> <span class="id">st</span> <span class="id">prod</span> <span class="id">fut</span> <span class="id">lookahead</span> <span class="id">-&gt;</span> <span class="id">_</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">_</span>) <span class="id">=&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> (<span class="id">is_validator_forall_items</span> <span class="id">_</span> (<span class="gallina-kwd">fun</span> <span class="id">st</span> <span class="id">prod</span> <span class="id">pos</span> <span class="id">lset</span> <span class="id">=&gt;</span> <span class="id">_</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">_</span> (<span class="gallina-kwd">fun</span> <span class="id">st</span> <span class="id">prod</span> <span class="id">pos</span> <span class="id">lset</span> <span class="id">s</span> <span class="id">fut'</span> <span class="id">=&gt;</span> <span class="id">_</span>))<br/>
&nbsp;&nbsp;<span class="id">:</span> <span class="id">typeclass_instances</span>.<br/>
<br/>
<span class="id">Global</span> <span class="vernacular">Instance</span> <span class="id">is_validator_forall_state_has_future</span> <span class="id">im</span> <span class="id">st</span> <span class="id">prod</span> <span class="id">:</span><br/>
&nbsp;&nbsp;<span class="id">IsItemsMap</span> <span class="id">im</span> <span class="id">-&gt;</span><br/>
&nbsp;&nbsp;<span class="id">IsValidator</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="gallina-kwd">forall</span> <span class="id">look,</span> <span class="id">state_has_future</span> <span class="id">st</span> <span class="id">prod</span> (<span class="id">rev'</span> (<span class="id">prod_rhs_rev</span> <span class="id">prod</span>)) <span class="id">look</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="gallina-kwd">let</span> <span class="id">lookaheads</span> <span class="id">:=</span> <span class="id">find_items_map</span> <span class="id">im</span> <span class="id">st</span> <span class="id">prod</span> <span class="id">0</span> <span class="gallina-kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">forallb</span> (<span class="gallina-kwd">fun</span> <span class="id">t</span> <span class="id">=&gt;</span> <span class="id">TerminalSet.mem</span> <span class="id">t</span> <span class="id">lookaheads</span>) <span class="id">all_list</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof6')">Proof.</span></div>
<div class="proofscript" id="proof6">
&nbsp;&nbsp;<span class="id">move=&gt;</span> <span class="id">-&gt;</span> <span class="id">/forallb_forall</span> <span class="id">Val</span> <span class="id">look</span>.<br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">Val</span> <span class="id">look</span> (<span class="id">all_list_forall</span> <span class="id">_</span>)). <span class="gallina-kwd">exists</span> <span class="id">0</span>. <span class="id">split=&gt;//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">apply</span> <span class="id">TerminalSet.mem_2</span>.<br/>
Qed.</div>
<br/>
<h1> Validation for completeness *</h1>
<br/>
<div class="doc">The nullable predicate is a fixpoint : it is correct. *</div>
<span class="vernacular">Definition</span> <span class="id">nullable_stable</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">forall</span> <span class="id">p:production,</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">if</span> <span class="id">nullable_word</span> (<span class="id">prod_rhs_rev</span> <span class="id">p</span>) <span class="gallina-kwd">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">nullable_nterm</span> (<span class="id">prod_lhs</span> <span class="id">p</span>) <span class="id">=</span> <span class="id">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">else</span> <span class="id">True</span>.<br/>
<br/>
<div class="doc">The first predicate is a fixpoint : it is correct. *</div>
<span class="vernacular">Definition</span> <span class="id">first_stable:=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">forall</span> (<span class="id">p:production</span>)<span class="id">,</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">TerminalSet.Subset</span> (<span class="id">first_word_set</span> (<span class="id">rev'</span> (<span class="id">prod_rhs_rev</span> <span class="id">p</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">first_nterm_set</span> (<span class="id">prod_lhs</span> <span class="id">p</span>)).<br/>
<br/>
<div class="doc">The initial state has all the S=&gt;.u items, where S is the start non-terminal *</div>
<span class="vernacular">Definition</span> <span class="id">start_future</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">forall</span> (<span class="id">init:initstate</span>) (<span class="id">p:production</span>)<span class="id">,</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">prod_lhs</span> <span class="id">p</span> <span class="id">=</span> <span class="id">start_nt</span> <span class="id">init</span> <span class="id">-&gt;</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">forall</span> (<span class="id">t:terminal</span>)<span class="id">,</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">state_has_future</span> <span class="id">init</span> <span class="id">p</span> (<span class="id">rev'</span> (<span class="id">prod_rhs_rev</span> <span class="id">p</span>)) <span class="id">t</span>.<br/>
<br/>
<div class="doc">If a state contains an item of the form A-&gt;_.av<span class="bracket">[<span class="id">b</span>]</span>, where a is a
    terminal, then reading an a does a <span class="bracket"><span class="id">Shift_act</span></span>, to a state containing
    an item of the form A-&gt;_.v<span class="bracket">[<span class="id">b</span>]</span>. *</div>
<span class="vernacular">Definition</span> <span class="id">terminal_shift</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">forall</span> (<span class="id">s1:state</span>) <span class="id">prod</span> <span class="id">fut</span> <span class="id">lookahead,</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">state_has_future</span> <span class="id">s1</span> <span class="id">prod</span> <span class="id">fut</span> <span class="id">lookahead</span> <span class="id">-&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">match</span> <span class="id">fut</span> <span class="gallina-kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|</span> <span class="id">T</span> <span class="id">t::q</span> <span class="id">=&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">match</span> <span class="id">action_table</span> <span class="id">s1</span> <span class="gallina-kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|</span> <span class="id">Lookahead_act</span> <span class="id">awp</span> <span class="id">=&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">match</span> <span class="id">awp</span> <span class="id">t</span> <span class="gallina-kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|</span> <span class="id">Shift_act</span> <span class="id">s2</span> <span class="id">_</span> <span class="id">=&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">state_has_future</span> <span class="id">s2</span> <span class="id">prod</span> <span class="id">q</span> <span class="id">lookahead</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|</span> <span class="id">_</span> <span class="id">=&gt;</span> <span class="id">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|</span> <span class="id">_</span> <span class="id">=&gt;</span> <span class="id">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|</span> <span class="id">_</span> <span class="id">=&gt;</span> <span class="id">True</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">end</span>.<br/>
<br/>
<div class="doc">If a state contains an item of the form A-&gt;_.<span class="bracket">[<span class="id">a</span>]</span>, then either we do a
    <span class="bracket"><span class="id">Default_reduce_act</span></span> of the corresponding production, either a is a
    terminal (ie. there is a lookahead terminal), and reading a does a
    <span class="bracket"><span class="id">Reduce_act</span></span> of the corresponding production. *</div>
<span class="vernacular">Definition</span> <span class="id">end_reduce</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">forall</span> (<span class="id">s:state</span>) <span class="id">prod</span> <span class="id">fut</span> <span class="id">lookahead,</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">state_has_future</span> <span class="id">s</span> <span class="id">prod</span> <span class="id">fut</span> <span class="id">lookahead</span> <span class="id">-&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">match</span> <span class="id">fut</span> <span class="gallina-kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|</span> <span class="id">[]</span> <span class="id">=&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">match</span> <span class="id">action_table</span> <span class="id">s</span> <span class="gallina-kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|</span> <span class="id">Default_reduce_act</span> <span class="id">p</span> <span class="id">=&gt;</span> <span class="id">p</span> <span class="id">=</span> <span class="id">prod</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|</span> <span class="id">Lookahead_act</span> <span class="id">awt</span> <span class="id">=&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">match</span> <span class="id">awt</span> <span class="id">lookahead</span> <span class="gallina-kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|</span> <span class="id">Reduce_act</span> <span class="id">p</span> <span class="id">=&gt;</span> <span class="id">p</span> <span class="id">=</span> <span class="id">prod</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|</span> <span class="id">_</span> <span class="id">=&gt;</span> <span class="id">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|</span> <span class="id">_</span> <span class="id">=&gt;</span> <span class="id">True</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">end</span>.<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">is_end_reduce</span> <span class="id">items_map</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="id">forallb_items</span> <span class="id">items_map</span> (<span class="gallina-kwd">fun</span> <span class="id">s</span> <span class="id">prod</span> <span class="id">pos</span> <span class="id">lset</span> <span class="id">=&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">match</span> <span class="id">future_of_prod</span> <span class="id">prod</span> <span class="id">pos</span> <span class="gallina-kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|</span> <span class="id">[]</span> <span class="id">=&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">match</span> <span class="id">action_table</span> <span class="id">s</span> <span class="gallina-kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|</span> <span class="id">Default_reduce_act</span> <span class="id">p</span> <span class="id">=&gt;</span> <span class="id">compare_eqb</span> <span class="id">p</span> <span class="id">prod</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|</span> <span class="id">Lookahead_act</span> <span class="id">awt</span> <span class="id">=&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">TerminalSet.fold</span> (<span class="gallina-kwd">fun</span> <span class="id">lookahead</span> <span class="id">acc</span> <span class="id">=&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">match</span> <span class="id">awt</span> <span class="id">lookahead</span> <span class="gallina-kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|</span> <span class="id">Reduce_act</span> <span class="id">p</span> <span class="id">=&gt;</span> (<span class="id">acc</span> &amp;&amp; <span class="id">compare_eqb</span> <span class="id">p</span> <span class="id">prod</span>)%<span class="id">bool</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|</span> <span class="id">_</span> <span class="id">=&gt;</span> <span class="id">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">end</span>) <span class="id">lset</span> <span class="id">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|</span> <span class="id">_</span> <span class="id">=&gt;</span> <span class="id">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">end</span>).<br/>
<br/>
<div class="doc">If a state contains an item of the form A-&gt;_.Bv<span class="bracket">[<span class="id">b</span>]</span>, where B is a
    non terminal, then the goto table says we have to go to a state containing
    an item of the form A-&gt;_.v<span class="bracket">[<span class="id">b</span>]</span>. *</div>
<span class="vernacular">Definition</span> <span class="id">non_terminal_goto</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">forall</span> (<span class="id">s1:state</span>) <span class="id">prod</span> <span class="id">fut</span> <span class="id">lookahead,</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">state_has_future</span> <span class="id">s1</span> <span class="id">prod</span> <span class="id">fut</span> <span class="id">lookahead</span> <span class="id">-&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">match</span> <span class="id">fut</span> <span class="gallina-kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|</span> <span class="id">NT</span> <span class="id">nt::q</span> <span class="id">=&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">match</span> <span class="id">goto_table</span> <span class="id">s1</span> <span class="id">nt</span> <span class="gallina-kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|</span> <span class="id">Some</span> (<span class="id">exist</span> <span class="id">_</span> <span class="id">s2</span> <span class="id">_</span>) <span class="id">=&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">state_has_future</span> <span class="id">s2</span> <span class="id">prod</span> <span class="id">q</span> <span class="id">lookahead</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|</span> <span class="id">None</span> <span class="id">=&gt;</span> <span class="id">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|</span> <span class="id">_</span> <span class="id">=&gt;</span> <span class="id">True</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">end</span>.<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">start_goto</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">forall</span> (<span class="id">init:initstate</span>)<span class="id">,</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">match</span> <span class="id">goto_table</span> <span class="id">init</span> (<span class="id">start_nt</span> <span class="id">init</span>) <span class="gallina-kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|</span> <span class="id">None</span> <span class="id">=&gt;</span> <span class="id">True</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|</span> <span class="id">Some</span> <span class="id">_</span> <span class="id">=&gt;</span> <span class="id">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">end</span>.<br/>
<br/>
<div class="doc">Closure property of item sets : if a state contains an item of the form
    A-&gt;_.Bv<span class="bracket">[<span class="id">b</span>]</span>, then for each production B-&gt;u and each terminal a of
    first(vb), the state contains an item of the form B-&gt;_.u<span class="bracket">[<span class="id">a</span>]</span> *</div>
<span class="vernacular">Definition</span> <span class="id">non_terminal_closed</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">forall</span> <span class="id">s1</span> <span class="id">prod</span> <span class="id">fut</span> <span class="id">lookahead,</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">state_has_future</span> <span class="id">s1</span> <span class="id">prod</span> <span class="id">fut</span> <span class="id">lookahead</span> <span class="id">-&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">match</span> <span class="id">fut</span> <span class="gallina-kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|</span> <span class="id">NT</span> <span class="id">nt::q</span> <span class="id">=&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">forall</span> <span class="id">p,</span> <span class="id">prod_lhs</span> <span class="id">p</span> <span class="id">=</span> <span class="id">nt</span> <span class="id">-&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="gallina-kwd">if</span> <span class="id">nullable_word</span> <span class="id">q</span> <span class="gallina-kwd">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">state_has_future</span> <span class="id">s1</span> <span class="id">p</span> (<span class="id">future_of_prod</span> <span class="id">p</span> <span class="id">0</span>) <span class="id">lookahead</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">else</span> <span class="id">True</span>) <span class="id">/\</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="gallina-kwd">forall</span> <span class="id">lookahead2,</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">TerminalSet.In</span> <span class="id">lookahead2</span> (<span class="id">first_word_set</span> <span class="id">q</span>) <span class="id">-&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">state_has_future</span> <span class="id">s1</span> <span class="id">p</span> (<span class="id">future_of_prod</span> <span class="id">p</span> <span class="id">0</span>) <span class="id">lookahead2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|</span> <span class="id">_</span> <span class="id">=&gt;</span> <span class="id">True</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">end</span>.<br/>
<br/>
<div class="doc">The automaton is complete *</div>
<span class="vernacular">Definition</span> <span class="id">complete</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="id">nullable_stable</span> <span class="id">/\</span> <span class="id">first_stable</span> <span class="id">/\</span> <span class="id">start_future</span> <span class="id">/\</span> <span class="id">terminal_shift</span><br/>
&nbsp;&nbsp;<span class="id">/\</span> <span class="id">end_reduce</span> <span class="id">/\</span> <span class="id">non_terminal_goto</span> <span class="id">/\</span> <span class="id">start_goto</span> <span class="id">/\</span> <span class="id">non_terminal_closed</span>.<br/>
<br/>
<span class="id">Derive</span> <span class="id">is_complete_0</span><br/>
<span class="id">SuchThat</span> (<span class="gallina-kwd">forall</span> <span class="id">im,</span> <span class="id">IsItemsMap</span> <span class="id">im</span> <span class="id">-&gt;</span> <span class="id">IsValidator</span> <span class="id">complete</span> (<span class="id">is_complete_0</span> <span class="id">im</span>))<br/>
<span class="id">As</span> <span class="id">complete_0_is_validator</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof7')">Proof.</span></div>
<div class="proofscript" id="proof7">
 <span class="id">intros</span> <span class="id">im</span>. <span class="id">subst</span> <span class="id">is_complete_0</span>. <span class="id">instantiate</span> (<span class="id">1:=fun</span> <span class="id">im</span> <span class="id">=&gt;</span> <span class="id">_</span>). <span class="id">apply</span> <span class="id">_</span>. Qed.</div>
<br/>
<span class="vernacular">Definition</span> <span class="id">is_complete</span> (<span class="id">_:unit</span>) <span class="id">:=</span> <span class="id">is_complete_0</span> (<span class="id">items_map</span> ()).<br/>
<span class="vernacular">Lemma</span> <span class="id">complete_is_validator</span> <span class="id">:</span> <span class="id">IsValidator</span> <span class="id">complete</span> (<span class="id">is_complete</span> ()).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof8')">Proof.</span></div>
<div class="proofscript" id="proof8">
 <span class="gallina-kwd">by</span> <span class="id">apply</span> <span class="id">complete_0_is_validator</span>. Qed.</div>
<br/>
<span class="vernacular">End</span> <span class="id">Make</span>.<br/>

      <div class="footer"><hr/>Generated by <a href="https://github.com/yoshihiro503/coq2html/">a fork of coq2html</a></div>
    </div>
  </div>
    </main>
</body>
</html>
