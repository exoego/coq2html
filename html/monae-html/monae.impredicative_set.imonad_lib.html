
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module monae.impredicative_set.imonad_lib</title>
<meta name="description" content="Documentation of Coq module monae.impredicative_set.imonad_lib" />
<link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
<script src="https://cdn.jsdelivr.net/npm/markdown-it/dist/markdown-it.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/markdown-it-texmath/texmath.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script>
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="init('proofscript')">

  <header>
    <p><a href="./index.html">coq2html</a></p>
    <h1 class="title">Module monae.impredicative_set.imonad_lib</h1>
    <p><a href="">source</a></p>
  </header>

  <main>
    <div class="sidebar">
      <h2>Files</h2>
      <li><details><summary>monae</summary>
          <ul>
          <li><a href="monae.proba_monad_model.html">proba_monad_model</a></li>
<li><a href="monae.example_monty.html">example_monty</a></li>
<li><a href="monae.typed_store_lib.html">typed_store_lib</a></li>
<li><a href="monae.monae_lib.html">monae_lib</a></li>
<li><a href="monae.example_spark.html">example_spark</a></li>
<li><a href="monae.example_quicksort.html">example_quicksort</a></li>
<li><a href="monae.monad_model.html">monad_model</a></li>
<li><a href="monae.fail_lib.html">fail_lib</a></li>
<li><a href="monae.category.html">category</a></li>
<li><a href="monae.altprob_model.html">altprob_model</a></li>
<li><a href="monae.typed_store_model.html">typed_store_model</a></li>
<li><a href="monae.category_ext.html">category_ext</a></li>
<li><a href="monae.proba_lib.html">proba_lib</a></li>
<li><a href="monae.monad_composition.html">monad_composition</a></li>
<li><a href="monae.example_transformer.html">example_transformer</a></li>
<li><a href="monae.hierarchy.html">hierarchy</a></li>
<li><a href="monae.example_typed_store.html">example_typed_store</a></li>
<li><a href="monae.example_relabeling.html">example_relabeling</a></li>
<li><a href="monae.monad_lib.html">monad_lib</a></li>
<li><a href="monae.example_nqueens.html">example_nqueens</a></li>
<li><a href="monae.smallstep.html">smallstep</a></li>
<li><a href="monae.array_lib.html">array_lib</a></li>
<li><a href="monae.state_lib.html">state_lib</a></li>
<li><a href="monae.monad_transformer.html">monad_transformer</a></li>
<li><a href="monae.example_iquicksort.html">example_iquicksort</a></li>
<li><a href="monae.gcm_model.html">gcm_model</a></li>
<li><a href="monae.trace_lib.html">trace_lib</a></li>
          </ul>
          </details>
          </li>
<li><details><summary>monaeImpredicativeSet</summary>
          <ul>
          <li><a href="monaeImpredicativeSet.imonad_composition.html">imonad_composition</a></li>
<li><a href="monaeImpredicativeSet.ihierarchy.html">ihierarchy</a></li>
<li><a href="monaeImpredicativeSet.imonad_lib.html">imonad_lib</a></li>
<li><a href="monaeImpredicativeSet.imonae_lib.html">imonae_lib</a></li>
<li><a href="monaeImpredicativeSet.ifail_lib.html">ifail_lib</a></li>
          </ul>
          </details>
          </li>
    </div>

  <div class="coq">

    <div class="content">
<span class="vernacular">Ltac</span> <span class="id">typeof</span> <span class="id">X</span> <span class="id">:=</span> <span class="id">type</span> <span class="id">of</span> <span class="id">X</span>.<br/>
<span class="vernacular">Require</span> <span class="vernacular">Import</span> <span class="id">ssrmatching</span>.<br/>
<span class="vernacular">From</span> <span class="id">mathcomp</span> <span class="vernacular">Require</span> <span class="vernacular">Import</span> <span class="id">all_ssreflect</span>.<br/>
<span class="vernacular">Require</span> <span class="vernacular">Import</span> <span class="id">imonae_lib</span>.<br/>
<span class="vernacular">From</span> <span class="id">HB</span> <span class="vernacular">Require</span> <span class="vernacular">Import</span> <span class="id">structures</span>.<br/>
<span class="vernacular">Require</span> <span class="vernacular">Import</span> <span class="id">ihierarchy</span>.<br/>
<br/>
<pre class="ssrdoc">
 Properties and examples of functors, natural transformations, and monads  
                                                                           
           liftM2 h m1 m2 == as in Haskell                                 
     examples of functors : squaring, curry_F, uncurry_F, exponential_F    
        apply_pair_snd ab == f ab.2 &gt;&gt;= (fun c =&gt; Ret (ab.1, c))           
apply_triple_snd abc == f abc.1.2 &gt;&gt;= (fun d =&gt; Ret (abc.1.1, d, abc.2))   
                      NId == identity natural transformation               
                       \v == vertical composition of natural               
                             transformations                               
                       \h == horizontal composition of natural             
                             transformations                               
                   F ## n == application of the functor F to the natural   
                             transformation n                              
                     fork == the natural transformation fun A a =&gt; (a, a)  
                   F -| G == adjoint functors                              
  Module monad_of_adjoint == derivation of a monad from an adjunction      
Section composite_adjoint == composition of adjunctions                    
                                                                           
           E.-operation M == sigma operation for a monad M given a         
                             functor E                                     
          algebraicity op == the operation op is algebraic                 
         E .-aoperation M == algebraic E.-operation M                      
                                                                           
                 mpair xy := xy.1 &gt;&gt;= (fun u =&gt; xy.2 &gt;&gt;=                   
                               (fun v =&gt; (Ret (u, v)))                     
            commute m n f := (m &gt;&gt;= n &gt;&gt;= f) = (n &gt;&gt;= m &gt;&gt;= f)             
                             (ref: definition 4.2, mu2019tr3)              
                 rep n mx == mx &gt;&gt; mx &gt;&gt; ... &gt;&gt; mx, n times                
forloop n1 n2 (b : nat -&gt; M unit) : M unit := for-loop                     
                                                                           
</pre>
<br/>
<span class="vernacular">Reserved</span> <span class="vernacular">Notation</span> <span class="id">&quot;f ^`2&quot; (format &quot;f ^`2&quot;</span><span class="id">,</span> <span class="gallina-kwd">at</span> <span class="id">level</span> <span class="id">3</span>).<br/>
<span class="vernacular">Reserved</span> <span class="vernacular">Notation</span> <span class="id">&quot;F ## g&quot;</span> (<span class="gallina-kwd">at</span> <span class="id">level</span> <span class="id">11</span>).<br/>
<span class="vernacular">Reserved</span> <span class="vernacular">Notation</span> <span class="id">&quot;E .-operation M&quot; (at level 2, format &quot;E  .-operation  M&quot;</span>).<br/>
<span class="vernacular">Reserved</span> <span class="vernacular">Notation</span> <span class="id">&quot;E .-aoperation M&quot; (at level 2, format &quot;E  .-aoperation  M&quot;</span>).<br/>
<br/>
<span class="gallina-kwd">Set</span> <span class="vernacular">Implicit</span> <span class="vernacular">Arguments</span>.<br/>
<span class="vernacular">Unset</span> <span class="vernacular">Strict</span> <span class="vernacular">Implicit</span>.<br/>
<span class="vernacular">Unset</span> <span class="vernacular">Printing</span> <span class="vernacular">Implicit</span> <span class="vernacular">Defensive</span>.<br/>
<br/>
<span class="vernacular">Local</span> <span class="vernacular">Open</span> <span class="vernacular">Scope</span> <span class="id">monae_scope</span>.<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">bind_if</span> (<span class="id">M</span> <span class="id">:</span> <span class="id">monad</span>) (<span class="id">A</span> <span class="id">B</span> <span class="id">:</span> <span class="id">UU0</span>) (<span class="id">b</span> <span class="id">:</span> <span class="id">bool</span>) (<span class="id">m</span> <span class="id">:</span> <span class="id">M</span> <span class="id">A</span>) (<span class="id">f</span> <span class="id">g</span> <span class="id">:</span> <span class="id">A</span> <span class="id">-&gt;</span> <span class="id">M</span> <span class="id">B</span>) <span class="id">:</span><br/>
&nbsp;&nbsp;<span class="id">m</span> <span class="id">&gt;&gt;=</span> (<span class="gallina-kwd">fun</span> <span class="id">x</span> <span class="id">=&gt;</span> <span class="gallina-kwd">if</span> <span class="id">b</span> <span class="gallina-kwd">then</span> <span class="id">f</span> <span class="id">x</span> <span class="gallina-kwd">else</span> <span class="id">g</span> <span class="id">x</span>) <span class="id">=</span> <span class="gallina-kwd">if</span> <span class="id">b</span> <span class="gallina-kwd">then</span> <span class="id">m</span> <span class="id">&gt;&gt;=</span> <span class="id">f</span> <span class="gallina-kwd">else</span> <span class="id">m</span> <span class="id">&gt;&gt;=</span> <span class="id">g</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof1')">Proof.</span></div>
<div class="proofscript" id="proof1">
 <span class="gallina-kwd">by</span> <span class="id">case:</span> <span class="id">ifPn</span>. Qed.</div>
<br/>
<span class="vernacular">Lemma</span> <span class="id">if_bind</span> (<span class="id">M</span> <span class="id">:</span> <span class="id">monad</span>) (<span class="id">A</span> <span class="id">B</span> <span class="id">:</span> <span class="id">UU0</span>) (<span class="id">b</span> <span class="id">:</span> <span class="id">bool</span>) (<span class="id">m</span> <span class="id">n</span> <span class="id">:</span> <span class="id">M</span> <span class="id">A</span>) (<span class="id">f</span> <span class="id">:</span> <span class="id">A</span> <span class="id">-&gt;</span> <span class="id">M</span> <span class="id">B</span>) <span class="id">:</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">if</span> <span class="id">b</span> <span class="gallina-kwd">then</span> <span class="id">m</span> <span class="gallina-kwd">else</span> <span class="id">n</span>) <span class="id">&gt;&gt;=</span> <span class="id">f</span> <span class="id">=</span> (<span class="gallina-kwd">if</span> <span class="id">b</span> <span class="gallina-kwd">then</span> <span class="id">m</span> <span class="id">&gt;&gt;=</span> <span class="id">f</span> <span class="gallina-kwd">else</span> <span class="id">n</span> <span class="id">&gt;&gt;=</span> <span class="id">f</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof2')">Proof.</span></div>
<div class="proofscript" id="proof2">
 <span class="gallina-kwd">by</span> <span class="id">case:</span> <span class="id">ifPn</span>. Qed.</div>
<br/>
<span class="vernacular">Local</span> <span class="vernacular">Open</span> <span class="vernacular">Scope</span> <span class="id">mprog</span>.<br/>
<span class="vernacular">Lemma</span> <span class="id">mfoldl_rev</span> <span class="id">{M</span> <span class="id">:</span> <span class="id">monad}</span> (<span class="id">T</span> <span class="id">R</span> <span class="id">:</span> <span class="id">UU0</span>) (<span class="id">f</span> <span class="id">:</span> <span class="id">R</span> <span class="id">-&gt;</span> <span class="id">T</span> <span class="id">-&gt;</span> <span class="id">R</span>) (<span class="id">z</span> <span class="id">:</span> <span class="id">R</span>) (<span class="id">s</span> <span class="id">:</span> <span class="id">seq</span> <span class="id">T</span> <span class="id">-&gt;</span> <span class="id">M</span> (<span class="id">seq</span> <span class="id">T</span>)) <span class="id">:</span><br/>
&nbsp;&nbsp;<span class="id">foldl</span> <span class="id">f</span> <span class="id">z</span> (<span class="id">o</span>) (<span class="id">rev</span> (<span class="id">o</span>) <span class="id">s</span>) <span class="id">=</span> <span class="id">foldr</span> (<span class="gallina-kwd">fun</span> <span class="id">x</span> <span class="id">=&gt;</span> <span class="id">f^~</span> <span class="id">x</span>) <span class="id">z</span> (<span class="id">o</span>) <span class="id">s</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof3')">Proof.</span></div>
<div class="proofscript" id="proof3">
<span class="id">apply</span> <span class="id">funext</span> <span class="id">=&gt;</span> <span class="id">x;</span> <span class="id">rewrite</span> <span class="id">!fcompE</span> <span class="id">3!fmapE</span> <span class="id">!bindA</span>.<br/>
<span class="id">bind_ext</span> <span class="id">=&gt;</span> <span class="id">?;</span> <span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">bindretf</span> <span class="id">/=</span> <span class="id">-foldl_rev</span>.<br/>
Qed.</div>
<span class="vernacular">Local</span> <span class="vernacular">Close</span> <span class="vernacular">Scope</span> <span class="id">mprog</span>.<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">liftM2</span> <span class="id">{M</span> <span class="id">:</span> <span class="id">monad}</span> (<span class="id">A</span> <span class="id">B</span> <span class="id">C</span> <span class="id">:</span> <span class="id">UU0</span>) (<span class="id">h</span> <span class="id">:</span> <span class="id">A</span> <span class="id">-&gt;</span> <span class="id">B</span> <span class="id">-&gt;</span> <span class="id">C</span>) <span class="id">m1</span> <span class="id">m2</span> <span class="id">:</span> <span class="id">M</span> <span class="id">C</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="id">m1</span> <span class="id">&gt;&gt;=</span> (<span class="gallina-kwd">fun</span> <span class="id">a</span> <span class="id">=&gt;</span> <span class="id">m2</span> <span class="id">&gt;&gt;=</span> (<span class="gallina-kwd">fun</span> <span class="id">b</span> <span class="id">=&gt;</span> <span class="id">Ret</span> (<span class="id">h</span> <span class="id">a</span> <span class="id">b</span>))).<br/>
<br/>
<span class="vernacular">Section</span> <span class="id">liftM2_lemmas</span>.<br/>
<span class="vernacular">Variables</span> (<span class="id">M</span> <span class="id">:</span> <span class="id">monad</span>) (<span class="id">A</span> <span class="id">B</span> <span class="id">C</span> <span class="id">:</span> <span class="id">UU0</span>) (<span class="id">h</span> <span class="id">:</span> <span class="id">A</span> <span class="id">-&gt;</span> <span class="id">B</span> <span class="id">-&gt;</span> <span class="id">C</span>).<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">liftM2E</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">D</span> (<span class="id">f</span> <span class="id">:</span> <span class="id">C</span> <span class="id">-&gt;</span> <span class="id">M</span> <span class="id">D</span>) <span class="id">:</span> <span class="id">liftM2</span> <span class="id">h</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">&gt;&gt;=</span> <span class="id">f</span> <span class="id">=</span><br/>
&nbsp;&nbsp;<span class="id">m1</span> <span class="id">&gt;&gt;=</span> (<span class="gallina-kwd">fun</span> <span class="id">x</span> <span class="id">=&gt;</span> <span class="id">m2</span> <span class="id">&gt;&gt;=</span> <span class="gallina-kwd">fun</span> <span class="id">y</span> <span class="id">=&gt;</span> <span class="id">f</span> (<span class="id">h</span> <span class="id">x</span> <span class="id">y</span>)) <span class="id">:&gt;</span> <span class="id">M</span> <span class="id">_</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof4')">Proof.</span></div>
<div class="proofscript" id="proof4">
<span class="id">rewrite</span> <span class="id">/liftM2</span> <span class="id">bindA;</span> <span class="id">under</span> <span class="id">eq_bind</span> <span class="id">do</span> <span class="id">rewrite</span> <span class="id">bindA</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">bind_ext</span> <span class="id">=&gt;</span> <span class="id">s;</span> <span class="id">under</span> <span class="id">eq_bind</span> <span class="id">do</span> <span class="id">rewrite</span> <span class="id">bindretf</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">Lemma</span> <span class="id">liftM2_ret</span> <span class="id">a</span> <span class="id">b</span> <span class="id">:</span> <span class="id">liftM2</span> <span class="id">h</span> (<span class="id">Ret</span> <span class="id">a</span>) (<span class="id">Ret</span> <span class="id">b</span>) <span class="id">=</span> <span class="id">Ret</span> (<span class="id">h</span> <span class="id">a</span> <span class="id">b</span>) <span class="id">:&gt;</span> <span class="id">M</span> <span class="id">_</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof5')">Proof.</span></div>
<div class="proofscript" id="proof5">
 <span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">/liftM2</span> <span class="id">!bindretf</span>. Qed.</div>
<br/>
<span class="vernacular">Lemma</span> <span class="id">bind_liftM2_size</span> (<span class="id">f</span> <span class="id">:</span> <span class="id">seq</span> <span class="id">A</span> <span class="id">-&gt;</span> <span class="id">seq</span> <span class="id">B</span> <span class="id">-&gt;</span> <span class="id">seq</span> <span class="id">C</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">m1</span> <span class="id">:</span> <span class="id">M</span> (<span class="id">seq</span> <span class="id">A</span>)) (<span class="id">m2</span> <span class="id">:</span> <span class="id">M</span> (<span class="id">seq</span> <span class="id">B</span>)) <span class="id">n</span> <span class="id">:</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span> <span class="id">a</span> <span class="id">b,</span> <span class="id">size</span> (<span class="id">f</span> <span class="id">a</span> <span class="id">b</span>) <span class="id">=</span> <span class="id">size</span> <span class="id">a</span> <span class="id">+</span> <span class="id">size</span> <span class="id">b</span> <span class="id">+</span> <span class="id">n</span>) <span class="id">-&gt;</span><br/>
&nbsp;&nbsp;<span class="id">liftM2</span> <span class="id">f</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">&gt;&gt;=</span> (<span class="gallina-kwd">fun</span> <span class="id">x</span> <span class="id">=&gt;</span> <span class="id">Ret</span> (<span class="id">x,</span> <span class="id">size</span> <span class="id">x</span>)) <span class="id">=</span><br/>
&nbsp;&nbsp;<span class="id">liftM2</span> (<span class="gallina-kwd">fun</span> <span class="id">a</span> <span class="id">b</span> <span class="id">=&gt;</span> (<span class="id">f</span> <span class="id">a</span>.<span class="id">1</span> <span class="id">b</span>.<span class="id">1,</span> <span class="id">a</span>.<span class="id">2</span> <span class="id">+</span> <span class="id">b</span>.<span class="id">2</span> <span class="id">+</span> <span class="id">n</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">m1</span> <span class="id">&gt;&gt;=</span> (<span class="gallina-kwd">fun</span> <span class="id">x</span> <span class="id">=&gt;</span> <span class="id">Ret</span> (<span class="id">x,</span> <span class="id">size</span> <span class="id">x</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">m2</span> <span class="id">&gt;&gt;=</span> (<span class="gallina-kwd">fun</span> <span class="id">x</span> <span class="id">=&gt;</span> <span class="id">Ret</span> (<span class="id">x,</span> <span class="id">size</span> <span class="id">x</span>))).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof6')">Proof.</span></div>
<div class="proofscript" id="proof6">
<span class="id">move=&gt;</span> <span class="id">hf</span>.<br/>
<span class="id">rewrite</span> <span class="id">/liftM2</span> <span class="id">!bindA;</span> <span class="id">bind_ext</span> <span class="id">=&gt;</span> <span class="id">x1</span>.<br/>
<span class="id">rewrite</span> <span class="id">!bindretf</span> <span class="id">!bindA</span>.<br/>
<span class="id">bind_ext=&gt;</span> <span class="id">x2</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">!bindretf</span> <span class="id">/=</span> <span class="id">hf</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">End</span> <span class="id">liftM2_lemmas</span>.<br/>
<span class="vernacular">Arguments</span> <span class="id">bind_liftM2_size</span> <span class="id">{M</span> <span class="id">A</span> <span class="id">B</span> <span class="id">C}</span> <span class="id">{f}</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">n</span>.<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">Squaring</span> (<span class="id">A</span> <span class="id">:</span> <span class="id">UU0</span>) <span class="id">:=</span> (<span class="id">A</span> <span class="id">*</span> <span class="id">A</span>)%<span class="id">type</span>.<br/>
<span class="vernacular">Definition</span> <span class="id">squaring_f</span> (<span class="id">A</span> <span class="id">B</span> <span class="id">:</span> <span class="id">UU0</span>) (<span class="id">f</span> <span class="id">:</span> <span class="id">A</span> <span class="id">-&gt;</span> <span class="id">B</span>) <span class="id">:</span> <span class="id">Squaring</span> <span class="id">A</span> <span class="id">-&gt;</span> <span class="id">Squaring</span> <span class="id">B</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">fun</span> <span class="id">x</span> <span class="id">=&gt;</span> (<span class="id">f</span> <span class="id">x</span>.<span class="id">1,</span> <span class="id">f</span> <span class="id">x</span>.<span class="id">2</span>).<br/>
<span class="vernacular">Lemma</span> <span class="id">squaring_f_id</span> <span class="id">:</span> <span class="id">FunctorLaws.id</span> <span class="id">squaring_f</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof7')">Proof.</span></div>
<div class="proofscript" id="proof7">
 <span class="gallina-kwd">by</span> <span class="id">move=&gt;</span> <span class="id">A</span> <span class="id">/=;</span> <span class="id">apply</span> <span class="id">funext</span> <span class="id">=&gt;</span> <span class="id">-[x1</span> <span class="id">x2]</span>. Qed.</div>
<span class="vernacular">Lemma</span> <span class="id">squaring_f_comp</span> <span class="id">:</span> <span class="id">FunctorLaws.comp</span> <span class="id">squaring_f</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof8')">Proof.</span></div>
<div class="proofscript" id="proof8">
 <span class="gallina-kwd">by</span> <span class="id">move=&gt;</span> <span class="id">A</span> <span class="id">B</span> <span class="id">C</span> <span class="id">g</span> <span class="id">h</span> <span class="id">/=;</span> <span class="id">apply</span> <span class="id">funext</span> <span class="id">=&gt;</span> <span class="id">-[x1</span> <span class="id">x2]</span>. Qed.</div>
<span class="id">HB.instance</span> <span class="vernacular">Definition</span> <span class="id">_</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="id">isFunctor.Build</span> <span class="id">Squaring</span> <span class="id">squaring_f_id</span> <span class="id">squaring_f_comp</span>.<br/>
<span class="vernacular">Definition</span> <span class="id">squaring</span> <span class="id">:</span> <span class="id">functor</span> <span class="id">:=</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">Squaring]</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;f ^`2&quot;</span> <span class="id">:=</span> (<span class="id">squaring</span> <span class="id">#</span> <span class="id">f</span>).<br/>
<span class="vernacular">Lemma</span> <span class="id">squaringE</span> (<span class="id">A</span> <span class="id">B</span> <span class="id">:</span> <span class="id">UU0</span>) (<span class="id">f</span> <span class="id">:</span> <span class="id">A</span> <span class="id">-&gt;</span> <span class="id">B</span>) <span class="id">x</span> <span class="id">:</span> (<span class="id">f</span> <span class="id">^`2</span>) <span class="id">x</span> <span class="id">=</span> (<span class="id">f</span> <span class="id">x</span>.<span class="id">1,</span> <span class="id">f</span> <span class="id">x</span>.<span class="id">2</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof9')">Proof.</span></div>
<div class="proofscript" id="proof9">
 <span class="gallina-kwd">by</span> <span class="id">[]</span>. Qed.</div>
<br/>
<span class="vernacular">Section</span> <span class="id">curry_functor</span>.<br/>
<span class="vernacular">Variable</span> <span class="id">X</span> <span class="id">:</span> <span class="id">UU0</span>.<br/>
<span class="vernacular">Definition</span> <span class="id">curry_M</span> <span class="id">:</span> <span class="id">UU0</span> <span class="id">-&gt;</span> <span class="id">UU0</span> <span class="id">:=</span> <span class="gallina-kwd">fun</span> <span class="id">B</span> <span class="id">=&gt;</span> (<span class="id">X</span> <span class="id">*</span> <span class="id">B</span>)%<span class="id">type</span>.<br/>
<span class="vernacular">Definition</span> <span class="id">curry_f</span> (<span class="id">A</span> <span class="id">B</span> <span class="id">:</span> <span class="id">UU0</span>) (<span class="id">f</span> <span class="id">:</span> <span class="id">A</span> <span class="id">-&gt;</span> <span class="id">B</span>) <span class="id">:</span> <span class="id">curry_M</span> <span class="id">A</span> <span class="id">-&gt;</span> <span class="id">curry_M</span> <span class="id">B</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">fun</span> <span class="id">x</span> <span class="id">:</span> <span class="id">X</span> <span class="id">*</span> <span class="id">A</span> <span class="id">=&gt;</span> (<span class="id">x</span>.<span class="id">1,</span> <span class="id">f</span> <span class="id">x</span>.<span class="id">2</span>).<br/>
<span class="vernacular">Lemma</span> <span class="id">curry_f_id</span> <span class="id">:</span> <span class="id">FunctorLaws.id</span> <span class="id">curry_f</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof10')">Proof.</span></div>
<div class="proofscript" id="proof10">
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">/FunctorLaws</span>.<span class="id">id</span> <span class="id">=&gt;</span> <span class="id">A;</span> <span class="id">rewrite</span> <span class="id">/curry_f;</span> <span class="id">apply</span> <span class="id">funext</span> <span class="id">=&gt;</span> <span class="id">-[]</span>.<br/>
Qed.</div>
<span class="vernacular">Lemma</span> <span class="id">curry_f_comp</span> <span class="id">:</span> <span class="id">FunctorLaws.comp</span> <span class="id">curry_f</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof11')">Proof.</span></div>
<div class="proofscript" id="proof11">
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">/FunctorLaws</span>.<span class="id">comp</span> <span class="id">=&gt;</span> <span class="id">A</span> <span class="id">B</span> <span class="id">C</span> <span class="id">g</span> <span class="id">h;</span> <span class="id">rewrite</span> <span class="id">/curry_f;</span> <span class="id">apply</span> <span class="id">funext</span> <span class="id">=&gt;</span> <span class="id">-[]</span>.<br/>
Qed.</div>
<span class="id">HB.instance</span> <span class="vernacular">Definition</span> <span class="id">_</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;@<span class="id">isFunctor.Build</span> <span class="id">curry_M</span> <span class="id">curry_f</span> <span class="id">curry_f_id</span> <span class="id">curry_f_comp</span>.<br/>
<span class="vernacular">Definition</span> <span class="id">curry_F</span> <span class="id">:</span> <span class="id">functor</span> <span class="id">:=</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">curry_M]</span>.<br/>
<span class="vernacular">End</span> <span class="id">curry_functor</span>.<br/>
<br/>
<span class="vernacular">Section</span> <span class="id">uncurry_functor</span>.<br/>
<span class="vernacular">Definition</span> <span class="id">uncurry_M</span> (<span class="id">X</span> <span class="id">:</span> <span class="id">UU0</span>) <span class="id">:</span> <span class="id">UU0</span> <span class="id">-&gt;</span> <span class="id">UU0</span> <span class="id">:=</span> <span class="gallina-kwd">fun</span> <span class="id">B</span> <span class="id">=&gt;</span> <span class="id">X</span> <span class="id">-&gt;</span> <span class="id">B</span>.<br/>
<span class="vernacular">Definition</span> <span class="id">uncurry_f</span> (<span class="id">X</span> <span class="id">A</span> <span class="id">B</span> <span class="id">:</span> <span class="id">UU0</span>) (<span class="id">f</span> <span class="id">:</span> <span class="id">A</span> <span class="id">-&gt;</span> <span class="id">B</span>) <span class="id">:</span> <span class="id">uncurry_M</span> <span class="id">X</span> <span class="id">A</span> <span class="id">-&gt;</span> <span class="id">uncurry_M</span> <span class="id">X</span> <span class="id">B</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">fun</span> <span class="id">g</span> <span class="id">:</span> <span class="id">X</span> <span class="id">-&gt;</span> <span class="id">A</span> <span class="id">=&gt;</span> <span class="id">f</span> <span class="id">\o</span> <span class="id">g</span>.<br/>
<span class="vernacular">Lemma</span> <span class="id">uncurry_f_id</span> <span class="id">X</span> <span class="id">:</span> <span class="id">FunctorLaws.id</span> (@<span class="id">uncurry_f</span> <span class="id">X</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof12')">Proof.</span></div>
<div class="proofscript" id="proof12">
<span class="id">rewrite</span> <span class="id">/FunctorLaws</span>.<span class="id">id</span> <span class="id">=&gt;</span> <span class="id">A;</span> <span class="id">rewrite</span> <span class="id">/uncurry_f;</span> <span class="id">apply</span> <span class="id">funext</span> <span class="id">=&gt;</span> <span class="id">?</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">compidf</span>.<br/>
Qed.</div>
<span class="vernacular">Lemma</span> <span class="id">uncurry_f_comp</span> <span class="id">X</span> <span class="id">:</span> <span class="id">FunctorLaws.comp</span> (@<span class="id">uncurry_f</span> <span class="id">X</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof13')">Proof.</span></div>
<div class="proofscript" id="proof13">
<span class="id">rewrite</span> <span class="id">/FunctorLaws</span>.<span class="id">comp</span> <span class="id">=&gt;</span> <span class="id">A</span> <span class="id">B</span> <span class="id">C</span> <span class="id">g</span> <span class="id">h;</span> <span class="id">rewrite</span> <span class="id">/uncurry_f;</span> <span class="id">apply</span> <span class="id">funext</span> <span class="id">=&gt;</span> <span class="id">?</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">compE</span> <span class="id">compA</span>.<br/>
Qed.</div>
<span class="id">HB.instance</span> <span class="vernacular">Definition</span> <span class="id">_</span> <span class="id">X</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="id">isFunctor.Build</span> (@<span class="id">uncurry_M</span> <span class="id">X</span>) (<span class="id">uncurry_f_id</span> <span class="id">X</span>) (<span class="id">uncurry_f_comp</span> <span class="id">X</span>).<br/>
<span class="vernacular">Definition</span> <span class="id">uncurry_F</span> <span class="id">X</span> <span class="id">:</span> <span class="id">functor</span> <span class="id">:=</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> @<span class="id">uncurry_M</span> <span class="id">X]</span>.<br/>
<span class="vernacular">End</span> <span class="id">uncurry_functor</span>.<br/>
<br/>
<span class="vernacular">Section</span> <span class="id">bind_uncurry</span>.<br/>
<span class="vernacular">Variables</span> (<span class="id">M</span> <span class="id">:</span> <span class="id">monad</span>) (<span class="id">A</span> <span class="id">B</span> <span class="id">C</span> <span class="id">:</span> <span class="id">UU0</span>).<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">bind_uncurry</span> (<span class="id">f</span> <span class="id">:</span> <span class="id">A</span> <span class="id">-&gt;</span> <span class="id">M</span> <span class="id">B</span>) (<span class="id">g</span> <span class="id">:</span> <span class="id">A</span> <span class="id">-&gt;</span> <span class="id">B</span> <span class="id">-&gt;</span> <span class="id">M</span> <span class="id">C</span>) <span class="id">x</span> <span class="id">:</span><br/>
&nbsp;&nbsp;(<span class="id">f</span> <span class="id">x</span> <span class="id">&gt;&gt;=</span> <span class="gallina-kwd">fun</span> <span class="id">y</span> <span class="id">=&gt;</span> <span class="id">Ret</span> (<span class="id">x,</span> <span class="id">y</span>)) <span class="id">&gt;&gt;=</span> (<span class="gallina-kwd">fun</span> <span class="id">xy</span> <span class="id">=&gt;</span> <span class="id">g</span> <span class="id">xy</span>.<span class="id">1</span> <span class="id">xy</span>.<span class="id">2</span>) <span class="id">=</span><br/>
&nbsp;&nbsp;(<span class="id">f</span> <span class="id">x</span> <span class="id">&gt;&gt;=</span> <span class="id">g</span> <span class="id">x</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof14')">Proof.</span></div>
<div class="proofscript" id="proof14">
 <span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">bindA;</span> <span class="id">under</span> <span class="id">eq_bind</span> <span class="id">do</span> <span class="id">rewrite</span> <span class="id">bindretf</span>. Qed.</div>
<br/>
<span class="vernacular">Lemma</span> <span class="id">bindA_uncurry</span> (<span class="id">m</span> <span class="id">:</span> <span class="id">M</span> <span class="id">A</span>) (<span class="id">f</span> <span class="id">:</span> <span class="id">A</span> <span class="id">-&gt;</span> <span class="id">M</span> <span class="id">B</span>) (<span class="id">g</span> <span class="id">:</span> <span class="id">A</span> <span class="id">-&gt;</span> <span class="id">B</span> <span class="id">-&gt;</span> <span class="id">M</span> <span class="id">C</span>) <span class="id">:</span><br/>
&nbsp;&nbsp;(<span class="id">m</span> <span class="id">&gt;&gt;=</span> <span class="gallina-kwd">fun</span> <span class="id">x</span> <span class="id">=&gt;</span> <span class="id">f</span> <span class="id">x</span> <span class="id">&gt;&gt;=</span> <span class="gallina-kwd">fun</span> <span class="id">y</span> <span class="id">=&gt;</span> <span class="id">Ret</span> (<span class="id">x,</span> <span class="id">y</span>)) <span class="id">&gt;&gt;=</span> (<span class="gallina-kwd">fun</span> <span class="id">xy</span> <span class="id">=&gt;</span> <span class="id">g</span> <span class="id">xy</span>.<span class="id">1</span> <span class="id">xy</span>.<span class="id">2</span>) <span class="id">=</span><br/>
&nbsp;&nbsp;(<span class="id">m</span> <span class="id">&gt;&gt;=</span> <span class="gallina-kwd">fun</span> <span class="id">x</span> <span class="id">=&gt;</span> <span class="id">f</span> <span class="id">x</span> <span class="id">&gt;&gt;=</span> <span class="id">g</span> <span class="id">x</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof15')">Proof.</span></div>
<div class="proofscript" id="proof15">
 <span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">bindA;</span> <span class="gallina-kwd">by</span> <span class="id">under</span> <span class="id">eq_bind</span> <span class="id">do</span> <span class="id">rewrite</span> <span class="id">bind_uncurry</span>. Qed.</div>
<br/>
<span class="vernacular">End</span> <span class="id">bind_uncurry</span>.<br/>
<br/>
<span class="vernacular">Section</span> <span class="id">apply_monad</span>.<br/>
<span class="vernacular">Variable</span> <span class="id">M</span> <span class="id">:</span> <span class="id">monad</span>.<br/>
<span class="vernacular">Implicit</span> <span class="id">Types</span> <span class="id">A</span> <span class="id">B</span> <span class="id">C</span> <span class="id">D</span> <span class="id">E</span> <span class="id">:</span> <span class="id">UU0</span>.<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">apply_pair_snd</span> <span class="id">A</span> <span class="id">B</span> <span class="id">C</span> (<span class="id">f</span> <span class="id">:</span> <span class="id">B</span> <span class="id">-&gt;</span> <span class="id">M</span> <span class="id">C</span>) (<span class="id">ab</span> <span class="id">:</span> <span class="id">A</span> <span class="id">*</span> <span class="id">B</span>) <span class="id">:</span> <span class="id">M</span> (<span class="id">A</span> <span class="id">*</span> <span class="id">C</span>)%<span class="id">type</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="id">f</span> <span class="id">ab</span>.<span class="id">2</span> <span class="id">&gt;&gt;=</span> (<span class="gallina-kwd">fun</span> <span class="id">c</span> <span class="id">=&gt;</span> <span class="id">Ret</span> (<span class="id">ab</span>.<span class="id">1,</span> <span class="id">c</span>)).<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">apply_pair_sndE</span> <span class="id">A</span> <span class="id">B</span> <span class="id">C</span> (<span class="id">f</span> <span class="id">:</span> <span class="id">B</span> <span class="id">-&gt;</span> <span class="id">M</span> <span class="id">C</span>) (<span class="id">ab</span> <span class="id">:</span> <span class="id">A</span> <span class="id">*</span> <span class="id">B</span>) <span class="id">D</span> (<span class="id">g</span> <span class="id">:</span> <span class="id">A</span> <span class="id">*</span> <span class="id">C</span> <span class="id">-&gt;</span> <span class="id">M</span> <span class="id">D</span>) <span class="id">:</span><br/>
&nbsp;&nbsp;<span class="id">apply_pair_snd</span> <span class="id">f</span> <span class="id">ab</span> <span class="id">&gt;&gt;=</span> <span class="id">g</span> <span class="id">=</span> <span class="id">f</span> <span class="id">ab</span>.<span class="id">2</span> <span class="id">&gt;&gt;=</span> (<span class="gallina-kwd">fun</span> <span class="id">x</span> <span class="id">=&gt;</span> <span class="id">g</span> (<span class="id">ab</span>.<span class="id">1,</span> <span class="id">x</span>)).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof16')">Proof.</span></div>
<div class="proofscript" id="proof16">
<span class="id">rewrite</span> <span class="id">/apply_pair_snd</span> <span class="id">bindA</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">under</span> <span class="id">eq_bind</span> <span class="id">do</span> <span class="id">rewrite</span> <span class="id">bindretf</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">Definition</span> <span class="id">apply_triple_snd</span> <span class="id">A</span> <span class="id">B</span> <span class="id">C</span> <span class="id">D</span> (<span class="id">f</span> <span class="id">:</span> <span class="id">B</span> <span class="id">-&gt;</span> <span class="id">M</span> <span class="id">D</span>) (<span class="id">abc</span> <span class="id">:</span> <span class="id">A</span> <span class="id">*</span> <span class="id">B</span> <span class="id">*</span> <span class="id">C</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">:</span> <span class="id">M</span> (<span class="id">A</span> <span class="id">*</span> <span class="id">D</span> <span class="id">*</span> <span class="id">C</span>)%<span class="id">type</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="id">f</span> <span class="id">abc</span>.<span class="id">1</span>.<span class="id">2</span> <span class="id">&gt;&gt;=</span> (<span class="gallina-kwd">fun</span> <span class="id">d</span> <span class="id">=&gt;</span> <span class="id">Ret</span> (<span class="id">abc</span>.<span class="id">1</span>.<span class="id">1,</span> <span class="id">d,</span> <span class="id">abc</span>.<span class="id">2</span>)).<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">apply_triple_sndE</span> <span class="id">A</span> <span class="id">B</span> <span class="id">C</span> <span class="id">D</span> (<span class="id">f</span> <span class="id">:</span> <span class="id">B</span> <span class="id">-&gt;</span> <span class="id">M</span> <span class="id">D</span>) <span class="id">a</span> <span class="id">b</span> <span class="id">c</span> <span class="id">E</span> (<span class="id">g</span> <span class="id">:</span> <span class="id">A</span> <span class="id">*</span> <span class="id">D</span> <span class="id">*</span> <span class="id">C</span> <span class="id">-&gt;</span> <span class="id">M</span> <span class="id">E</span>) <span class="id">:</span><br/>
&nbsp;&nbsp;<span class="id">apply_triple_snd</span> <span class="id">f</span> (<span class="id">a,</span> <span class="id">b,</span> <span class="id">c</span>) <span class="id">&gt;&gt;=</span> <span class="id">g</span> <span class="id">=</span> <span class="id">f</span> <span class="id">b</span> <span class="id">&gt;&gt;=</span> (<span class="gallina-kwd">fun</span> <span class="id">x</span> <span class="id">=&gt;</span> <span class="id">g</span> (<span class="id">a,</span> <span class="id">x,</span> <span class="id">c</span>)).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof17')">Proof.</span></div>
<div class="proofscript" id="proof17">
<span class="id">rewrite</span> <span class="id">/apply_triple_snd</span> <span class="id">/=</span> <span class="id">bindA</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">under</span> <span class="id">eq_bind</span> <span class="id">do</span> <span class="id">rewrite</span> <span class="id">bindretf</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">Lemma</span> <span class="id">apply_triple_snd_kleisli</span> <span class="id">A</span> <span class="id">B</span> <span class="id">C</span> <span class="id">D</span> <span class="id">F</span> (<span class="id">f</span> <span class="id">:</span> <span class="id">B</span> <span class="id">-&gt;</span> <span class="id">M</span> <span class="id">D</span>) (<span class="id">g</span> <span class="id">:</span> <span class="id">D</span> <span class="id">-&gt;</span> <span class="id">M</span> <span class="id">F</span>) (<span class="id">a</span> <span class="id">:</span> <span class="id">A</span>) <span class="id">b</span> (<span class="id">c</span> <span class="id">:</span> <span class="id">C</span>) <span class="id">:</span><br/>
&nbsp;&nbsp;<span class="id">apply_triple_snd</span> (<span class="id">f</span> <span class="id">&gt;=&gt;</span> <span class="id">g</span>) (<span class="id">a,</span> <span class="id">b,</span> <span class="id">c</span>) <span class="id">=</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">f</span> <span class="id">b</span> <span class="id">&gt;&gt;=</span> (<span class="gallina-kwd">fun</span> <span class="id">b'</span> <span class="id">=&gt;</span> <span class="id">apply_triple_snd</span> <span class="id">g</span> (<span class="id">a,</span> <span class="id">b',</span> <span class="id">c</span>)).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof18')">Proof.</span></div>
<div class="proofscript" id="proof18">
 <span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">/apply_triple_snd</span> <span class="id">/=</span> <span class="id">kleisliE</span> <span class="id">bindA</span>. Qed.</div>
<br/>
<span class="vernacular">End</span> <span class="id">apply_monad</span>.<br/>
<br/>
<span class="vernacular">Section</span> <span class="id">exponential_functor</span>.<br/>
<span class="vernacular">Variable</span> <span class="id">A</span> <span class="id">:</span> <span class="id">UU0</span>.<br/>
<span class="vernacular">Definition</span> <span class="id">exponential_M</span> (<span class="id">X</span> <span class="id">:</span> <span class="id">UU0</span>) <span class="id">:=</span> <span class="id">A</span> <span class="id">-&gt;</span> <span class="id">X</span>.<br/>
<span class="vernacular">Definition</span> <span class="id">exponential_f</span> (<span class="id">X</span> <span class="id">Y</span> <span class="id">:</span> <span class="id">UU0</span>) (<span class="id">f</span> <span class="id">:</span> <span class="id">X</span> <span class="id">-&gt;</span> <span class="id">Y</span>) <span class="id">:</span><br/>
&nbsp;&nbsp;<span class="id">exponential_M</span> <span class="id">X</span> <span class="id">-&gt;</span> <span class="id">exponential_M</span> <span class="id">Y</span> <span class="id">:=</span> <span class="gallina-kwd">fun</span> <span class="id">e</span> <span class="id">=&gt;</span> <span class="id">f</span> <span class="id">\o</span> <span class="id">e</span>.<br/>
<span class="vernacular">Lemma</span> <span class="id">exponential_f_id</span> <span class="id">:</span> <span class="id">FunctorLaws.id</span> <span class="id">exponential_f</span><br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof19')">Proof.</span></div>
<div class="proofscript" id="proof19">
 <span class="gallina-kwd">by</span> <span class="id">[]</span>. Qed.</div>
<span class="vernacular">Lemma</span> <span class="id">exponential_f_comp</span> <span class="id">:</span> <span class="id">FunctorLaws.comp</span> <span class="id">exponential_f</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof20')">Proof.</span></div>
<div class="proofscript" id="proof20">
 <span class="gallina-kwd">by</span> <span class="id">[]</span>. Qed.</div>
<span class="id">HB.instance</span> <span class="vernacular">Definition</span> <span class="id">_</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;@<span class="id">isFunctor.Build</span> <span class="id">exponential_M</span> <span class="id">exponential_f</span> <span class="id">exponential_f_id</span> <span class="id">exponential_f_comp</span>.<br/>
<span class="vernacular">Definition</span> <span class="id">exponential_F</span> <span class="id">:</span> <span class="id">functor</span> <span class="id">:=</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">exponential_M]</span>.<br/>
<span class="vernacular">End</span> <span class="id">exponential_functor</span>.<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">fmap_oE</span> (<span class="id">M</span> <span class="id">:</span> <span class="id">functor</span>) (<span class="id">A</span> <span class="id">B</span> <span class="id">C</span> <span class="id">:</span> <span class="id">UU0</span>) (<span class="id">f</span> <span class="id">:</span> <span class="id">A</span> <span class="id">-&gt;</span> <span class="id">B</span>) (<span class="id">g</span> <span class="id">:</span> <span class="id">C</span> <span class="id">-&gt;</span> <span class="id">A</span>) (<span class="id">m</span> <span class="id">:</span> <span class="id">M</span> <span class="id">C</span>) <span class="id">:</span><br/>
&nbsp;&nbsp;(<span class="id">M</span> <span class="id">#</span> (<span class="id">f</span> <span class="id">\o</span> <span class="id">g</span>)) <span class="id">m</span> <span class="id">=</span> (<span class="id">M</span> <span class="id">#</span> <span class="id">f</span>) ((<span class="id">M</span> <span class="id">#</span> <span class="id">g</span>) <span class="id">m</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof21')">Proof.</span></div>
<div class="proofscript" id="proof21">
 <span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">functor_o</span>. Qed.</div>
<br/>
<span class="vernacular">Section</span> <span class="id">id_natural_transformation</span>.<br/>
<span class="vernacular">Variables</span> <span class="id">C</span> <span class="id">:</span> <span class="id">functor</span>.<br/>
<span class="vernacular">Definition</span> <span class="id">NId</span> <span class="id">:=</span> <span class="gallina-kwd">fun</span> <span class="id">A</span> <span class="id">=&gt;</span> @<span class="id">id</span> (<span class="id">C</span> <span class="id">A</span>).<br/>
<span class="vernacular">Let</span> <span class="id">natural_id</span> <span class="id">:</span> <span class="id">naturality</span> <span class="id">C</span> <span class="id">C</span> <span class="id">NId</span><br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof22')">Proof.</span></div>
<div class="proofscript" id="proof22">
 <span class="gallina-kwd">by</span> <span class="id">[]</span>. Qed.</div>
<br/>
<span class="id">HB.instance</span> <span class="vernacular">Definition</span> <span class="id">_</span> <span class="id">:=</span> <span class="id">isNatural.Build</span> <span class="id">C</span> <span class="id">C</span> <span class="id">NId</span> <span class="id">natural_id</span>.<br/>
<br/>
<span class="vernacular">End</span> <span class="id">id_natural_transformation</span>.<br/>
<br/>
<span class="vernacular">Arguments</span> <span class="id">NId</span> <span class="id">C</span> <span class="id">[A]</span>.<br/>
<br/>
<span class="vernacular">Section</span> <span class="id">vertical_composition</span>.<br/>
<span class="vernacular">Variables</span> (<span class="id">C</span> <span class="id">D</span> <span class="id">E</span> <span class="id">:</span> <span class="id">functor</span>) (<span class="id">g</span> <span class="id">:</span> <span class="id">D</span> <span class="id">~&gt;</span> <span class="id">E</span>) (<span class="id">f</span> <span class="id">:</span> <span class="id">C</span> <span class="id">~&gt;</span> <span class="id">D</span>).<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">vcomp</span> <span class="id">:=</span> <span class="id">locked</span> (<span class="gallina-kwd">fun</span> (<span class="id">A</span> <span class="id">:</span> <span class="id">UU0</span>) <span class="id">=&gt;</span> <span class="id">g</span> <span class="id">A</span> <span class="id">\o</span> <span class="id">f</span> <span class="id">A</span>).<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">natural_vcomp</span> <span class="id">:</span> <span class="id">naturality</span> <span class="id">_</span> <span class="id">_</span> <span class="id">vcomp</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof23')">Proof.</span></div>
<div class="proofscript" id="proof23">
<span class="gallina-kwd">by</span> <span class="id">move=&gt;</span> <span class="id">A</span> <span class="id">B</span> <span class="id">h;</span> <span class="id">rewrite</span> <span class="id">/vcomp;</span> <span class="id">unlock;</span> <span class="id">rewrite</span> <span class="id">compA</span> <span class="id">natural</span> <span class="id">-compA</span> <span class="id">natural</span>.<br/>
Qed.</div>
<br/>
<span class="id">HB.instance</span> <span class="vernacular">Definition</span> <span class="id">_</span> <span class="id">:=</span> <span class="id">isNatural.Build</span> <span class="id">C</span> <span class="id">E</span> <span class="id">vcomp</span> <span class="id">natural_vcomp</span>.<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">VComp</span> <span class="id">:</span> <span class="id">C</span> <span class="id">~&gt;</span> <span class="id">E</span> <span class="id">:=</span> <span class="id">[the</span> <span class="id">C</span> <span class="id">~&gt;</span> <span class="id">E</span> <span class="id">of</span> <span class="id">vcomp]</span>.<br/>
<br/>
<span class="vernacular">End</span> <span class="id">vertical_composition</span>.<br/>
<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;f \v g&quot;</span> <span class="id">:=</span> <span class="id">[the</span> <span class="id">_</span> <span class="id">~&gt;</span> <span class="id">_</span> <span class="id">of</span> <span class="id">vcomp</span> <span class="id">f</span> <span class="id">g]</span>.<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">vcompE</span> (<span class="id">F</span> <span class="id">G</span> <span class="id">H</span> <span class="id">:</span> <span class="id">functor</span>) (<span class="id">n1</span> <span class="id">:</span> <span class="id">F</span> <span class="id">~&gt;</span> <span class="id">H</span>) (<span class="id">n2</span> <span class="id">:</span> <span class="id">G</span> <span class="id">~&gt;</span> <span class="id">F</span>) <span class="id">X</span> <span class="id">:</span><br/>
&nbsp;&nbsp;(<span class="id">n1</span> <span class="id">\v</span> <span class="id">n2</span>) <span class="id">X</span> <span class="id">=</span> <span class="id">n1</span> <span class="id">X</span> <span class="id">\o</span> <span class="id">n2</span> <span class="id">X</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof24')">Proof.</span></div>
<div class="proofscript" id="proof24">
 <span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">/=</span> <span class="id">/vcomp</span> <span class="id">/=;</span> <span class="id">unlock</span>. Qed.</div>
<br/>
<span class="vernacular">Lemma</span> <span class="id">vassoc</span> (<span class="id">F1</span> <span class="id">F2</span> <span class="id">G</span> <span class="id">H</span> <span class="id">:</span> <span class="id">functor</span>) (<span class="id">f</span> <span class="id">:</span> <span class="id">F1</span> <span class="id">~&gt;</span> <span class="id">F2</span>) (<span class="id">g</span> <span class="id">:</span> <span class="id">G</span> <span class="id">~&gt;</span> <span class="id">F1</span>) (<span class="id">h</span> <span class="id">:</span> <span class="id">H</span> <span class="id">~&gt;</span> <span class="id">G</span>) <span class="id">:</span><br/>
&nbsp;&nbsp;<span class="id">f</span> <span class="id">\v</span> <span class="id">g</span> <span class="id">\v</span> <span class="id">h</span> <span class="id">=</span> <span class="id">f</span> <span class="id">\v</span> (<span class="id">g</span> <span class="id">\v</span> <span class="id">h</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof25')">Proof.</span></div>
<div class="proofscript" id="proof25">
 <span class="gallina-kwd">by</span> <span class="id">apply/nattrans_ext</span> <span class="id">=&gt;</span> <span class="id">a</span> <span class="id">/=;</span> <span class="id">rewrite</span> <span class="id">!vcompE</span>. Qed.</div>
<br/>
<span class="vernacular">Section</span> <span class="id">horizontal_composition</span>.<br/>
<span class="vernacular">Variables</span> (<span class="id">F</span> <span class="id">G</span> <span class="id">F'</span> <span class="id">G'</span> <span class="id">:</span> <span class="id">functor</span>) (<span class="id">s</span> <span class="id">:</span> <span class="id">F</span> <span class="id">~&gt;</span> <span class="id">G</span>) (<span class="id">t</span> <span class="id">:</span> <span class="id">F'</span> <span class="id">~&gt;</span> <span class="id">G'</span>).<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">hcomp</span> <span class="id">:</span> <span class="id">F'</span> <span class="id">\o</span> <span class="id">F</span> <span class="id">~~&gt;</span> <span class="id">G'</span> <span class="id">\o</span> <span class="id">G</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">fun</span> (<span class="id">A</span> <span class="id">:</span> <span class="id">UU0</span>) <span class="id">=&gt;</span> @<span class="id">t</span> (<span class="id">G</span> <span class="id">A</span>) <span class="id">\o</span> <span class="id">F'</span> <span class="id">#</span> (@<span class="id">s</span> <span class="id">A</span>).<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">natural_hcomp</span> <span class="id">:</span><br/>
&nbsp;&nbsp;<span class="id">naturality</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">F'</span> <span class="id">\o</span> <span class="id">F]</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">G'</span> <span class="id">\o</span> <span class="id">G]</span> <span class="id">hcomp</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof26')">Proof.</span></div>
<div class="proofscript" id="proof26">
<span class="id">move=&gt;</span> <span class="id">A</span> <span class="id">B</span> <span class="id">h</span>.<br/>
<span class="id">rewrite</span> <span class="id">[LHS]compA</span> (<span class="id">natural</span> <span class="id">t</span>) <span class="id">-[LHS]compA</span> <span class="id">-[in</span> <span class="id">RHS]compA</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">congr</span> (<span class="id">_</span> <span class="id">\o</span> <span class="id">_</span>)<span class="id">;</span> <span class="id">rewrite</span> <span class="id">FCompE</span> <span class="id">-2!functor_o</span> (<span class="id">natural</span> <span class="id">s</span>).<br/>
Qed.</div>
<br/>
<span class="id">HB.instance</span> <span class="vernacular">Definition</span> <span class="id">_</span> <span class="id">:=</span> <span class="id">isNatural.Build</span><br/>
&nbsp;&nbsp;<span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">F'</span> <span class="id">\o</span> <span class="id">F]</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">G'</span> <span class="id">\o</span> <span class="id">G]</span> <span class="id">hcomp</span> <span class="id">natural_hcomp</span>.<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">HComp</span> <span class="id">:</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">F'</span> <span class="id">\o</span> <span class="id">F]</span> <span class="id">~&gt;</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">G'</span> <span class="id">\o</span> <span class="id">G]</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="id">[the</span> <span class="id">_</span> <span class="id">~&gt;</span> <span class="id">_</span> <span class="id">of</span> <span class="id">hcomp]</span>.<br/>
<br/>
<span class="vernacular">End</span> <span class="id">horizontal_composition</span>.<br/>
<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;f \h g&quot;</span> <span class="id">:=</span> (<span class="id">HComp</span> <span class="id">g</span> <span class="id">f</span>).<br/>
<br/>
<span class="vernacular">Section</span> <span class="id">functor_natural_transformation</span>.<br/>
<span class="vernacular">Variables</span> (<span class="id">S</span> <span class="id">F</span> <span class="id">G</span> <span class="id">:</span> <span class="id">functor</span>) (<span class="id">nt</span> <span class="id">:</span> <span class="id">F</span> <span class="id">~&gt;</span> <span class="id">G</span>).<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">fun_app_nt</span> <span class="id">:</span> <span class="id">S</span> <span class="id">\o</span> <span class="id">F</span> <span class="id">~~&gt;</span> <span class="id">S</span> <span class="id">\o</span> <span class="id">G</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">fun</span> (<span class="id">A</span> <span class="id">:</span> <span class="id">UU0</span>) <span class="id">=&gt;</span> <span class="id">S</span> <span class="id">#</span> (<span class="id">nt</span> <span class="id">A</span>).<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">natural_fun_app_nt</span> <span class="id">:</span><br/>
&nbsp;&nbsp;<span class="id">naturality</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">S</span> <span class="id">\o</span> <span class="id">F]</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">S</span> <span class="id">\o</span> <span class="id">G]</span> <span class="id">fun_app_nt</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof27')">Proof.</span></div>
<div class="proofscript" id="proof27">
<span class="gallina-kwd">by</span> <span class="id">move=&gt;</span> <span class="id">*;</span> <span class="id">rewrite</span> <span class="id">/fun_app_nt</span> <span class="id">2!FCompE</span> <span class="id">-2!</span>(@<span class="id">functor_o</span> <span class="id">S</span>) <span class="id">natural</span>.<br/>
Qed.</div>
<br/>
<span class="id">HB.instance</span> <span class="vernacular">Definition</span> <span class="id">_</span> <span class="id">:=</span> <span class="id">isNatural.Build</span><br/>
&nbsp;&nbsp;<span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">S</span> <span class="id">\o</span> <span class="id">F]</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">S</span> <span class="id">\o</span> <span class="id">G]</span> <span class="id">fun_app_nt</span> <span class="id">natural_fun_app_nt</span>.<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">functor_app_natural</span> <span class="id">:</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">S</span> <span class="id">\o</span> <span class="id">F]</span> <span class="id">~&gt;</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">S</span> <span class="id">\o</span> <span class="id">G]</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="id">[the</span> <span class="id">_</span> <span class="id">~&gt;</span> <span class="id">_</span> <span class="id">of</span> <span class="id">fun_app_nt]</span>.<br/>
<span class="vernacular">End</span> <span class="id">functor_natural_transformation</span>.<br/>
<br/>
<span class="vernacular">Arguments</span> <span class="id">functor_app_natural</span> <span class="id">S</span> <span class="id">{_}</span> <span class="id">{_}</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;F '##' g&quot;</span> <span class="id">:=</span> (<span class="id">functor_app_natural</span> <span class="id">F</span> <span class="id">g</span>).<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">functor_app_naturalE</span> (<span class="id">S</span> <span class="id">F</span> <span class="id">G</span> <span class="id">:</span> <span class="id">functor</span>) (<span class="id">nt</span> <span class="id">:</span> <span class="id">F</span> <span class="id">~&gt;</span> <span class="id">G</span>) <span class="id">X</span> <span class="id">:</span><br/>
&nbsp;&nbsp;(<span class="id">S</span> <span class="id">##</span> <span class="id">nt</span>) <span class="id">X</span> <span class="id">=</span> <span class="id">S</span> <span class="id">#</span> <span class="id">nt</span> <span class="id">X</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof28')">Proof.</span></div>
<div class="proofscript" id="proof28">
 <span class="gallina-kwd">by</span> <span class="id">[]</span>. Qed.</div>
<br/>
<span class="vernacular">Lemma</span> <span class="id">functor_app_natural_hcomp</span> (<span class="id">S</span> <span class="id">F</span> <span class="id">G</span> <span class="id">:</span> <span class="id">functor</span>) (<span class="id">nt</span> <span class="id">:</span> <span class="id">F</span> <span class="id">~&gt;</span> <span class="id">G</span>) <span class="id">:</span><br/>
&nbsp;&nbsp;<span class="id">S</span> <span class="id">##</span> <span class="id">nt</span> <span class="id">=</span> <span class="id">[the</span> <span class="id">_</span> <span class="id">~&gt;</span> <span class="id">_</span> <span class="id">of</span> <span class="id">NId</span> <span class="id">S]</span> <span class="id">\h</span> <span class="id">nt</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof29')">Proof.</span></div>
<div class="proofscript" id="proof29">
 <span class="gallina-kwd">by</span> <span class="id">apply</span> <span class="id">nattrans_ext</span> <span class="id">=&gt;</span> <span class="id">a;</span> <span class="id">rewrite</span> <span class="id">functor_app_naturalE</span>. Qed.</div>
<br/>
<span class="vernacular">Section</span> <span class="id">natural_transformation_example</span>.<br/>
<span class="vernacular">Definition</span> <span class="id">fork'</span> <span class="id">:</span> <span class="id">FId</span> <span class="id">~~&gt;</span> <span class="id">squaring</span> <span class="id">:=</span> <span class="gallina-kwd">fun</span> (<span class="id">A</span> <span class="id">:</span> <span class="id">UU0</span>) (<span class="id">a</span> <span class="id">:</span> <span class="id">A</span>) <span class="id">=&gt;</span> (<span class="id">a,</span> <span class="id">a</span>).<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">fork_natural</span> <span class="id">:</span> <span class="id">naturality</span> <span class="id">_</span> <span class="id">_</span> <span class="id">fork'</span><br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof30')">Proof.</span></div>
<div class="proofscript" id="proof30">
 <span class="gallina-kwd">by</span> <span class="id">[]</span>. Qed.</div>
<br/>
<span class="id">HB.instance</span> <span class="vernacular">Definition</span> <span class="id">_</span> <span class="id">:=</span> <span class="id">isNatural.Build</span> <span class="id">FId</span> <span class="id">squaring</span> <span class="id">fork'</span> <span class="id">fork_natural</span>.<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">fork</span> <span class="id">:</span> <span class="id">FId</span> <span class="id">~&gt;</span> <span class="id">squaring</span> <span class="id">:=</span> <span class="id">[the</span> <span class="id">_</span> <span class="id">~&gt;</span> <span class="id">_</span> <span class="id">of</span> <span class="id">fork']</span>.<br/>
<br/>
<span class="vernacular">End</span> <span class="id">natural_transformation_example</span>.<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">eta_type</span> (<span class="id">f</span> <span class="id">g</span> <span class="id">:</span> <span class="id">functor</span>) <span class="id">:=</span> <span class="id">FId</span> <span class="id">~&gt;</span> <span class="id">g</span> <span class="id">\o</span> <span class="id">f</span>.<br/>
<span class="vernacular">Definition</span> <span class="id">eps_type</span> (<span class="id">f</span> <span class="id">g</span> <span class="id">:</span> <span class="id">functor</span>) <span class="id">:=</span> <span class="id">f</span> <span class="id">\o</span> <span class="id">g</span> <span class="id">~&gt;</span> <span class="id">FId</span>.<br/>
<span class="vernacular">Module</span> <span class="id">TriangularLaws</span>.<br/>
<span class="vernacular">Section</span> <span class="id">triangularlaws</span>.<br/>
<span class="vernacular">Variables</span> (<span class="id">F</span> <span class="id">G</span> <span class="id">:</span> <span class="id">functor</span>) (<span class="id">eps</span> <span class="id">:</span> <span class="id">eps_type</span> <span class="id">F</span> <span class="id">G</span>) (<span class="id">eta</span> <span class="id">:</span> <span class="id">eta_type</span> <span class="id">F</span> <span class="id">G</span>).<br/>
<span class="vernacular">Definition</span> <span class="id">left</span> <span class="id">:=</span> <span class="gallina-kwd">forall</span> <span class="id">A,</span> <span class="id">eps</span> (<span class="id">F</span> <span class="id">A</span>) <span class="id">\o</span> (<span class="id">F</span> <span class="id">#</span> <span class="id">eta</span> <span class="id">A</span>) <span class="id">=</span> @<span class="id">id</span> (<span class="id">F</span> <span class="id">A</span>).<br/>
<span class="vernacular">Definition</span> <span class="id">right</span> <span class="id">:=</span> <span class="gallina-kwd">forall</span> <span class="id">A,</span> (<span class="id">G</span> <span class="id">#</span> <span class="id">eps</span> <span class="id">A</span>) <span class="id">\o</span> <span class="id">eta</span> (<span class="id">G</span> <span class="id">A</span>) <span class="id">=</span> @<span class="id">id</span> (<span class="id">G</span> <span class="id">A</span>).<br/>
<span class="vernacular">End</span> <span class="id">triangularlaws</span>.<br/>
<span class="vernacular">End</span> <span class="id">TriangularLaws</span>.<br/>
<br/>
<span class="vernacular">Module</span> <span class="id">AdjointFunctor</span>.<br/>
<span class="vernacular">Section</span> <span class="id">adjointfunctor</span>.<br/>
<span class="vernacular">Variables</span> <span class="id">F</span> <span class="id">G</span> <span class="id">:</span> <span class="id">functor</span>.<br/>
<span class="vernacular">Record</span> <span class="id">t</span> <span class="id">:=</span> <span class="id">mk</span> <span class="id">{</span><br/>
&nbsp;&nbsp;<span class="id">eta</span> <span class="id">:</span> <span class="id">eta_type</span> <span class="id">F</span> <span class="id">G</span> <span class="id">;</span><br/>
&nbsp;&nbsp;<span class="id">eps</span> <span class="id">:</span> <span class="id">eps_type</span> <span class="id">F</span> <span class="id">G</span> <span class="id">;</span><br/>
&nbsp;&nbsp;<span class="id">tri_left</span> <span class="id">:</span> <span class="id">TriangularLaws.left</span> <span class="id">eps</span> <span class="id">eta</span> <span class="id">;</span><br/>
&nbsp;&nbsp;<span class="id">tri_right</span> <span class="id">:</span> <span class="id">TriangularLaws.right</span> <span class="id">eps</span> <span class="id">eta}</span>.<br/>
<span class="vernacular">End</span> <span class="id">adjointfunctor</span>.<br/>
<span class="vernacular">Section</span> <span class="id">lemmas</span>.<br/>
<span class="vernacular">Variables</span> (<span class="id">F</span> <span class="id">G</span> <span class="id">:</span> <span class="id">functor</span>) (<span class="id">H</span> <span class="id">:</span> <span class="id">t</span> <span class="id">F</span> <span class="id">G</span>).<br/>
<span class="vernacular">Definition</span> <span class="id">hom_iso</span> (<span class="id">A</span> <span class="id">B</span> <span class="id">:</span> <span class="id">UU0</span>) (<span class="id">h</span> <span class="id">:</span> <span class="id">F</span> <span class="id">A</span> <span class="id">-&gt;</span> <span class="id">B</span>) <span class="id">:</span> <span class="id">A</span> <span class="id">-&gt;</span> <span class="id">G</span> <span class="id">B</span> <span class="id">:=</span> (<span class="id">G</span> <span class="id">#</span> <span class="id">h</span>) <span class="id">\o</span> @<span class="id">eta</span> <span class="id">_</span> <span class="id">_</span> <span class="id">H</span> <span class="id">A</span>.<br/>
<span class="vernacular">Definition</span> <span class="id">hom_inv</span> (<span class="id">A</span> <span class="id">B</span> <span class="id">:</span> <span class="id">UU0</span>) (<span class="id">h</span> <span class="id">:</span> <span class="id">A</span> <span class="id">-&gt;</span> <span class="id">G</span> <span class="id">B</span>) <span class="id">:</span> <span class="id">F</span> <span class="id">A</span> <span class="id">-&gt;</span> <span class="id">B</span> <span class="id">:=</span> @<span class="id">eps</span> <span class="id">_</span> <span class="id">_</span> <span class="id">H</span> <span class="id">B</span> <span class="id">\o</span> (<span class="id">F</span> <span class="id">#</span> <span class="id">h</span>).<br/>
<span class="vernacular">End</span> <span class="id">lemmas</span>.<br/>
<span class="vernacular">End</span> <span class="id">AdjointFunctor</span>.<br/>
<span class="vernacular">Arguments</span> <span class="id">AdjointFunctor.t</span> <span class="id">:</span> <span class="id">clear</span> <span class="id">implicits</span>.<br/>
<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;F -| G&quot;</span> <span class="id">:=</span> (<span class="id">AdjointFunctor.t</span> <span class="id">F</span> <span class="id">G</span>).<br/>
<br/>
<span class="vernacular">Section</span> <span class="id">adjoint_example</span>.<br/>
<span class="vernacular">Variable</span> (<span class="id">X</span> <span class="id">:</span> <span class="id">UU0</span>).<br/>
<span class="vernacular">Definition</span> <span class="id">curry_fun</span> <span class="id">:</span> <span class="id">curry_F</span> <span class="id">X</span> <span class="id">\o</span> <span class="id">uncurry_F</span> <span class="id">X</span> <span class="id">~~&gt;</span> <span class="id">idfun</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">fun</span> (<span class="id">A</span> <span class="id">:</span> <span class="id">UU0</span>) (<span class="id">af</span> <span class="id">:</span> <span class="id">X</span> <span class="id">*</span> (<span class="id">X</span> <span class="id">-&gt;</span> <span class="id">A</span>)) <span class="id">=&gt;</span> <span class="id">af</span>.<span class="id">2</span> <span class="id">af</span>.<span class="id">1</span>.<br/>
<span class="vernacular">Lemma</span> <span class="id">curry_naturality</span> <span class="id">:</span> <span class="id">naturality</span> (<span class="id">curry_F</span> <span class="id">X</span> <span class="id">\o</span> <span class="id">uncurry_F</span> <span class="id">X</span>) <span class="id">FId</span> <span class="id">curry_fun</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof31')">Proof.</span></div>
<div class="proofscript" id="proof31">
 <span class="gallina-kwd">by</span> <span class="id">[]</span>. Qed.</div>
<span class="id">HB.instance</span> <span class="vernacular">Definition</span> <span class="id">_</span> <span class="id">:=</span> <span class="id">isNatural.Build</span><br/>
&nbsp;&nbsp;(<span class="id">curry_F</span> <span class="id">X</span> <span class="id">\o</span> <span class="id">uncurry_F</span> <span class="id">X</span>) <span class="id">FId</span> <span class="id">curry_fun</span> <span class="id">curry_naturality</span>.<br/>
<span class="vernacular">Definition</span> <span class="id">curry_eps</span> <span class="id">:</span> <span class="id">eps_type</span> (<span class="id">curry_F</span> <span class="id">X</span>) (<span class="id">uncurry_F</span> <span class="id">X</span>) <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="id">[the</span> <span class="id">nattrans</span> (<span class="id">curry_F</span> <span class="id">X</span> <span class="id">\o</span> <span class="id">uncurry_F</span> <span class="id">X</span>) <span class="id">FId</span> <span class="id">of</span> <span class="id">curry_fun]</span>.<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">curry_fun2</span> <span class="id">:</span> <span class="id">FId</span> <span class="id">~~&gt;</span> <span class="id">uncurry_F</span> <span class="id">X</span> <span class="id">\o</span> <span class="id">curry_F</span> <span class="id">X</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">fun</span> (<span class="id">A</span> <span class="id">:</span> <span class="id">UU0</span>) (<span class="id">a</span> <span class="id">:</span> <span class="id">A</span>) <span class="id">=&gt;</span> <span class="id">pair^~</span> <span class="id">a</span>.<br/>
<span class="vernacular">Lemma</span> <span class="id">curry_naturality2</span> <span class="id">:</span><br/>
&nbsp;&nbsp;<span class="id">naturality</span> <span class="id">_</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">uncurry_F</span> <span class="id">X</span> <span class="id">\o</span> <span class="id">curry_F</span> <span class="id">X]</span> <span class="id">curry_fun2</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof32')">Proof.</span></div>
<div class="proofscript" id="proof32">
 <span class="gallina-kwd">by</span> <span class="id">[]</span>. Qed.</div>
<span class="id">HB.instance</span> <span class="vernacular">Definition</span> <span class="id">_</span> <span class="id">:=</span> <span class="id">isNatural.Build</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id">_</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">uncurry_F</span> <span class="id">X</span> <span class="id">\o</span> <span class="id">curry_F</span> <span class="id">X]</span> <span class="id">curry_fun2</span> <span class="id">curry_naturality2</span>.<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">curry_eta</span> <span class="id">:</span> <span class="id">eta_type</span> (<span class="id">curry_F</span> <span class="id">X</span>) (<span class="id">uncurry_F</span> <span class="id">X</span>) <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="id">[the</span> <span class="id">nattrans</span> <span class="id">_</span> <span class="id">_</span> <span class="id">of</span> <span class="id">curry_fun2]</span>.<br/>
<span class="vernacular">Lemma</span> <span class="id">adjoint_currry</span> <span class="id">:</span> <span class="id">curry_F</span> <span class="id">X</span> <span class="id">-|</span> <span class="id">uncurry_F</span> <span class="id">X</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof33')">Proof.</span></div>
<div class="proofscript" id="proof33">
<span class="id">apply:</span> (@<span class="id">AdjointFunctor.mk</span> <span class="id">_</span> <span class="id">_</span> <span class="id">curry_eta</span> <span class="id">curry_eps</span>).<br/>
<span class="gallina-kwd">by</span> <span class="id">move=&gt;</span> <span class="id">A;</span> <span class="id">rewrite</span> <span class="id">/TriangularLaws</span>.<span class="id">left;</span> <span class="id">apply</span> <span class="id">funext</span> <span class="id">=&gt;</span> <span class="id">-[]</span>.<br/>
<span class="id">move=&gt;</span> <span class="id">A;</span> <span class="id">rewrite</span> <span class="id">/TriangularLaws</span>.<span class="id">right</span> <span class="id">/uncurry_F</span> <span class="id">/curry_eps</span> <span class="id">/curry_eta</span> <span class="id">/uncurry_M</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">/=</span> <span class="id">/uncurry_f</span> <span class="id">/=</span> <span class="id">/comp</span> <span class="id">/=;</span> <span class="id">apply</span> <span class="id">funext</span> <span class="id">=&gt;</span> <span class="id">f;</span> <span class="id">apply</span> <span class="id">funext</span>.<br/>
Qed.</div>
<span class="vernacular">End</span> <span class="id">adjoint_example</span>.<br/>
<br/>
<span class="vernacular">Module</span> <span class="id">monad_of_adjoint</span>.<br/>
<span class="vernacular">Section</span> <span class="id">def</span>.<br/>
<span class="vernacular">Variables</span> (<span class="id">F</span> <span class="id">G</span> <span class="id">:</span> <span class="id">functor</span>) (<span class="id">eps</span> <span class="id">:</span> <span class="id">eps_type</span> <span class="id">F</span> <span class="id">G</span>) (<span class="id">eta</span> <span class="id">:</span> <span class="id">eta_type</span> <span class="id">F</span> <span class="id">G</span>).<br/>
<span class="vernacular">Definition</span> <span class="id">M</span> <span class="id">:=</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">G</span> <span class="id">\o</span> <span class="id">F]</span>.<br/>
<span class="vernacular">Definition</span> <span class="id">mu</span> <span class="id">:</span> <span class="id">M</span> <span class="id">\o</span> <span class="id">M</span> <span class="id">~~&gt;</span> <span class="id">M</span> <span class="id">:=</span> <span class="gallina-kwd">fun</span> <span class="id">A</span> <span class="id">=&gt;</span> <span class="id">G</span> <span class="id">#</span> <span class="id">eps</span> (<span class="id">F</span> <span class="id">A</span>).<br/>
<span class="vernacular">Definition</span> <span class="id">bind</span> <span class="id">A</span> <span class="id">B</span> (<span class="id">m</span> <span class="id">:</span> <span class="id">M</span> <span class="id">A</span>) (<span class="id">f</span> <span class="id">:</span> <span class="id">A</span> <span class="id">-&gt;</span> <span class="id">M</span> <span class="id">B</span>) <span class="id">:</span> <span class="id">M</span> <span class="id">B</span> <span class="id">:=</span> <span class="id">mu</span> ((<span class="id">M</span> <span class="id">#</span> <span class="id">f</span>) <span class="id">m</span>).<br/>
<span class="vernacular">End</span> <span class="id">def</span>.<br/>
<span class="vernacular">Section</span> <span class="id">prop</span>.<br/>
<span class="vernacular">Variables</span> <span class="id">f</span> <span class="id">g</span> <span class="id">:</span> <span class="id">functor</span>.<br/>
<span class="vernacular">Hypothesis</span> <span class="id">Had</span> <span class="id">:</span> <span class="id">f</span> <span class="id">-|</span> <span class="id">g</span>.<br/>
<span class="vernacular">Let</span> <span class="id">eps</span> <span class="id">:</span> <span class="id">eps_type</span> <span class="id">f</span> <span class="id">g</span> <span class="id">:=</span> <span class="id">AdjointFunctor.eps</span> <span class="id">Had</span>.<br/>
<span class="vernacular">Let</span> <span class="id">eta</span> <span class="id">:</span> <span class="id">eta_type</span> <span class="id">f</span> <span class="id">g</span> <span class="id">:=</span> <span class="id">AdjointFunctor.eta</span> <span class="id">Had</span>.<br/>
<span class="vernacular">Section</span> <span class="id">mu_eps_natural</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">M</span> <span class="id">:=</span> (<span class="id">M</span> <span class="id">f</span> <span class="id">g</span>).<br/>
<span class="vernacular">Notation</span> <span class="id">mu</span> <span class="id">:=</span> (<span class="id">mu</span> <span class="id">eps</span>).<br/>
<span class="vernacular">Lemma</span> <span class="id">muM_natural</span> <span class="id">:</span> <span class="id">naturality</span> <span class="id">_</span> <span class="id">_</span> <span class="id">mu</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof34')">Proof.</span></div>
<div class="proofscript" id="proof34">
<span class="id">move</span> <span class="id">=&gt;</span> <span class="id">A</span> <span class="id">B</span> <span class="id">h</span>.<br/>
<span class="id">rewrite</span> (<span class="id">_</span> <span class="id">:</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">M</span> <span class="id">\o</span> <span class="id">M]</span> <span class="id">#</span> <span class="id">h</span> <span class="id">=</span> <span class="id">g</span> <span class="id">#</span> (<span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">f</span> <span class="id">\o</span> <span class="id">g]</span> <span class="id">#</span> (<span class="id">f</span> <span class="id">#</span> <span class="id">h</span>))) <span class="id">//</span>.<br/>
<span class="id">rewrite</span> (<span class="id">_</span> <span class="id">:</span> <span class="id">_</span> <span class="id">\o</span> <span class="id">g</span> <span class="id">#</span> (<span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">f</span> <span class="id">\o</span> <span class="id">g]</span> <span class="id">#</span> (<span class="id">f</span> <span class="id">#</span> <span class="id">h</span>)) <span class="id">=</span><br/>
&nbsp;&nbsp;<span class="id">g</span> <span class="id">#</span> (@<span class="id">eps</span> (<span class="id">f</span> <span class="id">B</span>) <span class="id">\o</span> (<span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">f</span> <span class="id">\o</span> <span class="id">g]</span> <span class="id">#</span> (<span class="id">f</span> <span class="id">#</span> <span class="id">h</span>))))<span class="id">;</span> <span class="id">last</span> <span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">-functor_o</span>.<br/>
<span class="id">rewrite</span> <span class="id">-natural</span> <span class="id">FIdE</span>.<br/>
<span class="id">rewrite</span> <span class="id">[in</span> <span class="id">LHS]FCompE</span>.<br/>
<span class="id">rewrite</span> <span class="id">/mu</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">-[in</span> <span class="id">LHS]</span>(@<span class="id">functor_o</span> <span class="id">g</span>).<br/>
Qed.</div>
<span class="vernacular">Lemma</span> <span class="id">epsC</span> <span class="id">A</span> <span class="id">:</span> @<span class="id">eps</span> <span class="id">_</span> <span class="id">\o</span> @<span class="id">eps</span> <span class="id">_</span> <span class="id">=</span> @<span class="id">eps</span> <span class="id">_</span> <span class="id">\o</span> <span class="id">f</span> <span class="id">#</span> (<span class="id">g</span> <span class="id">#</span> (@<span class="id">eps</span> <span class="id">_</span>)) <span class="id">:&gt;</span> ((<span class="id">f</span> <span class="id">\o</span> <span class="id">g</span>) ((<span class="id">f</span> <span class="id">\o</span> <span class="id">g</span>) <span class="id">A</span>) <span class="id">-&gt;</span> <span class="id">A</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof35')">Proof.</span></div>
<div class="proofscript" id="proof35">
 <span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">-natural</span>. Qed.</div>
<span class="vernacular">Lemma</span> <span class="id">muMA</span> <span class="id">A</span> <span class="id">:</span> @<span class="id">mu</span> <span class="id">A</span> <span class="id">\o</span> @<span class="id">mu</span> (<span class="id">M</span> <span class="id">A</span>) <span class="id">=</span> @<span class="id">mu</span> <span class="id">A</span> <span class="id">\o</span> (<span class="id">M</span> <span class="id">#</span> @<span class="id">mu</span> <span class="id">A</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof36')">Proof.</span></div>
<div class="proofscript" id="proof36">
<span class="id">have</span> <span class="id">-&gt;</span> <span class="id">:</span> <span class="id">g</span> <span class="id">#</span> <span class="id">eps</span> (<span class="id">f</span> <span class="id">A</span>) <span class="id">\o</span> <span class="id">g</span> <span class="id">#</span> <span class="id">eps</span> (<span class="id">f</span> (<span class="id">M</span> <span class="id">A</span>)) <span class="id">=</span><br/>
&nbsp;&nbsp;<span class="id">g</span> <span class="id">#</span> (@<span class="id">eps</span> (<span class="id">f</span> <span class="id">A</span>) <span class="id">\o</span> @<span class="id">eps</span> (<span class="id">f</span> (<span class="id">M</span> <span class="id">A</span>))) <span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">functor_o</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">epsC</span> <span class="id">functor_o</span>.<br/>
Qed.</div>
<span class="vernacular">End</span> <span class="id">mu_eps_natural</span>.<br/>
<span class="vernacular">Lemma</span> <span class="id">bindetaf</span> <span class="id">:</span> <span class="id">BindLaws.left_neutral</span> (<span class="id">bind</span> <span class="id">eps</span>) <span class="id">eta</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof37')">Proof.</span></div>
<div class="proofscript" id="proof37">
<span class="id">rewrite</span> <span class="id">/BindLaws</span>.<span class="id">left_neutral</span> <span class="id">=&gt;</span> <span class="id">A</span> <span class="id">B</span> <span class="id">a</span> <span class="id">h</span>.<br/>
<span class="id">rewrite</span> <span class="id">/bind</span> <span class="id">/mu</span>.<br/>
<span class="id">rewrite</span> <span class="id">-</span>(<span class="id">compE</span> (<span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">g</span> <span class="id">\o</span> <span class="id">f]</span> <span class="id">#</span> <span class="id">h</span>)) (<span class="id">natural</span> <span class="id">eta</span>) <span class="id">-</span>(<span class="id">compE</span> (<span class="id">g</span> <span class="id">#</span> <span class="id">_</span>)) <span class="id">compA</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">AdjointFunctor.tri_right</span>.<br/>
Qed.</div>
<span class="vernacular">Lemma</span> <span class="id">bindmeta</span> <span class="id">:</span> <span class="id">BindLaws.right_neutral</span> (<span class="id">bind</span> <span class="id">eps</span>) <span class="id">eta</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof38')">Proof.</span></div>
<div class="proofscript" id="proof38">
<span class="id">rewrite</span> <span class="id">/BindLaws</span>.<span class="id">right_neutral</span> <span class="id">=&gt;</span> <span class="id">A</span> <span class="id">m</span>.<br/>
<span class="id">rewrite</span> <span class="id">/bind</span> <span class="id">/mu</span> <span class="id">-</span>(<span class="id">compE</span> (<span class="id">g</span> <span class="id">#</span> <span class="id">_</span>)).<br/>
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">-functor_o</span> <span class="id">AdjointFunctor.tri_left</span> <span class="id">functor_id</span>.<br/>
Qed.</div>
<span class="vernacular">Lemma</span> <span class="id">law3</span> <span class="id">:</span> <span class="id">BindLaws.associative</span> (<span class="id">bind</span> <span class="id">eps</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof39')">Proof.</span></div>
<div class="proofscript" id="proof39">
<span class="id">rewrite</span> <span class="id">/BindLaws</span>.<span class="id">associative</span> <span class="id">=&gt;</span> <span class="id">A</span> <span class="id">B</span> <span class="id">C</span> <span class="id">x</span> <span class="id">ab</span> <span class="id">bc</span>.<br/>
<span class="id">rewrite</span> <span class="id">/bind</span>.<br/>
<span class="id">set</span> <span class="id">N</span> <span class="id">:=</span> <span class="id">M</span> <span class="id">f</span> <span class="id">g</span>.  <span class="id">set</span> <span class="id">j</span> <span class="id">:=</span> <span class="id">mu</span> <span class="id">eps</span>.<br/>
<span class="id">rewrite</span> <span class="id">[X</span> <span class="gallina-kwd">in</span> <span class="id">_</span> <span class="id">=</span> <span class="id">j</span> <span class="id">C</span> <span class="id">X]</span>(<span class="id">_</span> <span class="id">:</span> <span class="id">_</span> <span class="id">=</span> (<span class="id">N</span> <span class="id">#</span> (<span class="id">j</span> <span class="id">C</span>)) ((<span class="id">N</span> <span class="id">#</span> (<span class="id">N</span> <span class="id">#</span> <span class="id">bc</span>)) ((<span class="id">N</span> <span class="id">#</span> <span class="id">ab</span>) <span class="id">x</span>)))<span class="id">;</span> <span class="id">last</span> <span class="id">first</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">functor_o</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">compE</span>.<br/>
&nbsp;&nbsp;<span class="id">congr</span> ((<span class="id">N</span> <span class="id">#</span> <span class="id">j</span> <span class="id">C</span>) <span class="id">_</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">functor_o</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">rewrite</span> (<span class="id">compE</span> <span class="id">_</span> <span class="id">_</span> <span class="id">x</span>).<br/>
<span class="id">move:</span> <span class="id">muMA</span> (<span class="id">muM_natural</span> <span class="id">bc</span>).<br/>
<span class="id">rewrite</span> <span class="id">-/N</span> <span class="id">-/j</span>.<br/>
<span class="id">move=&gt;</span> <span class="id">muMA</span>.<br/>
<span class="comment">(*rewrite&nbsp;FCompE.*)</span><br/>
<span class="id">have</span> <span class="id">-&gt;</span> <span class="id">:</span> (<span class="id">N</span> <span class="id">#</span> <span class="id">bc</span>) (<span class="id">j</span> <span class="id">B</span> ((<span class="id">N</span> <span class="id">#</span> <span class="id">ab</span>) <span class="id">x</span>)) <span class="id">=</span> (<span class="id">N</span> <span class="id">#</span> <span class="id">bc</span> <span class="id">\o</span> <span class="id">j</span> <span class="id">B</span>) ((<span class="id">N</span> <span class="id">#</span> <span class="id">ab</span>) <span class="id">x</span>) <span class="gallina-kwd">by</span> <span class="id">[]</span>.<br/>
<span class="id">move=&gt;</span> <span class="id">-&gt;</span>.<br/>
<span class="id">rewrite</span> <span class="id">compE</span>.<br/>
<span class="id">rewrite</span> <span class="id">[LHS]</span>(<span class="id">_</span> <span class="id">:</span> <span class="id">_</span> <span class="id">=</span> (<span class="id">j</span> <span class="id">C</span> <span class="id">\o</span> <span class="id">j</span> (<span class="id">N</span> <span class="id">C</span>)) ((<span class="id">N</span> <span class="id">#</span> (<span class="id">N</span> <span class="id">#</span> <span class="id">bc</span>)) ((<span class="id">N</span> <span class="id">#</span> <span class="id">ab</span>) <span class="id">x</span>))) <span class="id">//</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">muMA</span>.<br/>
Qed.</div>
<span class="vernacular">End</span> <span class="id">prop</span>.<br/>
<span class="vernacular">End</span> <span class="id">monad_of_adjoint</span>.<br/>
<br/>
<span class="vernacular">Section</span> <span class="id">composite_adjoint</span>.<br/>
<span class="vernacular">Variables</span> (<span class="id">F0</span> <span class="id">U0</span> <span class="id">:</span> <span class="id">functor</span>).<br/>
<span class="vernacular">Hypothesis</span> <span class="id">H0</span> <span class="id">:</span> <span class="id">F0</span> <span class="id">-|</span> <span class="id">U0</span>.<br/>
<span class="vernacular">Let</span> <span class="id">eta0</span> <span class="id">:</span> <span class="id">eta_type</span> <span class="id">F0</span> <span class="id">U0</span> <span class="id">:=</span> <span class="id">AdjointFunctor.eta</span> <span class="id">H0</span>.<br/>
<span class="vernacular">Let</span> <span class="id">eps0</span> <span class="id">:</span> <span class="id">eps_type</span> <span class="id">F0</span> <span class="id">U0</span> <span class="id">:=</span> <span class="id">AdjointFunctor.eps</span> <span class="id">H0</span>.<br/>
<span class="vernacular">Variables</span> (<span class="id">F</span> <span class="id">U</span> <span class="id">:</span> <span class="id">functor</span>).<br/>
<span class="vernacular">Hypothesis</span> <span class="id">H</span> <span class="id">:</span> <span class="id">F</span> <span class="id">-|</span> <span class="id">U</span>.<br/>
<span class="vernacular">Let</span> <span class="id">eta</span> <span class="id">:</span> <span class="id">eta_type</span> <span class="id">F</span> <span class="id">U</span> <span class="id">:=</span> <span class="id">AdjointFunctor.eta</span> <span class="id">H</span>.<br/>
<span class="vernacular">Let</span> <span class="id">eps</span> <span class="id">:</span> <span class="id">eps_type</span> <span class="id">F</span> <span class="id">U</span> <span class="id">:=</span> <span class="id">AdjointFunctor.eps</span> <span class="id">H</span>.<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">uni_fun</span> <span class="id">:</span> <span class="id">FId</span> <span class="id">~~&gt;</span> (<span class="id">U0</span> <span class="id">\o</span> <span class="id">U</span>) <span class="id">\o</span> (<span class="id">F</span> <span class="id">\o</span> <span class="id">F0</span>) <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">fun</span> <span class="id">A</span> <span class="id">:</span> <span class="id">UU0</span> <span class="id">=&gt;</span> <span class="id">U0</span> <span class="id">#</span> <span class="id">eta</span> (<span class="id">F0</span> <span class="id">A</span>) <span class="id">\o</span> <span class="id">eta0</span> <span class="id">A</span>.<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">uni_naturality</span> <span class="id">:</span><br/>
&nbsp;&nbsp;<span class="id">naturality</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">idfun]</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> (<span class="id">U0</span> <span class="id">\o</span> <span class="id">U</span>) <span class="id">\o</span> (<span class="id">F</span> <span class="id">\o</span> <span class="id">F0</span>)<span class="id">]</span> <span class="id">uni_fun</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof40')">Proof.</span></div>
<div class="proofscript" id="proof40">
<span class="id">move=&gt;</span> <span class="id">A</span> <span class="id">B</span> <span class="id">h;</span> <span class="id">rewrite</span> <span class="id">FIdE</span>.<br/>
<span class="id">rewrite</span> <span class="id">-[RHS]compA</span>.<br/>
<span class="id">rewrite</span> <span class="id">-</span>(<span class="id">natural</span> (<span class="id">AdjointFunctor.eta</span> <span class="id">H0</span>)).<br/>
<span class="id">rewrite</span> <span class="id">[LHS]compA</span>.<br/>
<span class="id">rewrite</span> <span class="id">[RHS]compA</span>.<br/>
<span class="id">congr</span> (<span class="id">_</span> <span class="id">\o</span> <span class="id">_</span>).<br/>
<span class="id">rewrite</span> (<span class="id">FCompE</span> <span class="id">U0</span> <span class="id">F0</span>) <span class="id">-[in</span> <span class="id">RHS]</span>(@<span class="id">functor_o</span> <span class="id">U0</span>) <span class="id">-[in</span> <span class="id">LHS]</span>(@<span class="id">functor_o</span> <span class="id">U0</span>).<br/>
<span class="id">congr</span> (<span class="id">_</span> <span class="id">#</span> <span class="id">_</span>).<br/>
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">-</span>(<span class="id">natural</span> (<span class="id">AdjointFunctor.eta</span> <span class="id">H</span>)).<br/>
Qed.</div>
<span class="id">HB.instance</span> <span class="vernacular">Definition</span> <span class="id">_</span> <span class="id">:=</span> <span class="id">isNatural.Build</span> <span class="id">_</span> <span class="id">_</span> <span class="id">uni_fun</span> <span class="id">uni_naturality</span>.<br/>
<br/>
<span class="vernacular">Let</span> <span class="id">uni</span> <span class="id">:</span> @<span class="id">eta_type</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">F</span> <span class="id">\o</span> <span class="id">F0]</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">U0</span> <span class="id">\o</span> <span class="id">U]</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="id">[the</span> <span class="id">nattrans</span> <span class="id">_</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> (<span class="id">U0</span> <span class="id">\o</span> <span class="id">U</span>) <span class="id">\o</span> (<span class="id">F</span> <span class="id">\o</span> <span class="id">F0</span>)<span class="id">]</span> <span class="id">of</span> <span class="id">uni_fun]</span>.<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">couni_fun</span> <span class="id">:</span> ((<span class="id">F</span> <span class="id">\o</span> <span class="id">F0</span>) <span class="id">\o</span> (<span class="id">U0</span> <span class="id">\o</span> <span class="id">U</span>)) <span class="id">~~&gt;</span> <span class="id">idfun</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">fun</span> <span class="id">A</span> <span class="id">:</span> <span class="id">UU0</span> <span class="id">=&gt;</span> <span class="id">eps</span> <span class="id">A</span> <span class="id">\o</span> <span class="id">F</span> <span class="id">#</span> <span class="id">eps0</span> (<span class="id">U</span> <span class="id">A</span>).<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">couni_naturality</span> <span class="id">:</span><br/>
&nbsp;&nbsp;<span class="id">naturality</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> (<span class="id">F</span> <span class="id">\o</span> <span class="id">F0</span>) <span class="id">\o</span> (<span class="id">U0</span> <span class="id">\o</span> <span class="id">U</span>)<span class="id">]</span> <span class="id">_</span> <span class="id">couni_fun</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof41')">Proof.</span></div>
<div class="proofscript" id="proof41">
<span class="id">move=&gt;</span> <span class="id">A</span> <span class="id">B</span> <span class="id">h</span>.<br/>
<span class="id">rewrite</span> <span class="id">[LHS]compA</span>.<br/>
<span class="id">rewrite</span> <span class="id">{}</span>(<span class="id">natural</span> (<span class="id">AdjointFunctor.eps</span> <span class="id">H</span>)).<br/>
<span class="id">rewrite</span> <span class="id">-[LHS]compA</span>.<br/>
<span class="id">rewrite</span> <span class="id">-[RHS]compA;</span> <span class="id">congr</span> (<span class="id">_</span> <span class="id">\o</span> <span class="id">_</span>).<br/>
<span class="id">rewrite</span> <span class="id">[in</span> <span class="id">LHS]FCompE</span> <span class="id">-[in</span> <span class="id">LHS]</span>(@<span class="id">functor_o</span> <span class="id">F</span>) <span class="id">[in</span> <span class="id">LHS]</span>(<span class="id">natural</span> (<span class="id">AdjointFunctor.eps</span> <span class="id">H0</span>)).<br/>
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">-[in</span> <span class="id">RHS]</span>(@<span class="id">functor_o</span> <span class="id">F</span>).<br/>
Qed.</div>
<span class="id">HB.instance</span> <span class="vernacular">Definition</span> <span class="id">_</span> <span class="id">:=</span> <span class="id">isNatural.Build</span> <span class="id">_</span> <span class="id">_</span> <span class="id">couni_fun</span> <span class="id">couni_naturality</span>.<br/>
<br/>
<span class="vernacular">Let</span> <span class="id">couni</span> <span class="id">:</span> @<span class="id">eps_type</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">F</span> <span class="id">\o</span> <span class="id">F0]</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">U0</span> <span class="id">\o</span> <span class="id">U]</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="id">[the</span> <span class="id">_</span> <span class="id">~&gt;</span> <span class="id">_</span> <span class="id">of</span> <span class="id">couni_fun]</span>.<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">composite_adjoint</span> <span class="id">:</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">F</span> <span class="id">\o</span> <span class="id">F0]</span> <span class="id">-|</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">U0</span> <span class="id">\o</span> <span class="id">U]</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof42')">Proof.</span></div>
<div class="proofscript" id="proof42">
<span class="id">apply:</span> (@<span class="id">AdjointFunctor.mk</span> <span class="id">_</span> <span class="id">_</span> <span class="id">uni</span> <span class="id">couni</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">/TriangularLaws</span>.<span class="id">left</span> <span class="id">=&gt;</span> <span class="id">A</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*rewrite&nbsp;/couni&nbsp;/uni&nbsp;/=.*)</span><br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">FCompE</span> <span class="id">-[LHS]compA</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">-</span>(@<span class="id">functor_o</span> <span class="id">F</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">_</span> <span class="id">:</span> @<span class="id">eps0</span> <span class="id">_</span> <span class="id">\o</span> <span class="id">F0</span> <span class="id">#</span> <span class="id">_</span> <span class="id">=</span> @<span class="id">eta</span> (<span class="id">F0</span> <span class="id">A</span>))<span class="id">;</span> <span class="id">first</span> <span class="id">exact:</span> (<span class="id">AdjointFunctor.tri_left</span> <span class="id">H</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">functor_o</span> <span class="id">[LHS]compA</span> <span class="id">-FCompE</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">-</span>(<span class="id">natural</span> (<span class="id">AdjointFunctor.eps</span> <span class="id">H0</span>)) <span class="id">/=</span> <span class="id">FIdE</span> <span class="id">-compA</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">rewrite</span> (<span class="id">AdjointFunctor.tri_left</span> <span class="id">H0</span>) <span class="id">compfid</span>.<br/>
<span class="id">rewrite</span> <span class="id">/TriangularLaws</span>.<span class="id">right</span> <span class="id">=&gt;</span> <span class="id">A</span>.<br/>
<span class="id">rewrite</span> <span class="id">/couni</span> <span class="id">/uni</span> <span class="id">/=</span>.<br/>
<span class="id">rewrite</span> <span class="id">compA</span> <span class="id">-[RHS]</span>(<span class="id">AdjointFunctor.tri_right</span> <span class="id">H0</span> (<span class="id">U</span> <span class="id">A</span>))<span class="id">;</span> <span class="id">congr</span> (<span class="id">_</span> <span class="id">\o</span> <span class="id">_</span>).<br/>
<span class="id">rewrite</span> <span class="id">FCompE</span> <span class="id">-functor_o;</span> <span class="id">congr</span> (<span class="id">_</span> <span class="id">#</span> <span class="id">_</span>).<br/>
<span class="id">rewrite</span> <span class="id">functor_o</span> <span class="id">-compA</span> <span class="id">-FCompE</span>.<br/>
<span class="id">rewrite</span> (<span class="id">natural</span> (<span class="id">AdjointFunctor.eta</span> <span class="id">H</span>)) <span class="id">FIdE</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">compA</span> (<span class="id">AdjointFunctor.tri_right</span> <span class="id">H</span>) <span class="id">compidf</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">End</span> <span class="id">composite_adjoint</span>.<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">operation</span> (<span class="id">E</span> <span class="id">:</span> <span class="id">functor</span>) (<span class="id">M</span> <span class="id">:</span> <span class="id">monad</span>) <span class="id">:=</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">E</span> <span class="id">\o</span> <span class="id">M]</span> <span class="id">~&gt;</span> <span class="id">M</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;E .-operation M&quot;</span> <span class="id">:=</span> (<span class="id">operation</span> <span class="id">E</span> <span class="id">M</span>).<br/>
<br/>
<span class="vernacular">Section</span> <span class="id">algebraicity</span>.<br/>
<span class="vernacular">Variables</span> (<span class="id">E</span> <span class="id">:</span> <span class="id">functor</span>) (<span class="id">M</span> <span class="id">:</span> <span class="id">monad</span>).<br/>
<span class="vernacular">Definition</span> <span class="id">algebraicity</span> (<span class="id">op</span> <span class="id">:</span> <span class="id">E</span> <span class="id">\o</span> <span class="id">M</span> <span class="id">~~&gt;</span> <span class="id">M</span>) <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">forall</span> (<span class="id">A</span> <span class="id">B</span> <span class="id">:</span> <span class="id">UU0</span>) (<span class="id">f</span> <span class="id">:</span> <span class="id">A</span> <span class="id">-&gt;</span> <span class="id">M</span> <span class="id">B</span>) (<span class="id">t</span> <span class="id">:</span> <span class="id">E</span> (<span class="id">M</span> <span class="id">A</span>))<span class="id">,</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">op</span> <span class="id">A</span> <span class="id">t</span> <span class="id">&gt;&gt;=</span> <span class="id">f</span> <span class="id">=</span> <span class="id">op</span> <span class="id">B</span> ((<span class="id">E</span> <span class="id">#</span> (<span class="gallina-kwd">fun</span> <span class="id">m</span> <span class="id">=&gt;</span> <span class="id">m</span> <span class="id">&gt;&gt;=</span> <span class="id">f</span>)) <span class="id">t</span>).<br/>
<span class="vernacular">End</span> <span class="id">algebraicity</span>.<br/>
<br/>
<span class="id">HB.mixin</span> <span class="vernacular">Record</span> <span class="id">isAOperation</span> (<span class="id">E</span> <span class="id">:</span> <span class="id">functor</span>) (<span class="id">M</span> <span class="id">:</span> <span class="id">monad</span>) (<span class="id">op</span> <span class="id">:</span> <span class="id">E</span> <span class="id">\o</span> <span class="id">M</span> <span class="id">~~&gt;</span> <span class="id">M</span>) <span class="id">:=</span> <span class="id">{</span><br/>
&nbsp;&nbsp;<span class="id">algebraic</span> <span class="id">:</span> <span class="id">algebraicity</span> <span class="id">op</span> <span class="id">}</span>.<br/>
<span class="id">HB.structure</span> <span class="vernacular">Definition</span> <span class="id">AOperation</span> (<span class="id">E</span> <span class="id">:</span> <span class="id">functor</span>) (<span class="id">M</span> <span class="id">:</span> <span class="id">monad</span>) <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="id">{op</span> <span class="id">of</span> <span class="id">isAOperation</span> <span class="id">E</span> <span class="id">M</span> <span class="id">op</span> &amp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">isNatural</span> <span class="id">[the</span> <span class="id">functor</span> <span class="id">of</span> <span class="id">E</span> <span class="id">\o</span> <span class="id">M]</span> <span class="id">M</span> <span class="id">op</span> <span class="id">}</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">aoperation</span> <span class="id">:=</span> <span class="id">AOperation.type</span>.<br/>
<span class="vernacular">Arguments</span> <span class="id">algebraic</span> <span class="id">{E}</span> <span class="id">{M}</span> <span class="id">s</span>.<br/>
<br/>
<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;E .-aoperation M&quot;</span> <span class="id">:=</span> (<span class="id">aoperation</span> <span class="id">E</span> <span class="id">M</span>).<br/>
<br/>
<span class="vernacular">Section</span> <span class="id">algebraic_operation_interface</span>.<br/>
<span class="vernacular">Variables</span> (<span class="id">E</span> <span class="id">:</span> <span class="id">functor</span>) (<span class="id">M</span> <span class="id">:</span> <span class="id">monad</span>) (<span class="id">op</span> <span class="id">:</span> <span class="id">E</span>.<span class="id">-aoperation</span> <span class="id">M</span>).<br/>
<span class="vernacular">Lemma</span> <span class="id">aoperation_ext</span> (<span class="id">f</span> <span class="id">g</span> <span class="id">:</span> <span class="id">E</span>.<span class="id">-aoperation</span> <span class="id">M</span>) <span class="id">:</span><br/>
&nbsp;&nbsp;<span class="id">f</span> <span class="id">=</span> <span class="id">g</span> <span class="id">&lt;-&gt;</span> <span class="gallina-kwd">forall</span> <span class="id">a,</span> (<span class="id">f</span> <span class="id">a</span> <span class="id">=</span> <span class="id">g</span> <span class="id">a</span> <span class="id">:&gt;</span> (<span class="id">_</span> <span class="id">-&gt;</span> <span class="id">_</span>)).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof43')">Proof.</span></div>
<div class="proofscript" id="proof43">
<span class="id">split</span> <span class="id">=&gt;</span> <span class="id">[</span> <span class="id">-&gt;</span> <span class="id">//</span> <span class="id">|];</span> <span class="id">move:</span> <span class="id">f</span> <span class="id">g</span> <span class="id">=&gt;</span> <span class="id">[f</span> <span class="id">Hf]</span> <span class="id">[g</span> <span class="id">Hg]</span> <span class="id">/=</span> <span class="id">fg</span>.<br/>
<span class="id">have</span> <span class="id">?</span> <span class="id">:</span> <span class="id">f</span> <span class="id">=</span> <span class="id">g</span> <span class="gallina-kwd">by</span> <span class="id">exact:</span> <span class="id">funext_dep</span>.<br/>
<span class="id">subst</span> <span class="id">g;</span> <span class="id">congr</span> (<span class="id">AOperation.Pack</span> <span class="id">_</span>).<br/>
<span class="id">case:</span> <span class="id">Hf</span> <span class="id">=&gt;</span> <span class="id">-[Hf1]</span> <span class="id">[Hf2]</span>.<br/>
<span class="id">case:</span> <span class="id">Hg</span> <span class="id">=&gt;</span> <span class="id">-[Hg1]</span> <span class="id">[Hg2]</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">f_equal;</span> <span class="id">f_equal;</span> <span class="id">exact/proof_irr</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">End</span> <span class="id">algebraic_operation_interface</span>.<br/>
<br/>
<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">mpair</span> <span class="id">{M</span> <span class="id">:</span> <span class="id">monad}</span> <span class="id">{A}</span> (<span class="id">xy</span> <span class="id">:</span> (<span class="id">M</span> <span class="id">A</span> <span class="id">*</span> <span class="id">M</span> <span class="id">A</span>)%<span class="id">type</span>) <span class="id">:</span> <span class="id">M</span> (<span class="id">A</span> <span class="id">*</span> <span class="id">A</span>)%<span class="id">type</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">let</span> (<span class="id">mx,</span> <span class="id">my</span>) <span class="id">:=</span> <span class="id">xy</span> <span class="gallina-kwd">in</span><br/>
&nbsp;&nbsp;<span class="id">mx</span> <span class="id">&gt;&gt;=</span> (<span class="gallina-kwd">fun</span> <span class="id">x</span> <span class="id">=&gt;</span> <span class="id">my</span> <span class="id">&gt;&gt;=</span> <span class="gallina-kwd">fun</span> <span class="id">y</span> <span class="id">=&gt;</span> <span class="id">Ret</span> (<span class="id">x,</span> <span class="id">y</span>)).<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">mpairE</span> (<span class="id">M</span> <span class="id">:</span> <span class="id">monad</span>) <span class="id">A</span> (<span class="id">mx</span> <span class="id">my</span> <span class="id">:</span> <span class="id">M</span> <span class="id">A</span>) <span class="id">:</span><br/>
&nbsp;&nbsp;<span class="id">mpair</span> (<span class="id">mx,</span> <span class="id">my</span>) <span class="id">=</span> <span class="id">mx</span> <span class="id">&gt;&gt;=</span> (<span class="gallina-kwd">fun</span> <span class="id">x</span> <span class="id">=&gt;</span> <span class="id">my</span> <span class="id">&gt;&gt;=</span> <span class="gallina-kwd">fun</span> <span class="id">y</span> <span class="id">=&gt;</span> <span class="id">Ret</span> (<span class="id">x,</span> <span class="id">y</span>)).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof44')">Proof.</span></div>
<div class="proofscript" id="proof44">
 <span class="gallina-kwd">by</span> <span class="id">[]</span>. Qed.</div>
<br/>
<span class="vernacular">Lemma</span> <span class="id">naturality_mpair</span> (<span class="id">M</span> <span class="id">:</span> <span class="id">monad</span>) (<span class="id">A</span> <span class="id">B</span> <span class="id">:</span> <span class="id">UU0</span>) (<span class="id">f</span> <span class="id">:</span> <span class="id">A</span> <span class="id">-&gt;</span> <span class="id">B</span>) (<span class="id">g</span> <span class="id">:</span> <span class="id">A</span> <span class="id">-&gt;</span> <span class="id">M</span> <span class="id">A</span>)<span class="id">:</span><br/>
&nbsp;&nbsp;(<span class="id">M</span> <span class="id">#</span> <span class="id">f^`2</span>) <span class="id">\o</span> (<span class="id">mpair</span> <span class="id">\o</span> <span class="id">g^`2</span>) <span class="id">=</span> <span class="id">mpair</span> <span class="id">\o</span> ((<span class="id">M</span> <span class="id">#</span> <span class="id">f</span>) <span class="id">\o</span> <span class="id">g</span>)<span class="id">^`2</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof45')">Proof.</span></div>
<div class="proofscript" id="proof45">
<span class="id">apply</span> <span class="id">funext</span> <span class="id">=&gt;</span> <span class="id">-[a0</span> <span class="id">a1]</span>.<br/>
<span class="id">rewrite</span> <span class="id">compE</span> <span class="id">fmap_bind</span>.<br/>
<span class="id">rewrite</span> <span class="id">compE</span> <span class="id">mpairE</span> <span class="id">compE</span> <span class="id">bind_fmap;</span> <span class="id">bind_ext</span> <span class="id">=&gt;</span> <span class="id">a2</span>.<br/>
<span class="id">rewrite</span> <span class="id">fcompE</span> <span class="id">fmap_bind</span> <span class="id">2!compE</span> <span class="id">bind_fmap;</span> <span class="id">bind_ext</span> <span class="id">=&gt;</span> <span class="id">a3</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">fcompE</span> <span class="id">-</span>(<span class="id">compE</span> (<span class="id">M</span> <span class="id">#</span> <span class="id">f^`2</span>)) (<span class="id">natural</span> <span class="id">ret</span>) <span class="id">FIdE</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">Definition</span> <span class="id">commute</span> <span class="id">{M</span> <span class="id">:</span> <span class="id">monad}</span> <span class="id">A</span> <span class="id">B</span> (<span class="id">m</span> <span class="id">:</span> <span class="id">M</span> <span class="id">A</span>) (<span class="id">n</span> <span class="id">:</span> <span class="id">M</span> <span class="id">B</span>) <span class="id">C</span> (<span class="id">f</span> <span class="id">:</span> <span class="id">A</span> <span class="id">-&gt;</span> <span class="id">B</span> <span class="id">-&gt;</span> <span class="id">M</span> <span class="id">C</span>) <span class="id">:</span> <span class="gallina-kwd">Prop</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="id">m</span> <span class="id">&gt;&gt;=</span> (<span class="gallina-kwd">fun</span> <span class="id">x</span> <span class="id">=&gt;</span> <span class="id">n</span> <span class="id">&gt;&gt;=</span> (<span class="gallina-kwd">fun</span> <span class="id">y</span> <span class="id">=&gt;</span> <span class="id">f</span> <span class="id">x</span> <span class="id">y</span>)) <span class="id">=</span><br/>
&nbsp;&nbsp;<span class="id">n</span> <span class="id">&gt;&gt;=</span> (<span class="gallina-kwd">fun</span> <span class="id">y</span> <span class="id">=&gt;</span> <span class="id">m</span> <span class="id">&gt;&gt;=</span> (<span class="gallina-kwd">fun</span> <span class="id">x</span> <span class="id">=&gt;</span> <span class="id">f</span> <span class="id">x</span> <span class="id">y</span>)) <span class="id">:&gt;</span> <span class="id">M</span> <span class="id">_</span>.<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">preserves</span> <span class="id">{M</span> <span class="id">:</span> <span class="id">monad}</span> (<span class="id">A</span> <span class="id">B</span> <span class="id">:</span> <span class="id">UU0</span>) (<span class="id">f</span> <span class="id">:</span> <span class="id">A</span> <span class="id">-&gt;</span> <span class="id">M</span> <span class="id">A</span>) (<span class="id">g</span> <span class="id">:</span> <span class="id">A</span> <span class="id">-&gt;</span> <span class="id">B</span>) <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">forall</span> <span class="id">x,</span> (<span class="id">f</span> <span class="id">x</span> <span class="id">&gt;&gt;=</span> <span class="gallina-kwd">fun</span> <span class="id">y</span> <span class="id">=&gt;</span> <span class="id">Ret</span> (<span class="id">y,</span> <span class="id">g</span> <span class="id">y</span>)) <span class="id">=</span> (<span class="id">f</span> <span class="id">x</span> <span class="id">&gt;&gt;=</span> <span class="gallina-kwd">fun</span> <span class="id">y</span> <span class="id">=&gt;</span> <span class="id">Ret</span> (<span class="id">y,</span> <span class="id">g</span> <span class="id">x</span>)).<br/>
<br/>
<br/>
<span class="vernacular">Section</span> <span class="id">rep</span>.<br/>
<span class="vernacular">Context</span> <span class="id">{M</span> <span class="id">:</span> <span class="id">monad}</span>.<br/>
<br/>
<span class="vernacular">Fixpoint</span> <span class="id">rep</span> <span class="id">n</span> (<span class="id">mx</span> <span class="id">:</span> <span class="id">M</span> <span class="id">unit</span>) <span class="id">:=</span> <span class="gallina-kwd">if</span> <span class="id">n</span> <span class="id">is</span> <span class="id">n</span>.<span class="id">+1</span> <span class="gallina-kwd">then</span> <span class="id">mx</span> <span class="id">&gt;&gt;</span> <span class="id">rep</span> <span class="id">n</span> <span class="id">mx</span> <span class="gallina-kwd">else</span> <span class="id">skip</span>.<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">repS</span> <span class="id">mx</span> <span class="id">n</span> <span class="id">:</span> <span class="id">rep</span> <span class="id">n</span>.<span class="id">+1</span> <span class="id">mx</span> <span class="id">=</span> <span class="id">rep</span> <span class="id">n</span> <span class="id">mx</span> <span class="id">&gt;&gt;</span> <span class="id">mx</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof46')">Proof.</span></div>
<div class="proofscript" id="proof46">
<span class="id">elim:</span> <span class="id">n</span> <span class="id">=&gt;</span> <span class="id">/=</span> <span class="id">[|n</span> <span class="id">IH];</span> <span class="id">first</span> <span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">bindmskip</span> <span class="id">bindskipf</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">bindA</span> <span class="id">IH</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">Lemma</span> <span class="id">rep1</span> <span class="id">mx</span> <span class="id">:</span> <span class="id">rep</span> <span class="id">1</span> <span class="id">mx</span> <span class="id">=</span> <span class="id">mx</span><br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof47')">Proof.</span></div>
<div class="proofscript" id="proof47">
 <span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">repS</span> <span class="id">bindskipf</span>. Qed.</div>
<br/>
<span class="vernacular">Lemma</span> <span class="id">rep_addn</span> <span class="id">m</span> <span class="id">n</span> <span class="id">mx</span> <span class="id">:</span> <span class="id">rep</span> (<span class="id">m</span> <span class="id">+</span> <span class="id">n</span>) <span class="id">mx</span> <span class="id">=</span> <span class="id">rep</span> <span class="id">m</span> <span class="id">mx</span> <span class="id">&gt;&gt;</span> <span class="id">rep</span> <span class="id">n</span> <span class="id">mx</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof48')">Proof.</span></div>
<div class="proofscript" id="proof48">
<span class="id">elim:</span> <span class="id">m</span> <span class="id">n</span> <span class="id">=&gt;</span> <span class="id">[|m</span> <span class="id">IH</span> <span class="id">/=]</span> <span class="id">n;</span> <span class="gallina-kwd">by</span><br/>
&nbsp;&nbsp;<span class="id">[rewrite</span> <span class="id">bindskipf</span> <span class="id">add0n</span> <span class="id">|</span> <span class="id">rewrite</span> <span class="id">-addnE</span> <span class="id">IH</span> <span class="id">bindA]</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">End</span> <span class="id">rep</span>.<br/>
<br/>
<span class="vernacular">Section</span> <span class="id">MonadCount</span>.<br/>
<br/>
<span class="vernacular">Variable</span> <span class="id">M</span> <span class="id">:</span> <span class="id">monad</span>.<br/>
<span class="vernacular">Variable</span> <span class="id">tick</span> <span class="id">:</span> <span class="id">M</span> <span class="id">unit</span>.<br/>
<br/>
<span class="vernacular">Fixpoint</span> <span class="id">hanoi</span> <span class="id">n</span> <span class="id">:</span> <span class="id">M</span> <span class="id">unit</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">if</span> <span class="id">n</span> <span class="id">is</span> <span class="id">n</span>.<span class="id">+1</span> <span class="gallina-kwd">then</span> <span class="id">hanoi</span> <span class="id">n</span> <span class="id">&gt;&gt;</span> <span class="id">tick</span> <span class="id">&gt;&gt;</span> <span class="id">hanoi</span> <span class="id">n</span> <span class="gallina-kwd">else</span> <span class="id">skip</span>.<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">hanoi_rep</span> <span class="id">n</span> <span class="id">:</span> <span class="id">hanoi</span> <span class="id">n</span> <span class="id">=</span> <span class="id">rep</span> (<span class="id">2</span> <span class="id">^</span> <span class="id">n</span>).<span class="id">-1</span> <span class="id">tick</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof49')">Proof.</span></div>
<div class="proofscript" id="proof49">
<span class="id">elim:</span> <span class="id">n</span> <span class="id">=&gt;</span> <span class="id">//</span> <span class="id">n</span> <span class="id">IH</span> <span class="id">/=</span>.<br/>
<span class="id">rewrite</span> <span class="id">IH</span> <span class="id">-repS</span> <span class="id">prednK</span> <span class="id">?expn_gt0</span> <span class="id">//</span> <span class="id">-rep_addn</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">-subn1</span> <span class="id">addnBA</span> <span class="id">?expn_gt0</span> <span class="id">//</span> <span class="id">addnn</span> <span class="id">-muln2</span> <span class="id">-expnSr</span> <span class="id">subn1</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">End</span> <span class="id">MonadCount</span>.<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">iteri_bind</span> <span class="id">{M</span> <span class="id">:</span> <span class="id">monad}</span> <span class="id">n</span> (<span class="id">f</span> <span class="id">:</span> <span class="id">nat</span> <span class="id">-&gt;</span> <span class="id">M</span> <span class="id">unit</span>) (<span class="id">m1</span> <span class="id">m2</span> <span class="id">:</span> <span class="id">M</span> <span class="id">unit</span>) <span class="id">:</span><br/>
&nbsp;&nbsp;<span class="id">iteri</span> <span class="id">n</span> (<span class="gallina-kwd">fun</span> <span class="id">i</span> (<span class="id">m</span> <span class="id">:</span> <span class="id">M</span> <span class="id">unit</span>) <span class="id">=&gt;</span> <span class="id">m</span> <span class="id">&gt;&gt;</span> <span class="id">f</span> <span class="id">i</span>) (<span class="id">m1</span> <span class="id">&gt;&gt;</span> <span class="id">m2</span>) <span class="id">=</span><br/>
&nbsp;&nbsp;<span class="id">m1</span> <span class="id">&gt;&gt;</span> <span class="id">iteri</span> <span class="id">n</span> (<span class="gallina-kwd">fun</span> <span class="id">i</span> (<span class="id">m</span> <span class="id">:</span> <span class="id">M</span> <span class="id">unit</span>) <span class="id">=&gt;</span> <span class="id">m</span> <span class="id">&gt;&gt;</span> <span class="id">f</span> <span class="id">i</span>) <span class="id">m2</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof50')">Proof.</span></div>
<div class="proofscript" id="proof50">
 <span class="gallina-kwd">by</span> <span class="id">elim:</span> <span class="id">n</span> <span class="id">m2</span> <span class="id">=&gt;</span> <span class="id">//</span> <span class="id">n</span> <span class="id">IH</span> <span class="id">m2;</span> <span class="id">rewrite</span> <span class="id">iteriS</span> <span class="id">IH</span> <span class="id">!bindA</span>. Qed.</div>
<br/>
<span class="vernacular">Lemma</span> <span class="id">iter_bind</span> <span class="id">{M</span> <span class="id">:</span> <span class="id">monad}</span> (<span class="id">T</span> <span class="id">:</span> <span class="id">UU0</span>) <span class="id">n</span> (<span class="id">f</span> <span class="id">:</span> <span class="id">T</span> <span class="id">-&gt;</span> <span class="id">M</span> <span class="id">T</span>) (<span class="id">m1</span> <span class="id">:</span> <span class="id">M</span> <span class="id">unit</span>) <span class="id">m2</span> <span class="id">:</span><br/>
&nbsp;&nbsp;<span class="id">iter</span> <span class="id">n</span> (<span class="gallina-kwd">fun</span> (<span class="id">m</span> <span class="id">:</span> <span class="id">M</span> <span class="id">T</span>) <span class="id">=&gt;</span> <span class="id">m</span> <span class="id">&gt;&gt;=</span> <span class="id">f</span>) (<span class="id">m1</span> <span class="id">&gt;&gt;</span> <span class="id">m2</span>) <span class="id">=</span><br/>
&nbsp;&nbsp;<span class="id">m1</span> <span class="id">&gt;&gt;</span> <span class="id">iter</span> <span class="id">n</span> (<span class="gallina-kwd">fun</span> (<span class="id">m</span> <span class="id">:</span> <span class="id">M</span> <span class="id">T</span>) <span class="id">=&gt;</span> <span class="id">m</span> <span class="id">&gt;&gt;=</span> <span class="id">f</span>) <span class="id">m2</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof51')">Proof.</span></div>
<div class="proofscript" id="proof51">
 <span class="gallina-kwd">by</span> <span class="id">elim:</span> <span class="id">n</span> <span class="id">m2</span> <span class="id">=&gt;</span> <span class="id">//</span> <span class="id">n</span> <span class="id">IH</span> <span class="id">m2;</span> <span class="id">rewrite</span> <span class="id">iterS</span> <span class="id">IH</span> <span class="id">!bindA</span>. Qed.</div>
<br/>
<span class="vernacular">Section</span> <span class="id">forloop</span>.<br/>
<span class="vernacular">Variable</span> <span class="id">M</span> <span class="id">:</span> <span class="id">monad</span>.<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">forloop</span> (<span class="id">n_1</span> <span class="id">n_2</span> <span class="id">:</span> <span class="id">nat</span>) (<span class="id">b</span> <span class="id">:</span> <span class="id">nat</span> <span class="id">-&gt;</span> <span class="id">M</span> <span class="id">unit</span>) <span class="id">:</span> <span class="id">M</span> <span class="id">unit</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">if</span> <span class="id">n_2</span> <span class="id">&lt;</span> <span class="id">n_1</span> <span class="gallina-kwd">then</span> <span class="id">Ret</span> <span class="id">tt</span> <span class="gallina-kwd">else</span><br/>
&nbsp;&nbsp;<span class="id">iteri</span> (<span class="id">n_2</span>.<span class="id">+1</span> <span class="id">-</span> <span class="id">n_1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="gallina-kwd">fun</span> <span class="id">i</span> (<span class="id">m</span> <span class="id">:</span> <span class="id">M</span> <span class="id">unit</span>) <span class="id">=&gt;</span> <span class="id">m</span> <span class="id">&gt;&gt;</span> <span class="id">b</span> (<span class="id">n_1</span> <span class="id">+</span> <span class="id">i</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">skip</span>.<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">forloopS</span> <span class="id">m</span> <span class="id">n</span> (<span class="id">f</span> <span class="id">:</span> <span class="id">nat</span> <span class="id">-&gt;</span> <span class="id">M</span> <span class="id">unit</span>) <span class="id">:</span><br/>
&nbsp;&nbsp;<span class="id">m</span> <span class="id">&lt;=</span> <span class="id">n</span> <span class="id">-&gt;</span> <span class="id">forloop</span> <span class="id">m</span> <span class="id">n</span> <span class="id">f</span> <span class="id">=</span> <span class="id">f</span> <span class="id">m</span> <span class="id">&gt;&gt;</span> <span class="id">forloop</span> <span class="id">m</span>.<span class="id">+1</span> <span class="id">n</span> <span class="id">f</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof52')">Proof.</span></div>
<div class="proofscript" id="proof52">
<span class="id">rewrite</span> <span class="id">/forloop</span> <span class="id">=&gt;</span> <span class="id">mn</span>.<br/>
<span class="id">rewrite</span> <span class="id">ltnNge</span> <span class="id">mn</span> <span class="id">/=</span> <span class="id">subSS</span> <span class="id">subSn</span> <span class="id">//</span> <span class="id">iteriSr</span> <span class="id">bindskipf</span>.<br/>
<span class="id">rewrite</span> <span class="id">-[f</span> <span class="id">_]bindmskip</span> <span class="id">iteri_bind</span> <span class="id">addn0</span> <span class="id">ltnS</span> <span class="id">-subn_eq0</span>.<br/>
<span class="id">case:</span> (<span class="id">n-m</span>) <span class="id">=&gt;</span> <span class="id">//=</span> <span class="id">k</span>.<br/>
<span class="id">rewrite</span> <span class="id">addSnnS;</span> <span class="id">apply</span> <span class="id">eq_bind</span> <span class="id">=&gt;</span> <span class="id">_;</span> <span class="id">congr</span> <span class="id">bind</span>.<br/>
<span class="id">apply</span> <span class="id">eq_iteri</span> <span class="id">=&gt;</span> <span class="id">i</span> <span class="id">x;</span> <span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">addSnnS</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">Lemma</span> <span class="id">forloop0</span> <span class="id">m</span> <span class="id">n</span> (<span class="id">f</span> <span class="id">:</span> <span class="id">nat</span> <span class="id">-&gt;</span> <span class="id">M</span> <span class="id">unit</span>) <span class="id">:</span><br/>
&nbsp;&nbsp;<span class="id">m</span> <span class="id">&gt;</span> <span class="id">n</span> <span class="id">-&gt;</span> <span class="id">forloop</span> <span class="id">m</span> <span class="id">n</span> <span class="id">f</span> <span class="id">=</span> <span class="id">skip</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof53')">Proof.</span></div>
<div class="proofscript" id="proof53">
 <span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">/forloop</span> <span class="id">=&gt;</span> <span class="id">-&gt;</span>. Qed.</div>
<br/>
<span class="vernacular">End</span> <span class="id">forloop</span>.<br/>
<span class="vernacular">Arguments</span> <span class="id">forloop</span> <span class="id">{M}</span>.<br/>

      <div class="footer"><hr/>Generated by <a href="https://github.com/yoshihiro503/coq2html/">a fork of coq2html</a></div>
    </div>
  </div>
    </main>
</body>
</html>
